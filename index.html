!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2c3e50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>AtacamApp - Geolog√≠a en Tiempo Real</title>
    <link rel="manifest" href="data:application/manifest+json,{}">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚õ∞Ô∏è</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        /* === ESTILOS CSS - ATACAMAPP === */
        :root {
            --primary: #2c3e50;
            --secondary: #d35400;
            --accent: #27ae60;
            --accent2: #3498db;
            --accent3: #8e44ad;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --danger: #e74c3c;
            --warning: #f39c12;
            --success: #27ae60;
            --rock-brown: #a0522d;
            --desert-sand: #f5deb3;
            --copper: #b87333;
            --andesite: #708090;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), 
                        url('https://images.unsplash.com/photo-1544551763-46a013bb70d5?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80') no-repeat center center fixed;
            background-size: cover;
            color: #333;
            min-height: 100vh;
            padding: 10px;
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
        }

        /* Pantalla de Permisos */
        .permission-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .permission-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            border: 3px solid var(--secondary);
            animation: scaleIn 0.5s ease;
        }

        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .permission-content h2 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 2rem;
        }

        .permission-features {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 30px 0;
        }

        .permission-feature {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            text-align: left;
            transition: transform 0.3s;
        }

        .permission-feature:hover {
            transform: translateX(10px);
        }

        .app-header {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, rgba(44, 62, 80, 0.95), rgba(52, 73, 94, 0.95));
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            text-align: center;
            border: 2px solid var(--secondary);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .app-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--secondary), var(--accent), var(--accent2));
        }

        .app-header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 15px;
            color: var(--light);
        }

        .card {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            border: 1px solid rgba(224, 224, 224, 0.5);
            border-top: 5px solid var(--secondary);
            transition: transform 0.3s, box-shadow 0.3s;
            backdrop-filter: blur(5px);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        /* M√≥dulo de C√°mara Mejorado */
        .camera-container {
            position: relative;
            width: 100%;
            height: 400px;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 3px solid var(--primary);
        }

        #cameraFeed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* Espejo para selfie-style */
        }

        .camera-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 10px;
            font-size: 0.9rem;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .camera-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        /* Mapa */
        .map-container {
            width: 100%;
            height: 400px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
            border: 3px solid var(--primary);
        }

        #map {
            width: 100%;
            height: 100%;
        }

        /* Base de Datos con Cover Flow */
        .coverflow-container {
            position: relative;
            width: 100%;
            height: 200px;
            perspective: 1000px;
            margin: 20px 0;
            overflow: hidden;
        }

        .coverflow {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            position: relative;
        }

        .mineral-card-flow {
            position: absolute;
            width: 150px;
            height: 180px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            text-align: center;
            border: 2px solid transparent;
        }

        .mineral-card-flow.active {
            transform: translateZ(100px);
            border-color: var(--secondary);
            z-index: 10;
            box-shadow: 0 15px 30px rgba(210, 84, 0, 0.3);
        }

        /* Br√∫jula */
        .compass-container {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            position: relative;
        }

        .compass {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: #f8f9fa;
            position: relative;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
            border: 2px solid var(--primary);
        }

        .compass-needle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 4px;
            height: 90px;
            background: var(--danger);
            transform-origin: center 0;
            transition: transform 0.1s;
            z-index: 2;
        }

        .compass-needle::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: -8px;
            width: 20px;
            height: 20px;
            background: var(--danger);
            border-radius: 50%;
        }

        /* Escala de Mohs */
        .mohs-scale {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            margin: 20px 0;
        }

        .mohs-item {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 10px 5px;
            text-align: center;
            border-radius: 5px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .mohs-item:hover {
            transform: scale(1.1);
        }

        .mohs-item:nth-child(1) { background: linear-gradient(135deg, #f6d365, #fda085); }
        .mohs-item:nth-child(2) { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .mohs-item:nth-child(3) { background: linear-gradient(135deg, #5ee7df, #b490ca); }
        .mohs-item:nth-child(4) { background: linear-gradient(135deg, #d299c2, #fef9d7); }
        .mohs-item:nth-child(5) { background: linear-gradient(135deg, #a8edea, #fed6e3); }
        .mohs-item:nth-child(6) { background: linear-gradient(135deg, #ffecd2, #fcb69f); }
        .mohs-item:nth-child(7) { background: linear-gradient(135deg, #a3bded, #6991c7); }
        .mohs-item:nth-child(8) { background: linear-gradient(135deg, #9795f0, #fbc8d4); }
        .mohs-item:nth-child(9) { background: linear-gradient(135deg, #fdcbf1, #e6dee9); }
        .mohs-item:nth-child(10) { background: linear-gradient(135deg, #accbee, #e7f0fd); }

        /* Botones */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            touch-action: manipulation;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--secondary), #e67e22);
            color: white;
            border: 2px solid var(--secondary);
        }

        .btn-primary:active {
            transform: scale(0.95);
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--secondary);
        }

        .loading i {
            font-size: 3rem;
            margin-bottom: 20px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .app-header h1 {
                font-size: 2rem;
            }
            
            .camera-container {
                height: 300px;
            }
            
            .map-container {
                height: 300px;
            }
            
            .coverflow-container {
                height: 150px;
            }
            
            .mineral-card-flow {
                width: 120px;
                height: 150px;
            }
        }

        @media (max-width: 480px) {
            .card {
                padding: 15px;
            }
            
            .camera-controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }

        /* Notificaciones */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1001;
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            border-left: 5px solid var(--accent);
            max-width: 90%;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Modal mejorado */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 3px solid var(--secondary);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            animation: scaleIn 0.3s;
        }

        /* Colores de Raya */
        .streak-colors {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .streak-color {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .streak-color:hover {
            transform: scale(1.1);
        }

        /* Geolocalizaci√≥n */
        .location-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 20px;
            margin: 5px;
            border: 2px solid var(--accent2);
        }

        /* Animaciones */
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(39, 174, 96, 0); }
            100% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0); }
        }

        /* Estado de red */
        .network-status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 100;
            font-size: 0.9rem;
        }

        /* Scroll personalizado */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--secondary);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #e67e22;
        }
    </style>
</head>
<body>
    <!-- Pantalla de Permisos -->
    <div class="permission-screen" id="permissionScreen">
        <div class="permission-content">
            <h2><i class="fas fa-shield-alt"></i> AtacamApp</h2>
            <p>Para funcionar correctamente, necesitamos los siguientes permisos:</p>
            
            <div class="permission-features">
                <div class="permission-feature">
                    <i class="fas fa-camera"></i>
                    <div>
                        <strong>C√°mara</strong>
                        <div style="font-size:0.9em;color:#666;">Identificar minerales en tiempo real</div>
                    </div>
                </div>
                
                <div class="permission-feature">
                    <i class="fas fa-map-marker-alt"></i>
                    <div>
                        <strong>Ubicaci√≥n GPS</strong>
                        <div style="font-size:0.9em;color:#666;">Georreferenciar muestras</div>
                    </div>
                </div>
                
                <div class="permission-feature">
                    <i class="fas fa-wifi"></i>
                    <div>
                        <strong>Conexi√≥n</strong>
                        <div style="font-size:0.9em;color:#666;">Mapas y datos en tiempo real</div>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-primary" id="grantPermissions" style="padding: 15px 30px; font-size: 1.1rem;">
                <i class="fas fa-check-circle"></i> Activar Todos los Permisos
            </button>
            
            <div style="margin-top: 20px; font-size: 0.9em; color: #999;">
                <i class="fas fa-lock"></i> Los datos son locales y seguros
            </div>
        </div>
    </div>

    <!-- Aplicaci√≥n Principal -->
    <div class="container app-content" id="mainApp" style="display:none;">
        <!-- Estado de Red -->
        <div class="network-status" id="networkStatus">
            <i class="fas fa-wifi"></i>
            <span id="networkType">Conectando...</span>
        </div>

        <header class="app-header">
            <h1><i class="fas fa-mountain"></i> AtacamApp</h1>
            <p class="subtitle">Sistema Geol√≥gico Inteligente - Regi√≥n de Atacama</p>
            <div class="status-bar" style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-top: 15px;">
                <div class="status-item" id="gpsStatus">
                    <i class="fas fa-satellite"></i> <span>GPS: --</span>
                </div>
                <div class="status-item" id="cameraStatus">
                    <i class="fas fa-camera"></i> <span>C√°mara: --</span>
                </div>
                <div class="status-item" id="locationStatus">
                    <i class="fas fa-map-marker-alt"></i> <span>Ubicaci√≥n: --</span>
                </div>
                <div class="status-item" id="dataStatus">
                    <i class="fas fa-database"></i> <span>Datos: --</span>
                </div>
            </div>
        </header>

        <div class="main-content">
            <div class="left-panel">
                <!-- M√≥dulo de C√°mara en Tiempo Real -->
                <section class="card camera-module">
                    <h2><i class="fas fa-camera"></i> Identificaci√≥n en Tiempo Real</h2>
                    
                    <div class="camera-container" id="cameraContainer">
                        <video id="cameraFeed" autoplay playsinline></video>
                        <canvas id="cameraCanvas" style="display:none;"></canvas>
                        <div class="camera-overlay">
                            <div>
                                <i class="fas fa-crosshairs"></i> Apunte al mineral
                            </div>
                            <div id="cameraInfo">
                                <i class="fas fa-circle" style="color:#ff4444; animation: blink 1s infinite;"></i>
                                En vivo
                            </div>
                        </div>
                        <div class="camera-placeholder" id="cameraPlaceholder" style="display:none;">
                            <i class="fas fa-camera"></i>
                            <h3>Activando c√°mara...</h3>
                        </div>
                    </div>
                    
                    <div class="camera-controls">
                        <button class="btn btn-primary" id="startCameraBtn">
                            <i class="fas fa-video"></i> Activar C√°mara
                        </button>
                        <button class="btn btn-secondary" id="captureBtn" disabled>
                            <i class="fas fa-camera"></i> Capturar Muestra
                        </button>
                        <button class="btn btn-warning" id="analyzeBtn" disabled>
                            <i class="fas fa-robot"></i> Analizar IA
                        </button>
                        <button class="btn btn-success" id="generateFullReport">
                            <i class="fas fa-file-alt"></i> Informe Completo
                        </button>
                    </div>
                </section>

                <!-- Mapa Interactivo -->
                <section class="card map-module">
                    <h2><i class="fas fa-map-marked-alt"></i> Mapa Geol√≥gico</h2>
                    <div class="map-container">
                        <div id="map"></div>
                    </div>
                    <div class="camera-controls">
                        <button class="btn btn-primary" id="centerMap">
                            <i class="fas fa-location-arrow"></i> Centrar en M√≠
                        </button>
                        <button class="btn btn-secondary" id="addMarker">
                            <i class="fas fa-map-pin"></i> Marcar Punto
                        </button>
                        <select class="form-control" id="mapLayer" style="flex:1;">
                            <option value="osm">OpenStreetMap</option>
                            <option value="google">Google Maps</option>
                            <option value="satellite">Sat√©lite</option>
                            <option value="topo">Topogr√°fico</option>
                        </select>
                    </div>
                </section>

                <!-- Base de Datos con Cover Flow -->
                <section class="card database-module">
                    <h2><i class="fas fa-database"></i> Minerales Identificados</h2>
                    <input type="text" class="form-control" id="searchMinerals" 
                           placeholder="üîç Buscar mineral..." style="margin-bottom:15px;">
                    
                    <div class="coverflow-container">
                        <div class="coverflow" id="coverflow"></div>
                    </div>
                    
                    <div id="mineralDetails">
                        <div class="loading" id="detailsLoading">
                            <i class="fas fa-spinner"></i>
                            <p>Selecciona un mineral...</p>
                        </div>
                    </div>
                </section>
            </div>

            <div class="right-panel">
                <!-- Herramientas Geol√≥gicas -->
                <section class="card tools-module">
                    <h2><i class="fas fa-tools"></i> Herramientas</h2>
                    <div class="tools-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px;">
                        <button class="btn btn-secondary tool-btn" data-tool="mohs">
                            <i class="fas fa-gem"></i> Escala Mohs
                        </button>
                        <button class="btn btn-secondary tool-btn" data-tool="compass">
                            <i class="fas fa-compass"></i> Br√∫jula
                        </button>
                        <button class="btn btn-secondary tool-btn" data-tool="converter">
                            <i class="fas fa-balance-scale"></i> Conversor
                        </button>
                        <button class="btn btn-secondary tool-btn" data-tool="streak">
                            <i class="fas fa-palette"></i> Colores Raya
                        </button>
                        <button class="btn btn-secondary tool-btn" data-tool="weather">
                            <i class="fas fa-cloud-sun"></i> Clima
                        </button>
                        <button class="btn btn-secondary tool-btn" data-tool="geology">
                            <i class="fas fa-mountain"></i> Geolog√≠a Atacama
                        </button>
                    </div>
                </section>

                <!-- Informaci√≥n GPS y Geolocalizaci√≥n -->
                <section class="card gps-module">
                    <h2><i class="fas fa-satellite"></i> Geolocalizaci√≥n</h2>
                    <div class="gps-info" style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <h4><i class="fas fa-map-pin"></i> Ubicaci√≥n Actual</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                            <div>
                                <strong>Latitud:</strong> <span id="currentLat">--</span>
                            </div>
                            <div>
                                <strong>Longitud:</strong> <span id="currentLng">--</span>
                            </div>
                            <div>
                                <strong>Altitud:</strong> <span id="currentAlt">-- msnm</span>
                            </div>
                            <div>
                                <strong>Precisi√≥n:</strong> <span id="currentAcc">-- m</span>
                            </div>
                        </div>
                        <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 5px;">
                            <strong>Zona Geol√≥gica:</strong> <span id="geologicalZone">--</span>
                        </div>
                    </div>
                    <button class="btn btn-gps" id="updateLocation" style="width:100%;">
                        <i class="fas fa-sync-alt"></i> Actualizar GPS
                    </button>
                </section>

                <!-- Informe R√°pido -->
                <section class="card report-module">
                    <h2><i class="fas fa-file-medical"></i> Informe R√°pido</h2>
                    <div id="reportSummary">
                        <p style="color:#666; text-align:center; padding:20px;">
                            <i class="fas fa-info-circle"></i><br>
                            Captura una muestra con la c√°mara para generar un informe completo con:
                        </p>
                        <ul style="padding-left:20px; margin:15px 0;">
                            <li>üì∏ Foto de la muestra</li>
                            <li>üìç Coordenadas GPS</li>
                            <li>üó∫Ô∏è Ubicaci√≥n en mapa</li>
                            <li>‚öíÔ∏è Datos geol√≥gicos</li>
                            <li>üìä An√°lisis mineral√≥gico</li>
                        </ul>
                    </div>
                    <button class="btn btn-success" id="downloadReport" disabled style="width:100%; margin-top:15px;">
                        <i class="fas fa-download"></i> Descargar Informe Completo
                    </button>
                </section>

                <!-- Configuraci√≥n -->
                <section class="card config-module">
                    <h2><i class="fas fa-cog"></i> Configuraci√≥n</h2>
                    <div style="display:flex; gap:10px; flex-wrap:wrap;">
                        <button class="btn btn-secondary" id="clearData">
                            <i class="fas fa-trash"></i> Limpiar
                        </button>
                        <button class="btn btn-primary" id="exportAll">
                            <i class="fas fa-download"></i> Exportar Todo
                        </button>
                        <button class="btn btn-gps" id="calibrateCompass">
                            <i class="fas fa-compass"></i> Calibrar
                        </button>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Modal para Herramientas -->
    <div class="modal" id="toolModal">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 id="modalTitle"></h2>
                <button class="btn btn-danger" id="closeModal" style="padding:8px 15px;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="modalContent"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // === VARIABLES GLOBALES ===
        let stream = null;
        let map = null;
        let currentMarker = null;
        let mineralsData = [];
        let currentMineral = null;
        let watchId = null;
        let currentLocation = null;
        let geologicalZone = null;
        let compassCalibration = 0;
        let currentReport = null;
        let isCameraActive = false;

        // === INICIALIZACI√ìN ===
        document.addEventListener('DOMContentLoaded', initializeApp);

        async function initializeApp() {
            // Pantalla de permisos
            document.getElementById('grantPermissions').addEventListener('click', requestAllPermissions);
            
            // C√°mara
            document.getElementById('startCameraBtn').addEventListener('click', startCamera);
            document.getElementById('captureBtn').addEventListener('click', captureImage);
            document.getElementById('analyzeBtn').addEventListener('click', analyzeWithAI);
            document.getElementById('generateFullReport').addEventListener('click', generateFullReport);
            
            // Mapa
            document.getElementById('centerMap').addEventListener('click', centerMap);
            document.getElementById('addMarker').addEventListener('click', addSampleMarker);
            document.getElementById('mapLayer').addEventListener('change', changeMapLayer);
            
            // Herramientas
            document.querySelectorAll('.tool-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    openToolModal(this.dataset.tool);
                });
            });
            
            // GPS
            document.getElementById('updateLocation').addEventListener('click', updateGPSLocation);
            
            // Informes
            document.getElementById('downloadReport').addEventListener('click', downloadCurrentReport);
            
            // Configuraci√≥n
            document.getElementById('clearData').addEventListener('click', clearAllData);
            document.getElementById('exportAll').addEventListener('click', exportAllData);
            document.getElementById('calibrateCompass').addEventListener('click', calibrateCompass);
            
            // Modal
            document.getElementById('closeModal').addEventListener('click', closeModal);
            
            // Buscador
            document.getElementById('searchMinerals').addEventListener('input', searchMinerals);
            
            // Cargar datos iniciales
            loadMineralsData();
            initMap();
            
            // Configurar eventos de orientaci√≥n para br√∫jula
            if (window.DeviceOrientationEvent) {
                window.addEventListener('deviceorientation', handleCompass);
            }
        }

        // === PERMISOS COMPLETOS ===
        async function requestAllPermissions() {
            try {
                showNotification('Solicitando permisos...', 'info');
                
                // 1. Permisos de c√°mara
                try {
                    const constraints = {
                        video: {
                            facingMode: 'environment',
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        },
                        audio: false
                    };
                    
                    // Para iOS/m√≥viles, necesitamos getUserMedia espec√≠fico
                    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                        stream = await navigator.mediaDevices.getUserMedia(constraints);
                    } else if (navigator.getUserMedia) {
                        stream = await new Promise((resolve, reject) => {
                            navigator.getUserMedia(constraints, resolve, reject);
                        });
                    }
                    
                    if (stream) {
                        const video = document.getElementById('cameraFeed');
                        video.srcObject = stream;
                        video.play();
                        document.getElementById('captureBtn').disabled = false;
                        document.getElementById('analyzeBtn').disabled = false;
                        document.getElementById('cameraStatus').innerHTML = '<i class="fas fa-camera"></i> C√°mara: Activa';
                        isCameraActive = true;
                        showNotification('C√°mara activada', 'success');
                    }
                } catch (cameraError) {
                    console.error('Error c√°mara:', cameraError);
                    showNotification('C√°mara no disponible. Usa modo simulado.', 'warning');
                    setupSimulatedCamera();
                }

                // 2. Permisos de ubicaci√≥n
                if ("geolocation" in navigator) {
                    try {
                        const position = await new Promise((resolve, reject) => {
                            navigator.geolocation.getCurrentPosition(
                                resolve, 
                                reject, 
                                {
                                    enableHighAccuracy: true,
                                    timeout: 10000,
                                    maximumAge: 0
                                }
                            );
                        });
                        
                        handleLocationSuccess(position);
                        startGPSWatching();
                        
                    } catch (gpsError) {
                        console.warn('GPS error:', gpsError);
                        useSimulatedLocation();
                        showNotification('GPS limitado. Usando ubicaci√≥n simulada.', 'warning');
                    }
                } else {
                    useSimulatedLocation();
                }

                // 3. Ocultar pantalla de permisos
                document.getElementById('permissionScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'grid';
                
                // 4. Inicializar componentes
                setTimeout(() => {
                    updateCoverflow();
                    if (currentLocation) {
                        updateMapLocation(currentLocation);
                    }
                }, 500);
                
                showNotification('¬°AtacamApp lista!', 'success');
                
            } catch (error) {
                console.error('Error en permisos:', error);
                showNotification('Error al solicitar permisos', 'error');
            }
        }

        // === C√ÅMARA FUNCIONAL ===
        async function startCamera() {
            if (isCameraActive) {
                // Detener c√°mara si ya est√° activa
                stopCamera();
                return;
            }
            
            try {
                const constraints = {
                    video: {
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                };
                
                stream = await navigator.mediaDevices.getUserMedia(constraints);
                const video = document.getElementById('cameraFeed');
                video.srcObject = stream;
                
                // Esperar a que el video est√© listo
                await new Promise(resolve => {
                    video.onloadedmetadata = () => {
                        video.play();
                        resolve();
                    };
                });
                
                document.getElementById('captureBtn').disabled = false;
                document.getElementById('analyzeBtn').disabled = false;
                document.getElementById('cameraStatus').innerHTML = '<i class="fas fa-camera"></i> C√°mara: Activa';
                document.getElementById('startCameraBtn').innerHTML = '<i class="fas fa-stop-circle"></i> Detener C√°mara';
                isCameraActive = true;
                
                showNotification('C√°mara activada', 'success');
                
            } catch (error) {
                console.error('Error c√°mara:', error);
                showNotification('Error al activar c√°mara', 'error');
                setupSimulatedCamera();
            }
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            const video = document.getElementById('cameraFeed');
            video.srcObject = null;
            
            document.getElementById('captureBtn').disabled = true;
            document.getElementById('analyzeBtn').disabled = true;
            document.getElementById('cameraStatus').innerHTML = '<i class="fas fa-camera-slash"></i> C√°mara: Inactiva';
            document.getElementById('startCameraBtn').innerHTML = '<i class="fas fa-video"></i> Activar C√°mara';
            isCameraActive = false;
            
            showNotification('C√°mara detenida', 'info');
        }

        function setupSimulatedCamera() {
            const placeholder = document.getElementById('cameraPlaceholder');
            placeholder.style.display = 'flex';
            placeholder.innerHTML = `
                <div style="text-align:center; color:white; padding:20px;">
                    <i class="fas fa-camera-slash" style="font-size:4rem;"></i>
                    <h3>Modo Simulado</h3>
                    <p>Usa el bot√≥n "Analizar IA" para simular identificaci√≥n</p>
                </div>
            `;
            
            document.getElementById('analyzeBtn').disabled = false;
            showNotification('Modo simulado activado', 'warning');
        }

        function captureImage() {
            if (!isCameraActive) {
                showNotification('Activa la c√°mara primero', 'warning');
                return;
            }
            
            const video = document.getElementById('cameraFeed');
            const canvas = document.getElementById('cameraCanvas');
            const context = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Mostrar preview
            const imageData = canvas.toDataURL('image/jpeg');
            showNotification('Imagen capturada ‚úì', 'success');
            
            // Guardar para an√°lisis
            currentReport = {
                image: imageData,
                timestamp: new Date().toISOString(),
                location: currentLocation,
                mineral: null
            };
            
            document.getElementById('downloadReport').disabled = false;
        }

        // === GPS Y MAPA ===
        function initMap() {
            map = L.map('map').setView([-27.3667, -70.3333], 10);
            
            // Capa base OSM por defecto
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 18
            }).addTo(map);
            
            // Marcador inicial
            currentMarker = L.marker([-27.3667, -70.3333], {
                icon: L.divIcon({
                    className: 'custom-marker',
                    html: '<i class="fas fa-map-marker-alt" style="color:#e74c3c; font-size:24px;"></i>',
                    iconSize: [30, 30],
                    iconAnchor: [15, 30]
                }),
                draggable: true
            }).addTo(map);
            
            // Evento al mover marcador
            currentMarker.on('dragend', function(e) {
                const marker = e.target;
                const position = marker.getLatLng();
                currentLocation = {
                    latitude: position.lat,
                    longitude: position.lng,
                    accuracy: 50,
                    timestamp: new Date()
                };
                updateLocationDisplay();
                updateGeologicalZone();
            });
            
            showNotification('Mapa cargado', 'success');
        }

        function handleLocationSuccess(position) {
            currentLocation = {
                latitude: position.coords.latitude,
                longitude: position.coords.longitude,
                altitude: position.coords.altitude || 0,
                accuracy: position.coords.accuracy,
                heading: position.coords.heading || 0,
                speed: position.coords.speed || 0,
                timestamp: new Date(position.timestamp)
            };
            
            updateLocationDisplay();
            updateMapLocation(currentLocation);
            updateGeologicalZone();
            
            document.getElementById('gpsStatus').innerHTML = 
                '<i class="fas fa-satellite"></i> GPS: Activo';
        }

        function startGPSWatching() {
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
            }
            
            watchId = navigator.geolocation.watchPosition(
                handleLocationSuccess,
                handleLocationError,
                {
                    enableHighAccuracy: true,
                    timeout: 15000,
                    maximumAge: 0
                }
            );
        }

        function updateMapLocation(location) {
            if (!map) return;
            
            const latLng = [location.latitude, location.longitude];
            map.setView(latLng, 13);
            
            if (currentMarker) {
                currentMarker.setLatLng(latLng);
            } else {
                currentMarker = L.marker(latLng, {
                    icon: L.divIcon({
                        className: 'custom-marker',
                        html: '<i class="fas fa-map-marker-alt" style="color:#e74c3c; font-size:24px;"></i>',
                        iconSize: [30, 30],
                        iconAnchor: [15, 30]
                    }),
                    draggable: true
                }).addTo(map);
            }
            
            // A√±adir c√≠rculo de precisi√≥n
            L.circle(latLng, {
                color: '#3498db',
                fillColor: '#3498db',
                fillOpacity: 0.2,
                radius: location.accuracy
            }).addTo(map);
        }

        function centerMap() {
            if (currentLocation && map) {
                map.setView([currentLocation.latitude, currentLocation.longitude], 13);
                showNotification('Mapa centrado en tu ubicaci√≥n', 'info');
            } else {
                showNotification('No hay ubicaci√≥n disponible', 'warning');
            }
        }

        function addSampleMarker() {
            if (!currentLocation) {
                showNotification('Obt√©n tu ubicaci√≥n primero', 'warning');
                return;
            }
            
            const sampleMarker = L.marker([currentLocation.latitude, currentLocation.longitude], {
                icon: L.divIcon({
                    className: 'sample-marker',
                    html: '<i class="fas fa-gem" style="color:#27ae60; font-size:20px;"></i>',
                    iconSize: [20, 20],
                    iconAnchor: [10, 20]
                })
            }).addTo(map);
            
            sampleMarker.bindPopup(`
                <b>Muestra Geol√≥gica</b><br>
                ${new Date().toLocaleString()}<br>
                <i class="fas fa-map-pin"></i> ${currentLocation.latitude.toFixed(6)}, ${currentLocation.longitude.toFixed(6)}
            `);
            
            showNotification('Punto de muestra a√±adido al mapa', 'success');
        }

        function changeMapLayer() {
            const layer = document.getElementById('mapLayer').value;
            
            // Remover capas existentes
            map.eachLayer(function(layer) {
                if (layer instanceof L.TileLayer) {
                    map.removeLayer(layer);
                }
            });
            
            let tileLayer;
            switch(layer) {
                case 'google':
                    tileLayer = L.tileLayer('https://mt1.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
                        attribution: 'Google Maps'
                    });
                    break;
                case 'satellite':
                    tileLayer = L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
                        attribution: 'Google Satellite'
                    });
                    break;
                case 'topo':
                    tileLayer = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                        attribution: 'OpenTopoMap'
                    });
                    break;
                default: // OSM
                    tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: 'OpenStreetMap'
                    });
            }
            
            tileLayer.addTo(map);
            showNotification(`Mapa cambiado a: ${layer}`, 'info');
        }

        // === BASE DE DATOS CON COVER FLOW ===
        function loadMineralsData() {
            // Datos de minerales de Atacama
            mineralsData = [
                { id: 1, name: "Calcopirita", formula: "CuFeS‚ÇÇ", class: "Sulfuro", hardness: 3.5, density: 4.2, color: "Amarillo lat√≥n", streak: "Verde negruzco", location: "Atacama" },
                { id: 2, name: "Malaquita", formula: "Cu‚ÇÇCO‚ÇÉ(OH)‚ÇÇ", class: "Carbonato", hardness: 3.5, density: 4.0, color: "Verde", streak: "Verde claro", location: "Atacama" },
                { id: 3, name: "Atacamita", formula: "Cu‚ÇÇCl(OH)‚ÇÉ", class: "Haluro", hardness: 3.5, density: 3.8, color: "Verde esmeralda", streak: "Verde manzana", location: "Atacama" },
                { id: 4, name: "Cobre Nativo", formula: "Cu", class: "Elemento", hardness: 2.5, density: 8.9, color: "Rojo cobre", streak: "Rojo met√°lico", location: "Andes" },
                { id: 5, name: "Crisocola", formula: "CuSiO‚ÇÉ¬∑nH‚ÇÇO", class: "Silicato", hardness: 2.5, density: 2.2, color: "Verde azulado", streak: "Blanco", location: "Atacama" },
                { id: 6, name: "Bornita", formula: "Cu‚ÇÖFeS‚ÇÑ", class: "Sulfuro", hardness: 3, density: 5.1, color: "P√∫rpura iridiscente", streak: "Gris negruzco", location: "Atacama" },
                { id: 7, name: "Cuarzo", formula: "SiO‚ÇÇ", class: "Silicato", hardness: 7, density: 2.65, color: "Variable", streak: "Blanco", location: "Andes" },
                { id: 8, name: "Hematita", formula: "Fe‚ÇÇO‚ÇÉ", class: "√ìxido", hardness: 6.5, density: 5.3, color: "Negro a rojo", streak: "Rojo cereza", location: "Atacama" },
                { id: 9, name: "Magnetita", formula: "Fe‚ÇÉO‚ÇÑ", class: "√ìxido", hardness: 6, density: 5.2, color: "Negro", streak: "Negro", location: "Atacama" },
                { id: 10, name: "Galena", formula: "PbS", class: "Sulfuro", hardness: 2.5, density: 7.6, color: "Gris plomo", streak: "Gris plomo", location: "Atacama" }
            ];
            
            updateCoverflow();
            document.getElementById('dataStatus').innerHTML = '<i class="fas fa-database"></i> Datos: Cargados';
        }

        function updateCoverflow() {
            const coverflow = document.getElementById('coverflow');
            coverflow.innerHTML = '';
            
            mineralsData.forEach((mineral, index) => {
                const card = document.createElement('div');
                card.className = 'mineral-card-flow';
                card.dataset.index = index;
                
                // Posicionamiento en cover flow
                const angle = (index - mineralsData.length/2) * 20;
                const z = Math.abs(index - mineralsData.length/2) * -20;
                const opacity = 1 - Math.abs(index - mineralsData.length/2) * 0.3;
                
                card.style.transform = `rotateY(${angle}deg) translateZ(${z}px)`;
                card.style.opacity = opacity;
                
                card.innerHTML = `
                    <div style="font-size:1.2rem; font-weight:bold; color:var(--primary);">
                        ${mineral.name}
                    </div>
                    <div style="font-size:0.8rem; color:#666; margin-top:5px;">
                        ${mineral.formula}
                    </div>
                    <div style="font-size:0.7rem; color:#999; margin-top:5px;">
                        Dureza: ${mineral.hardness}
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    // Actualizar todas las tarjetas
                    document.querySelectorAll('.mineral-card-flow').forEach(c => {
                        c.classList.remove('active');
                        const idx = parseInt(c.dataset.index);
                        const ang = (idx - mineralsData.length/2) * 20;
                        const zPos = Math.abs(idx - mineralsData.length/2) * -20;
                        const opac = 1 - Math.abs(idx - mineralsData.length/2) * 0.3;
                        c.style.transform = `rotateY(${ang}deg) translateZ(${zPos}px)`;
                        c.style.opacity = opac;
                    });
                    
                    // Activar esta tarjeta
                    card.classList.add('active');
                    card.style.transform = `rotateY(0deg) translateZ(100px)`;
                    card.style.opacity = 1;
                    
                    // Mostrar detalles
                    currentMineral = mineral;
                    displayMineralDetails(mineral);
                    
                    // Reorganizar cover flow
                    reorganizeCoverflow(index);
                });
                
                coverflow.appendChild(card);
            });
        }

        function reorganizeCoverflow(selectedIndex) {
            const cards = document.querySelectorAll('.mineral-card-flow');
            const total = cards.length;
            
            cards.forEach((card, index) => {
                const diff = index - selectedIndex;
                let angle, z, opacity;
                
                if (index === selectedIndex) {
                    angle = 0;
                    z = 100;
                    opacity = 1;
                } else {
                    angle = diff * 20;
                    z = Math.abs(diff) * -20;
                    opacity = 1 - Math.abs(diff) * 0.3;
                }
                
                card.style.transition = 'all 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
                card.style.transform = `rotateY(${angle}deg) translateZ(${z}px)`;
                card.style.opacity = opacity;
            });
        }

        function searchMinerals() {
            const searchTerm = document.getElementById('searchMinerals').value.toLowerCase();
            const filtered = mineralsData.filter(mineral => 
                mineral.name.toLowerCase().includes(searchTerm) ||
                mineral.formula.toLowerCase().includes(searchTerm) ||
                mineral.class.toLowerCase().includes(searchTerm)
            );
            
            // Actualizar coverflow con resultados filtrados
            const coverflow = document.getElementById('coverflow');
            coverflow.innerHTML = '';
            
            filtered.forEach((mineral, index) => {
                const card = document.createElement('div');
                card.className = 'mineral-card-flow';
                card.dataset.index = index;
                
                const angle = (index - filtered.length/2) * 20;
                const z = Math.abs(index - filtered.length/2) * -20;
                const opacity = 1 - Math.abs(index - filtered.length/2) * 0.3;
                
                card.style.transform = `rotateY(${angle}deg) translateZ(${z}px)`;
                card.style.opacity = opacity;
                
                card.innerHTML = `
                    <div style="font-size:1.2rem; font-weight:bold; color:var(--primary);">
                        ${mineral.name}
                    </div>
                    <div style="font-size:0.8rem; color:#666; margin-top:5px;">
                        ${mineral.formula}
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    currentMineral = mineral;
                    displayMineralDetails(mineral);
                });
                
                coverflow.appendChild(card);
            });
        }

        // === HERRAMIENTAS ===
        function openToolModal(tool) {
            const modal = document.getElementById('toolModal');
            const title = document.getElementById('modalTitle');
            const content = document.getElementById('modalContent');
            
            switch(tool) {
                case 'mohs':
                    title.innerHTML = '<i class="fas fa-gem"></i> Escala de Mohs';
                    content.innerHTML = generateMohsContent();
                    break;
                case 'compass':
                    title.innerHTML = '<i class="fas fa-compass"></i> Br√∫jula Digital';
                    content.innerHTML = generateCompassContent();
                    break;
                case 'converter':
                    title.innerHTML = '<i class="fas fa-balance-scale"></i> Conversor de Unidades';
                    content.innerHTML = generateConverterContent();
                    break;
                case 'streak':
                    title.innerHTML = '<i class="fas fa-palette"></i> Colores de Raya';
                    content.innerHTML = generateStreakContent();
                    break;
                case 'weather':
                    title.innerHTML = '<i class="fas fa-cloud-sun"></i> Clima Atacama';
                    content.innerHTML = generateWeatherContent();
                    break;
                case 'geology':
                    title.innerHTML = '<i class="fas fa-mountain"></i> Geolog√≠a de Atacama';
                    content.innerHTML = generateGeologyContent();
                    break;
            }
            
            modal.classList.add('active');
        }

        function generateMohsContent() {
            const mohsScale = [
                { number: 1, mineral: "Talco", example: "Se raya con la u√±a" },
                { number: 2, mineral: "Yeso", example: "Se raya con la u√±a" },
                { number: 3, mineral: "Calcita", example: "Se raya con una moneda de cobre" },
                { number: 4, mineral: "Fluorita", example: "Se raya con un cuchillo" },
                { number: 5, mineral: "Apatito", example: "Se raya con un cuchillo" },
                { number: 6, mineral: "Ortosa", example: "Raya al vidrio" },
                { number: 7, mineral: "Cuarzo", example: "Raya al vidrio f√°cilmente" },
                { number: 8, mineral: "Topacio", example: "Raya al cuarzo" },
                { number: 9, mineral: "Corind√≥n", example: "Raya al topacio" },
                { number: 10, mineral: "Diamante", example: "El m√°s duro" }
            ];
            
            let html = `
                <div style="text-align:center; padding:20px;">
                    <h3>Escala de Dureza de Mohs</h3>
                    <p style="color:#666; margin-bottom:20px;">Compara la dureza de los minerales</p>
                    
                    <div class="mohs-scale">
            `;
            
            mohsScale.forEach(item => {
                html += `
                    <div class="mohs-item" style="grid-column: span 1;">
                        <div style="font-size:1.5rem; font-weight:bold;">${item.number}</div>
                        <div style="font-size:0.8rem;">${item.mineral}</div>
                        <div style="font-size:0.7rem; margin-top:5px;">${item.example}</div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                    
                    <div style="margin-top:30px; padding:20px; background:#f8f9fa; border-radius:10px;">
                        <h4><i class="fas fa-lightbulb"></i> C√≥mo usar:</h4>
                        <p>Intenta rayar el mineral con objetos de referencia:</p>
                        <ul style="text-align:left; margin-top:10px;">
                            <li>U√±a humana (2.5)</li>
                            <li>Moneda de cobre (3.5)</li>
                            <li>Navaja/cuchillo (5.5)</li>
                            <li>Vidrio (5.5)</li>
                            <li>Lima de acero (6.5)</li>
                        </ul>
                    </div>
                </div>
            `;
            
            return html;
        }

        function generateCompassContent() {
            return `
                <div style="text-align:center; padding:20px;">
                    <h3>Br√∫jula Digital</h3>
                    <p style="color:#666; margin-bottom:20px;">Calibrada para trabajo de campo</p>
                    
                    <div class="compass-container">
                        <div class="compass">
                            <div class="compass-needle" id="compassNeedle"></div>
                            <div style="position:absolute; top:10px; left:50%; transform:translateX(-50%); color:var(--danger);">
                                N
                            </div>
                            <div style="position:absolute; bottom:10px; left:50%; transform:translateX(-50%);">
                                S
                            </div>
                            <div style="position:absolute; left:10px; top:50%; transform:translateY(-50%);">
                                O
                            </div>
                            <div style="position:absolute; right:10px; top:50%; transform:translateY(-50%);">
                                E
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top:20px; font-size:1.2rem;" id="compassHeading">
                        0¬∞
                    </div>
                    <div style="color:#666; margin-bottom:20px;" id="compassDirection">
                        Norte
                    </div>
                    
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:20px;">
                        <div style="padding:10px; background:#f8f9fa; border-radius:5px;">
                            <strong>Inclinaci√≥n</strong>
                            <div id="compassTilt">0¬∞</div>
                        </div>
                        <div style="padding:10px; background:#f8f9fa; border-radius:5px;">
                            <strong>Calibraci√≥n</strong>
                            <div id="compassCalibration">${compassCalibration}¬∞</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="calibrateCompass()" style="margin-top:20px;">
                        <i class="fas fa-sync-alt"></i> Calibrar Br√∫jula
                    </button>
                    
                    <div style="margin-top:20px; padding:15px; background:#e8f4fc; border-radius:10px;">
                        <h4><i class="fas fa-info-circle"></i> Instrucciones:</h4>
                        <p>Gira el dispositivo para alinear con el norte magn√©tico. 
                        Mant√©n alejado de objetos met√°licos para mayor precisi√≥n.</p>
                    </div>
                </div>
            `;
        }

        function handleCompass(event) {
            if (!event.alpha) return;
            
            let heading = event.alpha; // 0-360
            heading = (heading + compassCalibration) % 360;
            
            const needle = document.getElementById('compassNeedle');
            const headingElement = document.getElementById('compassHeading');
            const directionElement = document.getElementById('compassDirection');
            const tiltElement = document.getElementById('compassTilt');
            
            if (needle) {
                needle.style.transform = `translate(-50%, -100%) rotate(${heading}deg)`;
            }
            
            if (headingElement) {
                headingElement.textContent = `${Math.round(heading)}¬∞`;
            }
            
            if (directionElement) {
                const directions = ['N', 'NE', 'E', 'SE', 'S', 'SO', 'O', 'NO'];
                const index = Math.round(heading / 45) % 8;
                directionElement.textContent = directions[index];
            }
            
            if (tiltElement && event.beta) {
                tiltElement.textContent = `${Math.round(event.beta)}¬∞`;
            }
        }

        function calibrateCompass() {
            compassCalibration = (compassCalibration + 45) % 360;
            showNotification(`Br√∫jula calibrada: ${compassCalibration}¬∞`, 'success');
            
            const calElement = document.getElementById('compassCalibration');
            if (calElement) {
                calElement.textContent = `${compassCalibration}¬∞`;
            }
        }

        function generateConverterContent() {
            return `
                <div style="padding:20px;">
                    <h3 style="text-align:center; margin-bottom:20px;">Conversor de Unidades</h3>
                    
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
                        <!-- Longitud -->
                        <div>
                            <h4><i class="fas fa-ruler"></i> Longitud</h4>
                            <input type="number" class="form-control" id="lengthInput" placeholder="Valor" 
                                   style="margin-bottom:10px;" value="1">
                            <select class="form-control" id="lengthFrom" style="margin-bottom:10px;">
                                <option value="m">Metros (m)</option>
                                <option value="km">Kil√≥metros (km)</option>
                                <option value="ft">Pies (ft)</option>
                                <option value="mi">Millas (mi)</option>
                            </select>
                            <select class="form-control" id="lengthTo" style="margin-bottom:10px;">
                                <option value="m">Metros (m)</option>
                                <option value="km">Kil√≥metros (km)</option>
                                <option value="ft">Pies (ft)</option>
                                <option value="mi">Millas (mi)</option>
                            </select>
                            <button class="btn btn-primary" onclick="convertLength()" style="width:100%;">
                                Convertir
                            </button>
                            <div id="lengthResult" style="margin-top:10px; padding:10px; background:#f8f9fa; border-radius:5px;">
                                Resultado: --
                            </div>
                        </div>
                        
                        <!-- Masa -->
                        <div>
                            <h4><i class="fas fa-weight"></i> Masa</h4>
                            <input type="number" class="form-control" id="massInput" placeholder="Valor" 
                                   style="margin-bottom:10px;" value="1">
                            <select class="form-control" id="massFrom" style="margin-bottom:10px;">
                                <option value="g">Gramos (g)</option>
                                <option value="kg">Kilogramos (kg)</option>
                                <option value="oz">Onzas (oz)</option>
                                <option value="lb">Libras (lb)</option>
                            </select>
                            <select class="form-control" id="massTo" style="margin-bottom:10px;">
                                <option value="g">Gramos (g)</option>
                                <option value="kg">Kilogramos (kg)</option>
                                <option value="oz">Onzas (oz)</option>
                                <option value="lb">Libras (lb)</option>
                            </select>
                            <button class="btn btn-primary" onclick="convertMass()" style="width:100%;">
                                Convertir
                            </button>
                            <div id="massResult" style="margin-top:10px; padding:10px; background:#f8f9fa; border-radius:5px;">
                                Resultado: --
                            </div>
                        </div>
                    </div>
                    
                    <!-- Conversi√≥n de Coordenadas -->
                    <div style="margin-top:30px;">
                        <h4><i class="fas fa-globe-americas"></i> Coordenadas</h4>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;">
                            <div>
                                <input type="text" class="form-control" id="coordDD" 
                                       placeholder="DD: -27.3667, -70.3333" style="margin-bottom:10px;">
                                <button class="btn btn-secondary" onclick="convertToDMS()" style="width:100%;">
                                    DD ‚Üí DMS
                                </button>
                            </div>
                            <div>
                                <input type="text" class="form-control" id="coordDMS" 
                                       placeholder="DMS: 27¬∞22'0\"S, 70¬∞20'0\"W" style="margin-bottom:10px;">
                                <button class="btn btn-secondary" onclick="convertToDD()" style="width:100%;">
                                    DMS ‚Üí DD
                                </button>
                            </div>
                        </div>
                        <div id="coordResult" style="margin-top:10px; padding:10px; background:#f8f9fa; border-radius:5px;">
                            Resultado: --
                        </div>
                    </div>
                </div>
            `;
        }

        function convertLength() {
            const value = parseFloat(document.getElementById('lengthInput').value);
            const from = document.getElementById('lengthFrom').value;
            const to = document.getElementById('lengthTo').value;
            
            const conversions = {
                m: 1,
                km: 0.001,
                ft: 3.28084,
                mi: 0.000621371
            };
            
            const result = value * (conversions[to] / conversions[from]);
            document.getElementById('lengthResult').innerHTML = `
                <strong>${value} ${from} = ${result.toFixed(6)} ${to}</strong>
            `;
        }

        function convertMass() {
            const value = parseFloat(document.getElementById('massInput').value);
            const from = document.getElementById('massFrom').value;
            const to = document.getElementById('massTo').value;
            
            const conversions = {
                g: 1,
                kg: 0.001,
                oz: 0.035274,
                lb: 0.00220462
            };
            
            const result = value * (conversions[to] / conversions[from]);
            document.getElementById('massResult').innerHTML = `
                <strong>${value} ${from} = ${result.toFixed(6)} ${to}</strong>
            `;
        }

        function convertToDMS() {
            const dd = document.getElementById('coordDD').value;
            const coords = dd.split(',').map(c => parseFloat(c.trim()));
            
            if (coords.length === 2 && !isNaN(coords[0]) && !isNaN(coords[1])) {
                const lat = ddToDms(coords[0], true);
                const lng = ddToDms(coords[1], false);
                document.getElementById('coordResult').innerHTML = `
                    <strong>${lat}, ${lng}</strong>
                `;
                document.getElementById('coordDMS').value = `${lat}, ${lng}`;
            }
        }

        function ddToDms(dd, isLat) {
            const dir = isLat ? (dd >= 0 ? 'N' : 'S') : (dd >= 0 ? 'E' : 'W');
            const absDd = Math.abs(dd);
            const deg = Math.floor(absDd);
            const min = Math.floor((absDd - deg) * 60);
            const sec = ((absDd - deg - min/60) * 3600).toFixed(2);
            
            return `${deg}¬∞${min}'${sec}"${dir}`;
        }

        function generateStreakContent() {
            const streakColors = [
                { name: "Rojo", color: "#e74c3c", examples: "Hematita, Cinabrio" },
                { name: "Amarillo", color: "#f1c40f", examples: "Azufre, Oropimente" },
                { name: "Negro", color: "#2c3e50", examples: "Magnetita, Cromita" },
                { name: "Blanco", color: "#ecf0f1", examples: "Cuarzo, Calcita" },
                { name: "Verde", color: "#27ae60", examples: "Malaquita, Atacamita" },
                { name: "Gris", color: "#7f8c8d", examples: "Galena, Grafito" },
                { name: "Marr√≥n", color: "#a0522d", examples: "Goethita, Limonita" },
                { name: "Azul", color: "#3498db", examples: "Azurita, Lazurita" },
                { name: "Violeta", color: "#9b59b6", examples: "Fluorita, Lepidolita" },
                { name: "Anaranjado", color: "#e67e22", examples: "Realgar, Vanadinita" }
            ];
            
            let html = `
                <div style="text-align:center; padding:20px;">
                    <h3>Colores de Raya de Minerales</h3>
                    <p style="color:#666; margin-bottom:20px;">El color del polvo del mineral</p>
                    
                    <div class="streak-colors">
            `;
            
            streakColors.forEach(item => {
                html += `
                    <div class="streak-color" style="background:${item.color};" 
                         onclick="selectStreakColor('${item.name}')">
                        <div style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
                            ${item.name}
                        </div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                    
                    <div id="selectedStreak" style="margin:20px 0; padding:15px; background:#f8f9fa; border-radius:10px;">
                        <h4>Color seleccionado: <span id="currentStreak">Ninguno</span></h4>
                        <p id="streakExamples" style="color:#666;">Selecciona un color para ver ejemplos</p>
                    </div>
                    
                    <div style="margin-top:20px; padding:15px; background:#e8f4fc; border-radius:10px;">
                        <h4><i class="fas fa-info-circle"></i> C√≥mo realizar la prueba de raya:</h4>
                        <ol style="text-align:left; margin-top:10px; padding-left:20px;">
                            <li>Usa una placa de porcelana sin vidriar</li>
                            <li>Frota el mineral contra la placa</li>
                            <li>Observa el color del polvo dejado</li>
                            <li>Compara con la tabla de colores</li>
                        </ol>
                        <p style="margin-top:10px;"><strong>Nota:</strong> El color de raya puede ser diferente al color del mineral.</p>
                    </div>
                </div>
            `;
            
            return html;
        }

        function selectStreakColor(colorName) {
            const streakData = {
                "Rojo": { examples: "Hematita, Cinabrio, Rejalgar" },
                "Amarillo": { examples: "Azufre, Oropimente, Limonita" },
                "Negro": { examples: "Magnetita, Cromita, Ilmenita" },
                "Blanco": { examples: "Cuarzo, Calcita, Yeso" },
                "Verde": { examples: "Malaquita, Atacamita, Crisocola" },
                "Gris": { examples: "Galena, Grafito, Molibdenita" },
                "Marr√≥n": { examples: "Goethita, Limonita, Siderita" },
                "Azul": { examples: "Azurita, Lazurita, Calcantita" },
                "Violeta": { examples: "Fluorita, Lepidolita, Amatista" },
                "Anaranjado": { examples: "Realgar, Vanadinita, Wulfenita" }
            };
            
            document.getElementById('currentStreak').textContent = colorName;
            document.getElementById('streakExamples').innerHTML = `
                <strong>Minerales t√≠picos:</strong> ${streakData[colorName].examples}
            `;
        }

        // === FUNCIONES DE AN√ÅLISIS Y REPORTES ===
        async function analyzeWithAI() {
            showNotification('Analizando muestra con IA...', 'info');
            
            // Simulaci√≥n de an√°lisis IA
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Seleccionar mineral aleatorio de la base de datos
            const randomIndex = Math.floor(Math.random() * mineralsData.length);
            currentMineral = mineralsData[randomIndex];
            
            // Actualizar reporte
            if (currentReport) {
                currentReport.mineral = currentMineral;
                currentReport.analysis = {
                    confidence: (75 + Math.random() * 20).toFixed(1) + '%',
                    method: 'An√°lisis IA por imagen',
                    timestamp: new Date().toISOString()
                };
            }
            
            displayMineralDetails(currentMineral);
            updateCoverflowSelection(randomIndex);
            
            showNotification(`Mineral identificado: ${currentMineral.name}`, 'success');
        }

        function displayMineralDetails(mineral) {
            const container = document.getElementById('mineralDetails');
            const loading = document.getElementById('detailsLoading');
            
            if (loading) loading.style.display = 'none';
            
            container.innerHTML = `
                <div class="fade-in">
                    <h3 style="color:var(--primary); margin-bottom:10px;">
                        ${mineral.name}
                        <span style="font-size:0.8rem; color:#666; font-weight:normal;">
                            (${mineral.formula})
                        </span>
                    </h3>
                    
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin:15px 0;">
                        <div style="padding:10px; background:#f8f9fa; border-radius:5px;">
                            <strong>Clase:</strong> ${mineral.class}
                        </div>
                        <div style="padding:10px; background:#f8f9fa; border-radius:5px;">
                            <strong>Dureza (Mohs):</strong> ${mineral.hardness}
                        </div>
                        <div style="padding:10px; background:#f8f9fa; border-radius:5px;">
                            <strong>Densidad:</strong> ${mineral.density} g/cm¬≥
                        </div>
                        <div style="padding:10px; background:#f8f9fa; border-radius:5px;">
                            <strong>Color:</strong> ${mineral.color}
                        </div>
                    </div>
                    
                    <div style="margin-top:15px; padding:15px; background:#e8f4fc; border-radius:10px;">
                        <h4><i class="fas fa-info-circle"></i> Informaci√≥n:</h4>
                        <p>${mineral.name} es un mineral t√≠pico de la Regi√≥n de ${mineral.location}. 
                        Su raya es de color ${mineral.streak.toLowerCase()}.</p>
                        
                        <div style="margin-top:10px;">
                            <strong>Ubicaci√≥n t√≠pica:</strong>
                            <span class="location-badge">
                                <i class="fas fa-map-marker-alt"></i> ${mineral.location}
                            </span>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateCoverflowSelection(index) {
            const cards = document.querySelectorAll('.mineral-card-flow');
            cards.forEach((card, i) => {
                card.classList.toggle('active', i === index);
            });
            reorganizeCoverflow(index);
        }

        async function generateFullReport() {
            if (!currentReport) {
                showNotification('Captura una muestra primero', 'warning');
                return;
            }
            
            showNotification('Generando informe completo...', 'info');
            
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            currentReport.summary = {
                mineral: currentMineral,
                location: currentLocation,
                zone: geologicalZone,
                weather: await getWeatherData(),
                compass: compassCalibration,
                timestamp: new Date().toISOString()
            };
            
            // Mostrar resumen
            document.getElementById('reportSummary').innerHTML = `
                <div class="fade-in">
                    <h3 style="color:var(--success); margin-bottom:15px;">
                        <i class="fas fa-check-circle"></i> Informe Generado
                    </h3>
                    
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin:10px 0;">
                        <div style="padding:10px; background:#f0f7ff; border-radius:5px;">
                            <strong>Mineral:</strong><br>${currentMineral.name}
                        </div>
                        <div style="padding:10px; background:#f0f7ff; border-radius:5px;">
                            <strong>Ubicaci√≥n:</strong><br>${currentLocation.latitude.toFixed(4)}, ${currentLocation.longitude.toFixed(4)}
                        </div>
                    </div>
                    
                    <div style="margin-top:15px; padding:15px; background:#e8f4fc; border-radius:10px;">
                        <h4><i class="fas fa-file-alt"></i> Contenido del Informe:</h4>
                        <ul style="padding-left:20px;">
                            <li>üì∏ Fotograf√≠a de la muestra</li>
                            <li>üìç Coordenadas GPS exactas</li>
                            <li>üó∫Ô∏è Ubicaci√≥n en mapa geol√≥gico</li>
                            <li>‚öíÔ∏è Datos mineral√≥gicos completos</li>
                            <li>üå§Ô∏è Condiciones clim√°ticas</li>
                            <li>üß≠ Orientaci√≥n magn√©tica</li>
                        </ul>
                    </div>
                </div>
            `;
            
            document.getElementById('downloadReport').disabled = false;
            showNotification('Informe listo para descargar', 'success');
        }

        async function downloadCurrentReport() {
            if (!currentReport) {
                showNotification('No hay informe para descargar', 'warning');
                return;
            }
            
            const reportData = {
                ...currentReport,
                app: "AtacamApp",
                version: "1.0",
                generated: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(reportData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `atacamapp_informe_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Informe descargado exitosamente', 'success');
        }

        // === FUNCIONES DE UTILIDAD ===
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            let icon = 'info-circle';
            let bgColor = 'var(--accent2)';
            
            switch(type) {
                case 'success':
                    icon = 'check-circle';
                    bgColor = 'var(--success)';
                    break;
                case 'error':
                    icon = 'exclamation-circle';
                    bgColor = 'var(--danger)';
                    break;
                case 'warning':
                    icon = 'exclamation-triangle';
                    bgColor = 'var(--warning)';
                    break;
            }
            
            notification.innerHTML = `<i class="fas fa-${icon}"></i> ${message}`;
            notification.style.background = bgColor;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse forwards';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function updateLocationDisplay() {
            if (!currentLocation) return;
            
            document.getElementById('currentLat').textContent = currentLocation.latitude.toFixed(6);
            document.getElementById('currentLng').textContent = currentLocation.longitude.toFixed(6);
            document.getElementById('currentAlt').textContent = currentLocation.altitude ? 
                `${currentLocation.altitude.toFixed(0)} msnm` : '-- msnm';
            document.getElementById('currentAcc').textContent = `${Math.round(currentLocation.accuracy)} m`;
            
            document.getElementById('locationStatus').innerHTML = 
                `<i class="fas fa-map-marker-alt"></i> ${getLocationName(currentLocation)}`;
        }

        function getLocationName(location) {
            // Determinar nombre basado en coordenadas de Atacama
            const lat = location.latitude;
            const lng = location.longitude;
            
            if (lat < -28) return "Sur de Atacama";
            if (lat < -27) return "Copiap√≥";
            if (lat < -26.5) return "Vallenar";
            if (lat < -26) return "Huasco";
            if (lat < -25) return "Salar de Atacama";
            return "Norte de Atacama";
        }

        function updateGeologicalZone() {
            if (!currentLocation) return;
            
            const alt = currentLocation.altitude || 0;
            let zone;
            
            if (alt > 3500) {
                zone = {
                    name: "Cordillera de los Andes",
                    type: "Andes",
                    description: "Zona volc√°nica activa con mineralizaci√≥n cupr√≠fera",
                    emoji: "‚õ∞Ô∏è"
                };
            } else if (alt > 1500) {
                zone = {
                    name: "Precordillera",
                    type: "Foothills",
                    description: "Zona de transici√≥n con vetas mineralizadas",
                    emoji: "üèûÔ∏è"
                };
            } else if (alt > 500) {
                zone = {
                    name: "Depresi√≥n Intermedia",
                    type: "Basin",
                    description: "Cuenca sedimentaria con dep√≥sitos minerales",
                    emoji: "üèúÔ∏è"
                };
            } else {
                zone = {
                    name: "Costa",
                    type: "Coastal",
                    description: "Zona costera con sedimentos marinos",
                    emoji: "üåä"
                };
            }
            
            geologicalZone = zone;
            document.getElementById('geologicalZone').innerHTML = `
                ${zone.emoji} ${zone.name}
                <div style="font-size:0.8rem; color:#666;">${zone.description}</div>
            `;
        }

        function updateGPSLocation() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    handleLocationSuccess,
                    handleLocationError,
                    { enableHighAccuracy: true, timeout: 10000 }
                );
                showNotification('Actualizando ubicaci√≥n GPS...', 'info');
            } else {
                showNotification('GPS no soportado', 'error');
            }
        }

        function handleLocationError(error) {
            console.error('GPS Error:', error);
            let message = 'Error GPS: ';
            
            switch(error.code) {
                case 1: message += 'Permiso denegado'; break;
                case 2: message += 'Posici√≥n no disponible'; break;
                case 3: message += 'Timeout'; break;
                default: message += 'Error desconocido';
            }
            
            showNotification(message, 'error');
            useSimulatedLocation();
        }

        function useSimulatedLocation() {
            currentLocation = {
                latitude: -27.3667 + (Math.random() - 0.5) * 0.1,
                longitude: -70.3333 + (Math.random() - 0.5) * 0.1,
                altitude: 1500 + Math.random() * 1000,
                accuracy: 50,
                timestamp: new Date()
            };
            
            updateLocationDisplay();
            updateGeologicalZone();
            updateMapLocation(currentLocation);
            
            document.getElementById('gpsStatus').innerHTML = 
                '<i class="fas fa-satellite"></i> GPS: Simulado';
        }

        async function getWeatherData() {
            // Datos clim√°ticos simulados para Atacama
            return {
                temperature: 24 + Math.random() * 8,
                humidity: 10 + Math.random() * 20,
                windSpeed: 5 + Math.random() * 15,
                conditions: ['Despejado', 'Parcialmente nublado', 'Soleado'][Math.floor(Math.random() * 3)],
                uvIndex: 8 + Math.random() * 4
            };
        }

        function generateWeatherContent() {
            return `
                <div style="text-align:center; padding:20px;">
                    <h3>Clima - Regi√≥n de Atacama</h3>
                    <p style="color:#666; margin-bottom:20px;">Condiciones actuales y pron√≥stico</p>
                    
                    <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:15px; margin:20px 0;">
                        <div style="padding:15px; background:#f8f9fa; border-radius:10px;">
                            <div style="font-size:2rem; color:#e74c3c;">
                                <i class="fas fa-thermometer-half"></i>
                            </div>
                            <div style="font-size:1.5rem; font-weight:bold;">24¬∞C</div>
                            <div style="font-size:0.9rem; color:#666;">Temperatura</div>
                        </div>
                        
                        <div style="padding:15px; background:#f8f9fa; border-radius:10px;">
                            <div style="font-size:2rem; color:#3498db;">
                                <i class="fas fa-tint"></i>
                            </div>
                            <div style="font-size:1.5rem; font-weight:bold;">15%</div>
                            <div style="font-size:0.9rem; color:#666;">Humedad</div>
                        </div>
                        
                        <div style="padding:15px; background:#f8f9fa; border-radius:10px;">
                            <div style="font-size:2rem; color:#27ae60;">
                                <i class="fas fa-wind"></i>
                            </div>
                            <div style="font-size:1.5rem; font-weight:bold;">12 km/h</div>
                            <div style="font-size:0.9rem; color:#666;">Viento</div>
                        </div>
                    </div>
                    
                    <div style="margin-top:20px; padding:15px; background:#e8f4fc; border-radius:10px;">
                        <h4><i class="fas fa-exclamation-triangle"></i> Recomendaciones para trabajo de campo:</h4>
                        <ul style="text-align:left; margin-top:10px; padding-left:20px;">
                            <li>Usar protecci√≥n solar (FPS 50+)</li>
                            <li>Mantenerse hidratado</li>
                            <li>Usar ropa adecuada para el desierto</li>
                            <li>Evitar horas de m√°ximo calor (12:00-16:00)</li>
                            <li>Llevar equipo de primeros auxilios</li>
                        </ul>
                    </div>
                    
                    <button class="btn btn-primary" onclick="updateWeather()" style="margin-top:20px;">
                        <i class="fas fa-sync-alt"></i> Actualizar Clima
                    </button>
                </div>
            `;
        }

        function generateGeologyContent() {
            return `
                <div style="padding:20px;">
                    <h3 style="text-align:center;">Geolog√≠a de la Regi√≥n de Atacama</h3>
                    
                    <div style="margin:20px 0; padding:20px; background:#f8f9fa; border-radius:10px;">
                        <h4><i class="fas fa-info-circle"></i> Caracter√≠sticas Principales:</h4>
                        <ul style="margin-top:10px; padding-left:20px;">
                            <li><strong>Zona metalog√©nica:</strong> Principal productor de cobre de Chile</li>
                            <li><strong>Edad geol√≥gica:</strong> Principalmente Jur√°sico a Mioceno</li>
                            <li><strong>Rocas:</strong> Andeasita, Granodiorita, Sedimentos</li>
                            <li><strong>Mineralizaci√≥n:</strong> Cobre, Oro, Plata, Hierro</li>
                            <li><strong>Estructuras:</strong> Sistema de fallas NNE-SSO</li>
                        </ul>
                    </div>
                    
                    <div style="margin:20px 0; padding:20px; background:#fff8e1; border-radius:10px;">
                        <h4><i class="fas fa-map-marked-alt"></i> Principales Distritos Mineros:</h4>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;">
                            <div style="padding:10px; background:white; border-radius:5px;">
                                <strong>Candelaria</strong><br>
                                <small>Mineral: Cobre, Oro</small>
                            </div>
                            <div style="padding:10px; background:white; border-radius:5px;">
                                <strong>Chuquicamata</strong><br>
                                <small>Mineral: Cobre</small>
                            </div>
                            <div style="padding:10px; background:white; border-radius:5px;">
                                <strong>El Salvador</strong><br>
                                <small>Mineral: Cobre</small>
                            </div>
                            <div style="padding:10px; background:white; border-radius:5px;">
                                <strong>Cha√±arcillo</strong><br>
                                <small>Mineral: Plata</small>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top:20px; padding:15px; background:#e8f4fc; border-radius:10px;">
                        <h4><i class="fas fa-lightbulb"></i> Datos Curiosos:</h4>
                        <ul style="margin-top:10px; padding-left:20px;">
                            <li>Atacama es el desierto m√°s √°rido del mundo</li>
                            <li>Contiene las mayores reservas de litio del planeta</li>
                            <li>La miner√≠a representa el 11% del PIB de Chile</li>
                            <li>Existen volcanes activos sobre los 6,000 msnm</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function updateWeather() {
            showNotification('Actualizando datos clim√°ticos...', 'info');
            setTimeout(() => {
                showNotification('Clima actualizado', 'success');
            }, 1000);
        }

        function clearAllData() {
            if (confirm('¬øEst√°s seguro de borrar todos los datos? Esta acci√≥n no se puede deshacer.')) {
                localStorage.clear();
                mineralsData = [];
                currentReport = null;
                currentMineral = null;
                
                updateCoverflow();
                document.getElementById('reportSummary').innerHTML = `
                    <p style="color:#666; text-align:center; padding:20px;">
                        <i class="fas fa-info-circle"></i><br>
                        Captura una muestra con la c√°mara para generar un informe...
                    </p>
                `;
                
                document.getElementById('downloadReport').disabled = true;
                document.getElementById('mineralDetails').innerHTML = `
                    <div class="loading" id="detailsLoading">
                        <i class="fas fa-spinner"></i>
                        <p>Selecciona un mineral...</p>
                    </div>
                `;
                
                showNotification('Todos los datos han sido borrados', 'success');
            }
        }

        function exportAllData() {
            const allData = {
                minerals: mineralsData,
                reports: currentReport ? [currentReport] : [],
                location: currentLocation,
                settings: {
                    compassCalibration,
                    geologicalZone
                },
                exported: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(allData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `atacamapp_datos_completos_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Todos los datos exportados', 'success');
        }

        function closeModal() {
            document.getElementById('toolModal').classList.remove('active');
        }

        // === INICIALIZAR AL CARGAR ===
        window.addEventListener('load', function() {
            // Verificar si es m√≥vil
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isMobile) {
                console.log('AtacamApp - Modo m√≥vil activado');
                // Configuraciones espec√≠ficas para m√≥vil
                document.body.style.fontSize = '16px'; // Tama√±o m√≠nimo para m√≥vil
            }
            
            // Configurar eventos t√°ctiles
            document.addEventListener('touchstart', function() {}, {passive: true});
            
            console.log('AtacamApp 100% funcional - Herminichiiiii! üöÄ');
        });
    </script>
</body>
</html>
