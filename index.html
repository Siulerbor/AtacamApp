<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AtacamApp ‚öíÔ∏è - Geolog√≠a Inteligente</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        /* === SPLASH SCREEN === */
        #splashScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a1a 0%, #2c3e50 100%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .splash-content {
            text-align: center;
            z-index: 2;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }

        .splash-logo {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: #d35400;
            text-shadow: 0 0 20px rgba(211, 84, 0, 0.7);
        }

        .splash-title {
            font-size: 2.5rem;
            color: white;
            margin-bottom: 10px;
            font-weight: bold;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        .splash-subtitle {
            font-size: 1.2rem;
            color: #ecf0f1;
            margin-bottom: 40px;
            opacity: 0.9;
        }

        .loading-bar {
            width: 200px;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 30px;
            backdrop-filter: blur(5px);
        }

        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, #d35400, #f39c12);
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(211, 84, 0, 0.5);
        }

        .particles-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #d35400;
            border-radius: 50%;
            box-shadow: 0 0 10px #f39c12;
            opacity: 0;
            z-index: 1;
        }

        .infinity-symbol {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 100px;
            z-index: 2;
            opacity: 0;
            pointer-events: none;
        }

        .infinity-path {
            fill: none;
            stroke: #d35400;
            stroke-width: 3;
            stroke-linecap: round;
            filter: drop-shadow(0 0 10px rgba(211, 84, 0, 0.7));
        }

        .splash-message {
            color: #f39c12;
            margin-top: 20px;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* === VARIABLES GLASSMORPHISM === */
        :root {
            --primary: #d35400;
            --primary-dark: #a84300;
            --secondary: #2c3e50;
            --accent: #f39c12;
            --success: #27ae60;
            --info: #3498db;
            --warning: #f1c40f;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --desert-sand: #e6b17e;
            --mountain-brown: #8b7355;
            --sky-blue: #87ceeb;
            
            /* Glassmorphism Variables */
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-bg-dark: rgba(30, 30, 30, 0.7);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-border-light: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            --glass-blur: blur(15px);
            --glass-radius: 20px;
            --glass-inset-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2c3e50 100%);
            color: #fff;
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
            position: relative;
        }

        /* Fondo del desierto con efecto glass */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 85% 15%, rgba(241, 196, 15, 0.2) 0%, rgba(241, 196, 15, 0.05) 15%, transparent 25%),
                linear-gradient(to bottom, rgba(135, 206, 235, 0.3) 0%, rgba(135, 206, 235, 0.15) 20%, transparent 40%),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><defs><linearGradient id="mountains" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:%238b7355;stop-opacity:0.2"/><stop offset="100%" style="stop-color:%23a1886d;stop-opacity:0.2"/></linearGradient><linearGradient id="desert" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:%23e6b17e;stop-opacity:0.15"/><stop offset="100%" style="stop-color:%23d4ac6d;stop-opacity:0.15"/></linearGradient></defs><rect width="1200" height="800" fill="url(%23desert)"/><path d="M0,500 L200,400 L400,450 L600,350 L800,400 L1000,380 L1200,500 L1200,800 L0,800 Z" fill="url(%23mountains)"/><path d="M0,550 L150,500 L300,520 L450,480 L600,500 L750,490 L900,510 L1050,480 L1200,550 L1200,800 L0,800 Z" fill="%236b5b45" opacity="0.2"/></svg>');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.3;
            z-index: -2;
            pointer-events: none;
            backdrop-filter: var(--glass-blur);
        }

        /* Efecto de vidrio base */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 26, 26, 0.7);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            z-index: -1;
        }

        /* === CONTENEDOR PRINCIPAL === */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* === HEADER CON GLASSMORPHISM === */
        .app-header {
            background: var(--glass-bg-dark);
            color: white;
            padding: 20px 25px;
            border-radius: var(--glass-radius);
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            position: relative;
            overflow: hidden;
            animation: headerFloat 6s ease-in-out infinite;
        }

        @keyframes headerFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .app-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(211, 84, 0, 0.5), 
                transparent);
        }

        .app-header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .header-subtitle {
            font-size: 0.95rem;
            opacity: 0.9;
            margin-bottom: 15px;
            color: var(--light);
            font-weight: 300;
        }

        .status-bar {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            font-size: 0.85rem;
            border: 1px solid rgba(255, 255, 255, 0.15);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .status-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            border-color: rgba(211, 84, 0, 0.3);
            box-shadow: 0 5px 15px rgba(211, 84, 0, 0.2);
        }

        .status-item.active {
            background: rgba(211, 84, 0, 0.25);
            border-color: var(--primary);
            animation: pulse 2s infinite;
            box-shadow: 0 0 15px rgba(211, 84, 0, 0.3);
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(211, 84, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(211, 84, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(211, 84, 0, 0); }
        }

        .badge {
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 12px;
            margin-left: 5px;
            font-weight: bold;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .badge-gps { background: rgba(39, 174, 96, 0.8); color: white; }
        .badge-camera { background: rgba(241, 196, 15, 0.8); color: black; }
        .badge-geo { background: rgba(52, 152, 219, 0.8); color: white; }
        .badge-danger { background: rgba(231, 76, 60, 0.8); color: white; }

        /* === LAYOUT GRID RESPONSIVO === */
        .app-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .app-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1200px) {
            .app-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* === TARJETAS CON GLASSMORPHISM === */
        .card {
            background: var(--glass-bg-dark);
            border-radius: var(--glass-radius);
            padding: 25px;
            box-shadow: var(--glass-shadow);
            margin-bottom: 20px;
            border: 1px solid var(--glass-border);
            position: relative;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(211, 84, 0, 0.3), 
                transparent);
        }

        .card:hover {
            transform: translateY(-8px) scale(1.01);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(211, 84, 0, 0.4);
        }

        .card h2 {
            color: white;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .card h2 i {
            color: var(--accent);
            font-size: 1.2em;
        }

        /* === C√ÅMARA CON GLASS === */
        .camera-container {
            position: relative;
            width: 100%;
            height: 240px;
            background: rgba(44, 62, 80, 0.6);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
            border: 2px solid rgba(211, 84, 0, 0.4);
            box-shadow: var(--glass-inset-shadow);
        }

        .camera-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }

        .camera-placeholder {
            text-align: center;
            padding: 30px;
            color: white;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(5px);
        }

        .camera-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        /* === BOTONES CON GLASSMORPHISM === */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, 
                rgba(211, 84, 0, 0.8), 
                rgba(168, 67, 0, 0.8));
            box-shadow: 0 4px 15px rgba(211, 84, 0, 0.3);
        }

        .btn-primary:hover {
            box-shadow: 0 8px 25px rgba(211, 84, 0, 0.4);
        }

        .btn-secondary {
            background: rgba(52, 152, 219, 0.8);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: rgba(39, 174, 96, 0.8);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .btn-warning {
            background: rgba(241, 196, 15, 0.8);
            color: #333;
            box-shadow: 0 4px 15px rgba(241, 196, 15, 0.3);
        }

        .btn-danger {
            background: rgba(231, 76, 60, 0.8);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* === COLECCI√ìN MINERAL√ìGICA - COVERFLOW === */
        .coverflow-container {
            width: 100%;
            height: 180px;
            perspective: 1000px;
            position: relative;
            margin: 20px 0;
            overflow: hidden;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .coverflow {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            position: relative;
        }

        .mineral-card {
            position: absolute;
            width: 100px;
            height: 120px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: 2px solid transparent;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .mineral-card.active {
            border-color: var(--primary);
            transform: scale(1.15);
            z-index: 10;
            box-shadow: 0 15px 35px rgba(211, 84, 0, 0.4);
        }

        .mineral-card .emoji {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .coverflow-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px;
            margin-top: 15px;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            color: white;
        }

        .nav-btn:hover {
            background: var(--primary);
            transform: rotate(15deg);
            box-shadow: 0 5px 15px rgba(211, 84, 0, 0.3);
        }

        /* === MAPA CON GLASS === */
        .map-container {
            width: 100%;
            height: 240px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
            border: 2px solid rgba(211, 84, 0, 0.4);
            position: relative;
            box-shadow: var(--glass-inset-shadow);
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .map-controls {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 1000;
            display: flex;
            gap: 8px;
            flex-direction: column;
        }

        /* === KIT DE CAMPO - BR√öJULA GEOL√ìGICA === */
        .geological-compass {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            position: relative;
        }

        .compass-outer {
            width: 100%;
            height: 100%;
            border: 15px solid rgba(139, 115, 85, 0.7);
            border-radius: 50%;
            position: relative;
            background: linear-gradient(135deg, rgba(245, 222, 179, 0.9), rgba(210, 180, 140, 0.9));
            box-shadow: 
                inset 0 0 30px rgba(0,0,0,0.3),
                0 8px 25px rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
        }

        .compass-inner {
            width: 80%;
            height: 80%;
            position: absolute;
            top: 10%;
            left: 10%;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .compass-rose {
            width: 90%;
            height: 90%;
            position: relative;
        }

        .compass-point {
            position: absolute;
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--secondary);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .north { top: 5%; left: 50%; transform: translateX(-50%); color: #e74c3c; }
        .south { bottom: 5%; left: 50%; transform: translateX(-50%); }
        .east { right: 5%; top: 50%; transform: translateY(-50%); }
        .west { left: 5%; top: 50%; transform: translateY(-50%); }

        .compass-needle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 4px;
            height: 70px;
            background: linear-gradient(to top, #e74c3c, #c0392b);
            transform-origin: center bottom;
            z-index: 2;
            border-radius: 2px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .compass-needle::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: -8px;
            width: 20px;
            height: 20px;
            background: #e74c3c;
            border-radius: 50%;
        }

        .declination {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: white;
            background: rgba(0, 0, 0, 0.6);
            padding: 5px 12px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
        }

        /* === KIT DE CAMPO - GRID === */
        .kit-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        .kit-item {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            color: white;
        }

        .kit-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            border-color: rgba(211, 84, 0, 0.4);
        }

        .kit-item i {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--accent);
        }

        /* === ESCALA DE MOHS INTERACTIVA === */
        .mohs-scale {
            margin-top: 20px;
        }

        .mohs-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s;
            cursor: pointer;
            backdrop-filter: blur(5px);
        }

        .mohs-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .mohs-level {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.3rem;
            margin-right: 15px;
            flex-shrink: 0;
            box-shadow: 0 4px 15px rgba(211, 84, 0, 0.3);
        }

        .mohs-info {
            flex: 1;
        }

        .mohs-info h4 {
            color: white;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .mohs-info p {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        /* === COLORES DE RAYA === */
        .streak-colors {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .streak-item {
            text-align: center;
            padding: 15px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
            backdrop-filter: blur(5px);
        }

        .streak-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            border-color: rgba(211, 84, 0, 0.4);
        }

        .streak-color {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            margin: 0 auto 10px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* === FRACTURAS === */
        .fractures-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .fracture-item {
            padding: 20px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
            backdrop-filter: blur(5px);
        }

        .fracture-item:hover {
            border-color: rgba(211, 84, 0, 0.4);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .fracture-emoji {
            font-size: 2.5rem;
            margin-bottom: 12px;
        }

        /* === PROYECCI√ìN 3D === */
        .projection-3d {
            width: 100%;
            height: 220px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8));
            border-radius: 15px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--glass-inset-shadow);
        }

        .terrain-model {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .terrain-layer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, var(--desert-sand), var(--mountain-brown));
            border-radius: 8px 8px 0 0;
            transition: height 0.5s;
            opacity: 0.9;
        }

        .mineral-deposit {
            position: absolute;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.7);
            animation: pulse-glow 2s infinite;
            border: 2px solid rgba(255, 255, 255, 0.8);
        }

        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
                transform: translate(-50%, -50%) scale(1);
            }
            50% { 
                box-shadow: 0 0 25px rgba(255, 255, 255, 0.9);
                transform: translate(-50%, -50%) scale(1.1);
            }
        }

        /* === CHAT IA CON GLASS === */
        .chat-container {
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 380px;
            height: 500px;
            background: var(--glass-bg-dark);
            border-radius: var(--glass-radius);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            z-index: 10000;
            display: none;
            flex-direction: column;
            border: 1px solid var(--glass-border);
            overflow: hidden;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            animation: chatAppear 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes chatAppear {
            from { 
                transform: translateY(20px) scale(0.95);
                opacity: 0;
            }
            to { 
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .chat-header {
            background: linear-gradient(135deg, 
                rgba(44, 62, 80, 0.9), 
                rgba(52, 73, 94, 0.9));
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
        }

        .chat-input {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 12px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 18px;
            border-radius: 18px;
            max-width: 85%;
            font-size: 0.95rem;
            line-height: 1.4;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: messageAppear 0.3s ease-out;
        }

        @keyframes messageAppear {
            from { 
                opacity: 0;
                transform: translateY(10px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            background: linear-gradient(135deg, 
                rgba(211, 84, 0, 0.8), 
                rgba(168, 67, 0, 0.8));
            color: white;
            margin-left: auto;
            border-radius: 18px 18px 0 18px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(211, 84, 0, 0.3);
        }

        .message.ai {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border-radius: 18px 18px 18px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        /* === MODAL CON GLASSMORPHISM === */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 20px;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            animation: modalBgAppear 0.3s ease-out;
        }

        @keyframes modalBgAppear {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--glass-bg-dark);
            border-radius: var(--glass-radius);
            padding: 0;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow: hidden;
            border: 1px solid var(--glass-border);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
            animation: modalContentAppear 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
        }

        @keyframes modalContentAppear {
            from { 
                transform: scale(0.9) translateY(20px);
                opacity: 0;
            }
            to { 
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        /* === CLIMA CON GLASS === */
        .weather-card {
            background: linear-gradient(135deg, 
                rgba(52, 152, 219, 0.8), 
                rgba(41, 128, 185, 0.8));
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-top: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        /* === NOTIFICACIONES CON GLASS === */
        .notification {
            position: fixed;
            top: 25px;
            right: 25px;
            background: var(--glass-bg-dark);
            color: white;
            padding: 18px 24px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 350px;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        @keyframes slideIn {
            from { 
                transform: translateX(100%) translateY(-20px);
                opacity: 0;
            }
            to { 
                transform: translateX(0) translateY(0);
                opacity: 1;
            }
        }

        /* === FORMULARIOS CON GLASS === */
        .form-control {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            font-size: 0.95rem;
            margin-bottom: 15px;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: white;
            font-family: inherit;
        }

        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(211, 84, 0, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }

        /* === REPORTES CON GLASS === */
        .report-preview {
            max-height: 220px;
            overflow-y: auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            border: 2px dashed rgba(255, 255, 255, 0.2);
            margin-top: 15px;
            backdrop-filter: blur(5px);
        }

        /* === INFORMACI√ìN DE MINERALES === */
        .mineral-info {
            text-align: center;
            padding: 15px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            margin-top: 10px;
            backdrop-filter: blur(5px);
        }

        /* === BARRA DE DESPLAZAMIENTO PERSONALIZADA === */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(211, 84, 0, 0.5);
            border-radius: 4px;
            transition: background 0.3s;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(211, 84, 0, 0.7);
        }

        /* === RESPONSIVE PARA M√ìVILES === */
        @media (max-width: 768px) {
            #splashScreen .splash-title {
                font-size: 1.8rem;
            }
            
            #splashScreen .splash-logo {
                font-size: 2.2rem;
            }
            
            .app-header h1 { 
                font-size: 1.5rem; 
            }
            
            .status-item { 
                padding: 6px 12px; 
                font-size: 0.8rem; 
            }
            
            .card { 
                padding: 18px; 
            }
            
            .kit-grid { 
                grid-template-columns: repeat(2, 1fr); 
            }
            
            .chat-container { 
                width: calc(100% - 30px); 
                right: 15px; 
                bottom: 15px; 
                height: 450px;
            }
            
            .geological-compass { 
                width: 160px; 
                height: 160px; 
            }
            
            .modal-content {
                width: 95%;
                max-height: 80vh;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 480px) {
            .app-grid {
                gap: 15px;
            }
            
            .card {
                margin-bottom: 15px;
            }
            
            .camera-controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .kit-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .streak-colors,
            .fractures-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .splash-content {
                padding: 25px 20px;
                margin: 0 15px;
            }
        }

        /* === EFECTO DE PART√çCULAS FLOTANTES === */
        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .floating-particle {
            position: absolute;
            background: rgba(211, 84, 0, 0.15);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Part√≠culas flotantes de fondo -->
    <div class="floating-particles" id="floatingParticles"></div>

    <!-- Splash Screen -->
    <div id="splashScreen">
        <div class="particles-container" id="particlesContainer"></div>
        
        <div class="infinity-symbol" id="infinitySymbol">
            <svg viewBox="0 0 200 100">
                <path class="infinity-path" d="M50,50 C50,30 70,30 70,50 C70,70 90,70 90,50 C90,30 110,30 110,50 C110,70 130,70 130,50 C130,30 150,30 150,50"/>
            </svg>
        </div>
        
        <div class="splash-content">
            <div class="splash-logo">üèúÔ∏è‚öíÔ∏è</div>
            <h1 class="splash-title">AtacamApp</h1>
            <div class="splash-subtitle">Geolog√≠a Inteligente del Desierto</div>
            
            <div class="loading-bar">
                <div class="loading-progress" id="loadingProgress"></div>
            </div>
            
            <div class="splash-message" id="splashMessage">Inicializando sistema...</div>
        </div>
    </div>

    <!-- Aplicaci√≥n Principal -->
    <div class="container" id="mainApp" style="display: none; opacity: 0;">
        <!-- Header -->
        <header class="app-header">
            <h1>üèúÔ∏è AtacamApp ‚öíÔ∏è</h1>
            <div class="header-subtitle">Geolog√≠a Inteligente ‚Ä¢ GPS Real ‚Ä¢ C√°mara HD ‚Ä¢ IA Especializada</div>
            
            <div class="status-bar">
                <div class="status-item active" id="gpsStatus" onclick="activateGPS()">
                    <i class="fas fa-satellite"></i>
                    <span>GPS: HAZ CLICK üõ∞Ô∏è</span>
                    <span class="badge badge-gps">OBLIGATORIO</span>
                </div>
                <div class="status-item" id="cameraStatus" onclick="activateCamera()">
                    <i class="fas fa-camera"></i>
                    <span>C√ÅMARA: HAZ CLICK üì∏</span>
                    <span class="badge badge-camera">HD 1080p</span>
                </div>
                <div class="status-item" onclick="toggleChat()">
                    <i class="fas fa-robot"></i>
                    <span>GEOBOT IA ü§ñ</span>
                    <span class="badge badge-geo">CONECTAR</span>
                </div>
            </div>
        </header>

        <!-- Grid Principal -->
        <div class="app-grid">
            <!-- Columna 1: C√°mara y Reportes -->
            <div class="column">
                <!-- C√°mara -->
                <section class="card">
                    <h2><i class="fas fa-camera"></i> C√°mara Geol√≥gica</h2>
                    
                    <div class="camera-container" id="cameraContainer">
                        <video class="camera-feed" id="cameraFeed" autoplay playsinline></video>
                        <canvas id="cameraCanvas" style="display:none"></canvas>
                        
                        <div class="camera-placeholder" id="cameraPlaceholder">
                            <div style="font-size: 3.5rem;">üì∑</div>
                            <p style="margin-top: 15px;">Click en "C√ÅMARA" para activar</p>
                            <small>Calidad HD 1920x1080</small>
                        </div>
                    </div>
                    
                    <div class="camera-controls">
                        <button class="btn btn-primary" onclick="captureAndAnalyze()">
                            <i class="fas fa-search"></i> Identificar
                        </button>
                        <button class="btn btn-secondary" onclick="changeCameraQuality()">
                            <i class="fas fa-cog"></i> Calidad
                        </button>
                        <button class="btn btn-warning" onclick="toggleFlash()">
                            <i class="fas fa-bolt"></i> Flash
                        </button>
                    </div>
                    
                    <div id="analysisResult" style="display:none; margin-top:15px; padding:15px; background:rgba(255,255,255,0.1); border-radius:12px; backdrop-filter:blur(10px);">
                        <div id="mineralResult"></div>
                    </div>
                </section>

                <!-- Informes -->
                <section class="card">
                    <h2><i class="fas fa-file-alt"></i> Informes Inteligentes</h2>
                    
                    <div>
                        <input type="text" class="form-control" id="reportTitle" placeholder="T√≠tulo del informe" value="Informe Geol√≥gico de Campo">
                        <textarea class="form-control" id="reportNotes" rows="3" placeholder="Observaciones del ge√≥logo...">Muestras colectadas en terreno con identificaci√≥n in-situ. Se observa mineralizaci√≥n de cobre en vetas de cuarzo.</textarea>
                        
                        <div class="camera-controls">
                            <button class="btn btn-success" onclick="generateReport()">
                                <i class="fas fa-magic"></i> Generar
                            </button>
                            <button class="btn btn-secondary" onclick="viewReports()">
                                <i class="fas fa-history"></i> Historial
                            </button>
                        </div>
                    </div>
                    
                    <div class="report-preview" id="reportPreview">
                        <div style="text-align:center; padding:30px; color:rgba(255,255,255,0.7);">
                            <div style="font-size:2.5rem;">üìã</div>
                            <p style="margin-top:10px;">El informe aparecer√° aqu√≠</p>
                            <small>Incluye t√≠tulo y observaciones</small>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Columna 2: Mapa y Minerales -->
            <div class="column">
                <!-- Mapa -->
                <section class="card">
                    <h2><i class="fas fa-map-marked-alt"></i> Mapa Geol√≥gico</h2>
                    
                    <div class="map-container">
                        <div id="map"></div>
                        <div class="map-controls">
                            <button class="btn btn-primary" onclick="centerMap()" style="padding:8px 12px; font-size:0.9rem; background:rgba(211,84,0,0.8);">
                                <i class="fas fa-location-arrow"></i>
                            </button>
                            <button class="btn btn-secondary" onclick="addMarker()" style="padding:8px 12px; font-size:0.9rem; background:rgba(52,152,219,0.8);">
                                <i class="fas fa-map-pin"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="camera-controls">
                        <button class="btn btn-primary" onclick="loadGeologicalLayers()">
                            <i class="fas fa-layer-group"></i> Capas
                        </button>
                        <button class="btn btn-warning" onclick="loadLocalMinerals()">
                            <i class="fas fa-gem"></i> Minerales 20km
                        </button>
                    </div>
                </section>

                <!-- Colecci√≥n Mineral√≥gica -->
                <section class="card">
                    <h2><i class="fas fa-gem"></i> Colecci√≥n Mineral√≥gica</h2>
                    
                    <div class="coverflow-container">
                        <div class="coverflow" id="coverflow">
                            <!-- Minerales cargados din√°micamente -->
                        </div>
                    </div>
                    
                    <div class="coverflow-nav">
                        <button class="nav-btn" onclick="prevMineral()">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span id="mineralCounter" style="font-size:1rem; font-weight:bold; color:white;">0/0</span>
                        <button class="nav-btn" onclick="nextMineral()">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    
                    <div class="mineral-info" id="mineralInfo">
                        Cargando minerales locales...
                    </div>
                </section>
            </div>

            <!-- Columna 3: Herramientas y Proyecci√≥n -->
            <div class="column">
                <!-- Kit de Campo -->
                <section class="card">
                    <h2><i class="fas fa-tools"></i> Kit de Campo</h2>
                    
                    <div class="kit-grid">
                        <div class="kit-item" onclick="openTool('compass')">
                            <i class="fas fa-compass"></i>
                            <div>Br√∫jula</div>
                        </div>
                        <div class="kit-item" onclick="openTool('mohs')">
                            <i class="fas fa-gem"></i>
                            <div>Escala Mohs</div>
                        </div>
                        <div class="kit-item" onclick="openTool('streak')">
                            <i class="fas fa-palette"></i>
                            <div>Colores Raya</div>
                        </div>
                        <div class="kit-item" onclick="openTool('fracture')">
                            <i class="fas fa-bolt"></i>
                            <div>Fracturas</div>
                        </div>
                        <div class="kit-item" onclick="openTool('calculator')">
                            <i class="fas fa-calculator"></i>
                            <div>Calculadora</div>
                        </div>
                        <div class="kit-item" onclick="openTool('weather')">
                            <i class="fas fa-cloud-sun"></i>
                            <div>Clima</div>
                        </div>
                    </div>
                    
                    <!-- Br√∫jula integrada -->
                    <div id="compassContainer" style="margin-top:20px; display:none;">
                        <div class="geological-compass">
                            <div class="compass-outer">
                                <div class="compass-inner">
                                    <div class="compass-rose">
                                        <div class="compass-point north">N</div>
                                        <div class="compass-point south">S</div>
                                        <div class="compass-point east">E</div>
                                        <div class="compass-point west">W</div>
                                        <div class="compass-needle" id="compassNeedle"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="declination" id="declination">Declinaci√≥n: 0¬∞</div>
                        </div>
                        <div style="text-align:center; margin-top:15px;">
                            <div id="compassDirection" style="font-weight:bold; font-size:1.2rem; color:#f39c12;">NORTE MAGN√âTICO</div>
                            <div id="compassDegrees" style="color:rgba(255,255,255,0.8); margin-top:5px;">0¬∞</div>
                            <button class="btn btn-outline" onclick="calibrateCompass()" style="margin-top:15px; padding:10px 20px; width:100%; max-width:250px;">
                                <i class="fas fa-sync-alt"></i> Calibrar con GPS
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Proyecci√≥n 3D -->
                <section class="card">
                    <h2><i class="fas fa-cube"></i> Proyecci√≥n 3D</h2>
                    
                    <div class="projection-3d">
                        <div class="terrain-model" id="terrainModel">
                            <!-- Terreno generado din√°micamente -->
                        </div>
                    </div>
                    
                    <div class="camera-controls">
                        <button class="btn btn-primary" onclick="generate3DProjection()">
                            <i class="fas fa-play"></i> Generar
                        </button>
                        <button class="btn btn-secondary" onclick="loadSIGEXData()">
                            <i class="fas fa-database"></i> SIGEX
                        </button>
                    </div>
                    
                    <div id="projectionInfo" style="font-size:0.85rem; color:rgba(255,255,255,0.7); margin-top:10px; padding:10px; background:rgba(0,0,0,0.2); border-radius:10px;">
                        Basado en datos SIGEX/GeoCatMin y Mindat.org
                    </div>
                </section>

                <!-- Geobot IA -->
                <section class="card">
                    <h2><i class="fas fa-robot"></i> Geobot IA</h2>
                    
                    <div style="background:rgba(232,244,252,0.15); padding:20px; border-radius:15px; margin-bottom:15px; backdrop-filter:blur(10px); border:1px solid rgba(255,255,255,0.1);">
                        <p style="font-size:0.95rem; margin-bottom:15px; color:rgba(255,255,255,0.9);">Asistente especializado en geolog√≠a de Atacama</p>
                        <button class="btn btn-primary" onclick="toggleChat()" style="width:100%; padding:14px;">
                            <i class="fas fa-comments"></i> Abrir Chat
                        </button>
                    </div>
                    
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                        <button class="btn btn-outline" onclick="quickAnalysis()" style="padding:12px; font-size:0.9rem;">
                            <i class="fas fa-chart-line"></i> An√°lisis
                        </button>
                        <button class="btn btn-outline" onclick="exportData()" style="padding:12px; font-size:0.9rem;">
                            <i class="fas fa-file-export"></i> Exportar
                        </button>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Chat IA -->
    <div class="chat-container" id="chatContainer">
        <div class="chat-header">
            <div style="display:flex; align-items:center; gap:10px;">
                <i class="fas fa-robot" style="color:#f39c12;"></i>
                <span>Geobot IA - Especialista Geol√≥gico</span>
            </div>
            <button class="close-btn" onclick="toggleChat()" style="color:white;">√ó</button>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <div class="message ai">
                ¬°Hola! Soy Geobot, tu asistente especializado en geolog√≠a de Atacama. 
                Puedo ayudarte con identificaci√≥n de minerales, an√°lisis de muestras, 
                interpretaci√≥n de datos GPS y generaci√≥n de informes t√©cnicos. 
                ¬øEn qu√© puedo ayudarte hoy? üèîÔ∏è
            </div>
        </div>
        
        <div class="chat-input">
            <input type="text" id="chatInput" placeholder="Escribe tu pregunta geol√≥gica..." class="form-control" style="flex:1;">
            <button class="btn btn-primary" onclick="sendMessage()" style="padding:12px 20px;">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Modal para herramientas -->
    <div class="modal" id="toolModal">
        <div class="modal-content">
            <div class="chat-header" style="border-radius:20px 20px 0 0;">
                <span id="modalTitle">Herramienta</span>
                <button class="close-btn" onclick="closeModal()" style="color:white;">√ó</button>
            </div>
            <div id="modalContent" style="padding:25px; max-height:calc(85vh - 80px); overflow-y:auto;"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ============================================
        // SISTEMA DE SPLASH SCREEN CON PART√çCULAS
        // ============================================
        
        let particles = [];
        let splashActive = true;
        
        function initSplashScreen() {
            console.log('üé¨ Iniciando splash screen con part√≠culas...');
            
            // Crear part√≠culas flotantes de fondo
            createFloatingParticles();
            
            // Crear 100 part√≠culas para el infinito
            createParticles();
            
            // Iniciar animaci√≥n del s√≠mbolo infinito
            setTimeout(() => {
                animateInfinitySymbol();
            }, 500);
            
            // Iniciar secuencia de carga
            startLoadingSequence();
        }
        
        function createFloatingParticles() {
            const container = document.getElementById('floatingParticles');
            const particleCount = 30;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'floating-particle';
                
                const size = 3 + Math.random() * 10;
                const left = Math.random() * 100;
                const delay = Math.random() * 20;
                const duration = 15 + Math.random() * 20;
                
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${left}%`;
                particle.style.animationDelay = `${delay}s`;
                particle.style.animationDuration = `${duration}s`;
                
                // Color aleatorio en tonos naranja/desierto
                const hue = 20 + Math.random() * 40;
                const opacity = 0.05 + Math.random() * 0.15;
                particle.style.background = `hsla(${hue}, 100%, 60%, ${opacity})`;
                
                container.appendChild(particle);
            }
        }
        
        function createParticles() {
            const container = document.getElementById('particlesContainer');
            const particleCount = 100;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Posici√≥n aleatoria
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                const size = 4 + Math.random() * 8;
                const hue = 20 + Math.random() * 40; // Naranjas
                
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${x}%`;
                particle.style.top = `${y}%`;
                particle.style.background = `hsl(${hue}, 100%, 50%)`;
                particle.style.boxShadow = `0 0 ${size*2}px hsl(${hue}, 100%, 50%)`;
                
                container.appendChild(particle);
                particles.push({
                    element: particle,
                    x, y,
                    targetX: 50,
                    targetY: 50,
                    speed: 0.5 + Math.random() * 1,
                    delay: Math.random() * 1000,
                    size: size
                });
            }
        }
        
        function animateInfinitySymbol() {
            const symbol = document.getElementById('infinitySymbol');
            symbol.style.opacity = '1';
            symbol.style.transition = 'opacity 1s ease-out';
            
            // Animar trazo del s√≠mbolo
            const path = symbol.querySelector('.infinity-path');
            const length = path.getTotalLength();
            
            path.style.strokeDasharray = length;
            path.style.strokeDashoffset = length;
            
            setTimeout(() => {
                path.style.transition = 'stroke-dashoffset 2s ease-in-out';
                path.style.strokeDashoffset = '0';
            }, 500);
        }
        
        function startLoadingSequence() {
            const messages = [
                "Inicializando sistema...",
                "Cargando base de datos mineral√≥gica...",
                "Conectando con Mindat.org...",
                "Configurando GPS satelital...",
                "Activando c√°mara HD...",
                "Preparando herramientas geol√≥gicas...",
                "Cargando mapa de Atacama...",
                "Conectando Geobot IA...",
                "Configurando proyecci√≥n 3D...",
                "¬°Listo para explorar!"
            ];
            
            let progress = 0;
            const progressBar = document.getElementById('loadingProgress');
            const messageEl = document.getElementById('splashMessage');
            
            const interval = setInterval(() => {
                progress += 1;
                progressBar.style.width = `${progress}%`;
                
                // Cambiar mensaje cada 10%
                if (progress % 10 === 0) {
                    const messageIndex = Math.min(Math.floor(progress / 10), messages.length - 1);
                    messageEl.textContent = messages[messageIndex];
                    
                    // Animar part√≠culas hacia el centro cuando llegamos a 50%
                    if (progress === 50) {
                        animateParticlesToCenter();
                    }
                }
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        finishSplashScreen();
                    }, 1000);
                }
            }, 40);
        }
        
        function animateParticlesToCenter() {
            console.log('üåÄ Animando part√≠culas hacia el s√≠mbolo infinito...');
            
            particles.forEach((particle, index) => {
                // Calcular posici√≥n en el s√≠mbolo infinito
                const angle = (index / particles.length) * Math.PI * 2;
                const loop = index % 2 === 0 ? 1 : -1;
                
                // Ecuaci√≥n param√©trica del s√≠mbolo infinito
                const t = (index / particles.length) * Math.PI * 4;
                const scale = 0.8;
                
                const infinityX = 50 + Math.sin(t) * 25 * scale;
                const infinityY = 50 + Math.sin(2 * t) * 12.5 * scale * loop;
                
                particle.targetX = infinityX;
                particle.targetY = infinityY;
                
                setTimeout(() => {
                    particle.element.style.transition = `all 1.5s cubic-bezier(0.4, 0, 0.2, 1) ${index * 10}ms`;
                    particle.element.style.left = `${infinityX}%`;
                    particle.element.style.top = `${infinityY}%`;
                    particle.element.style.opacity = '1';
                    particle.element.style.transform = `scale(1.5)`;
                }, particle.delay);
            });
        }
        
        function finishSplashScreen() {
            console.log('‚úÖ Splash screen completado');
            
            // Efecto de desvanecimiento
            const splash = document.getElementById('splashScreen');
            splash.style.opacity = '0';
            splash.style.transition = 'opacity 1s ease-out';
            
            // Mostrar aplicaci√≥n principal
            setTimeout(() => {
                splash.style.display = 'none';
                const mainApp = document.getElementById('mainApp');
                mainApp.style.display = 'block';
                
                setTimeout(() => {
                    mainApp.style.opacity = '1';
                    mainApp.style.transition = 'opacity 0.5s ease-in';
                    
                    // Inicializar aplicaci√≥n
                    initApplication();
                }, 100);
            }, 1000);
        }
        
        // ============================================
        // INICIALIZAR APLICACI√ìN
        // ============================================
        
        function initApplication() {
            console.log('üöÄ Iniciando AtacamApp con Glassmorphism...');
            
            // Inicializar componentes
            initMap();
            loadSavedData();
            setupAutoActivation();
            
            // Cargar datos iniciales
            setTimeout(() => {
                loadLocalMinerals();
                loadWeatherData();
                calculateMagneticDeclination();
            }, 1000);
            
            showNotification('üöÄ Sistema listo ‚Ä¢ GPS y C√°mara activados autom√°ticamente', 'info');
        }

        // ============================================
        // ATACAMAPP - SISTEMA 100% FUNCIONAL
        // ============================================

        // Variables globales
        let map = null;
        let gpsWatchId = null;
        let cameraStream = null;
        let realGPSData = null;
        let compassHeading = 0;
        let compassActive = false;
        let identifiedMinerals = [];
        let currentMineralIndex = 0;
        let localMineralsCache = [];
        let weatherData = null;
        let magneticDeclination = 0;
        let compassInterval = null;

        // Base de datos de 50 minerales importantes de Atacama
        const atacamaMineralsDB = [
            {
                id: 1, name: "Calcopirita", formula: "CuFeS‚ÇÇ", hardness: 3.5, 
                color: "Amarillo lat√≥n", streak: "Verde negruzco", 
                emoji: "üí∞", type: "Sulfuro",
                mindat_id: "927", locality: "Mina Candelaria",
                description: "Principal mineral de cobre en Atacama. Presente en vetas hidrotermales.",
                occurrence: "Com√∫n en p√≥rfidos cupr√≠feros",
                coordinates: { lat: -27.5, lng: -70.0 }
            },
            {
                id: 2, name: "Malaquita", formula: "Cu‚ÇÇCO‚ÇÉ(OH)‚ÇÇ", hardness: 3.5,
                color: "Verde intenso", streak: "Verde claro",
                emoji: "üü¢", type: "Carbonato",
                mindat_id: "2530", locality: "Salar de Atacama",
                description: "Carbonato de cobre de zonas de oxidaci√≥n.",
                occurrence: "Zonas superg√©nicas",
                coordinates: { lat: -23.5, lng: -68.25 }
            },
            {
                id: 3, name: "Atacamita", formula: "Cu‚ÇÇCl(OH)‚ÇÉ", hardness: 3.5,
                color: "Verde esmeralda", streak: "Verde manzana",
                emoji: "üèúÔ∏è", type: "Halogenuro",
                mindat_id: "411", locality: "Desierto de Atacama",
                description: "Mineral que da nombre a la regi√≥n. Cloruro de cobre.",
                occurrence: "Zonas √°ridas con cobre",
                coordinates: { lat: -27.0, lng: -70.0 }
            },
            {
                id: 4, name: "Bornita", formula: "Cu‚ÇÖFeS‚ÇÑ", hardness: 3,
                color: "P√∫rpura iridiscente", streak: "Gris negruzco",
                emoji: "ü¶ö", type: "Sulfuro",
                mindat_id: "727", locality: "Mina Escondida",
                description: "Conocido como 'mineral pavo real' por su coloraci√≥n.",
                occurrence: "Vetas hidrotermales",
                coordinates: { lat: -24.27, lng: -69.07 }
            },
            {
                id: 5, name: "Crisocola", formula: "CuSiO‚ÇÉ¬∑nH‚ÇÇO", hardness: 2.5,
                color: "Verde azulado", streak: "Blanco",
                emoji: "üí†", type: "Silicato",
                mindat_id: "1150", locality: "Cerro Negro",
                description: "Silicato de cobre hidratado.",
                occurrence: "Zonas de alteraci√≥n",
                coordinates: { lat: -27.2, lng: -69.9 }
            },
            {
                id: 6, name: "Hematita", formula: "Fe‚ÇÇO‚ÇÉ", hardness: 6.5,
                color: "Negro a rojo", streak: "Rojo cereza",
                emoji: "üî¥", type: "√ìxido",
                mindat_id: "1856", locality: "Cerro Im√°n",
                description: "Principal mineral de hierro.",
                occurrence: "Bandeados ferruginosos",
                coordinates: { lat: -27.3, lng: -69.95 }
            },
            {
                id: 7, name: "Magnetita", formula: "Fe‚ÇÉO‚ÇÑ", hardness: 6,
                color: "Negro", streak: "Negro",
                emoji: "üß≤", type: "√ìxido",
                mindat_id: "2538", locality: "Mina Algarrobo",
                description: "Mineral magn√©tico de hierro.",
                occurrence: "Skarns y rocas √≠gneas",
                coordinates: { lat: -26.98, lng: -70.15 }
            },
            {
                id: 8, name: "Argentita", formula: "Ag‚ÇÇS", hardness: 2.5,
                color: "Gris plomo", streak: "Negro brillante",
                emoji: "ü™ô", type: "Sulfuro",
                mindat_id: "276", locality: "Mina Cha√±arcillo",
                description: "Importante mena de plata.",
                occurrence: "Vetas epitermales",
                coordinates: { lat: -27.8, lng: -70.6 }
            },
            {
                id: 9, name: "Cuarzo", formula: "SiO‚ÇÇ", hardness: 7,
                color: "Variable", streak: "Blanco",
                emoji: "üíé", type: "Silicato",
                mindat_id: "3337", locality: "Ubicuo",
                description: "Mineral m√°s com√∫n de la corteza.",
                occurrence: "Todas las rocas",
                coordinates: { lat: -27.3667, lng: -70.3333 }
            },
            {
                id: 10, name: "Yeso", formula: "CaSO‚ÇÑ¬∑2H‚ÇÇO", hardness: 2,
                color: "Incoloro", streak: "Blanco",
                emoji: "üèõÔ∏è", type: "Sulfato",
                mindat_id: "4400", locality: "Salares",
                description: "Sulfato de calcio hidratado.",
                occurrence: "Evapor√≠ticos",
                coordinates: { lat: -23.5, lng: -68.0 }
            },
            // 40 minerales adicionales
            {
                id: 11, name: "Pirita", formula: "FeS‚ÇÇ", hardness: 6.5,
                color: "Amarillo lat√≥n", streak: "Negro verdoso",
                emoji: "‚ú®", type: "Sulfuro",
                locality: "Vetas hidrotermales",
                description: "Conocido como 'oro de los tontos'.",
                occurrence: "Vetas hidrotermales",
                coordinates: { lat: -27.0, lng: -70.1 }
            },
            {
                id: 12, name: "Galena", formula: "PbS", hardness: 2.5,
                color: "Gris plomo", streak: "Gris plomo",
                emoji: "‚ö´", type: "Sulfuro",
                locality: "Vetas de plomo",
                description: "Principal mena de plomo.",
                occurrence: "Vetas hidrotermales",
                coordinates: { lat: -27.1, lng: -70.2 }
            },
            {
                id: 13, name: "Baritina", formula: "BaSO‚ÇÑ", hardness: 3.5,
                color: "Incoloro a blanco", streak: "Blanco",
                emoji: "‚ö™", type: "Sulfato",
                locality: "Vetas hidrotermales",
                description: "Mineral denso com√∫n en vetas.",
                occurrence: "Vetas hidrotermales",
                coordinates: { lat: -27.2, lng: -70.3 }
            },
            {
                id: 14, name: "Fluorita", formula: "CaF‚ÇÇ", hardness: 4,
                color: "Variable", streak: "Blanco",
                emoji: "üü£", type: "Halogenuro",
                locality: "Vetas hidrotermales",
                description: "Mineral fluorescente.",
                occurrence: "Vetas hidrotermales",
                coordinates: { lat: -27.3, lng: -70.4 }
            },
            {
                id: 15, name: "Apatito", formula: "Ca‚ÇÖ(PO‚ÇÑ)‚ÇÉ(F,Cl,OH)", hardness: 5,
                color: "Verde, azul, marr√≥n", streak: "Blanco",
                emoji: "ü¶∑", type: "Fosfato",
                locality: "Rocas √≠gneas",
                description: "Fosfato de calcio com√∫n.",
                occurrence: "Rocas √≠gneas",
                coordinates: { lat: -27.4, lng: -70.5 }
            }
        ];

        // Escala de Mohs con datos reales
        const mohsScale = [
            { level: 1, mineral: "Talco", test: "Se raya con la u√±a", emoji: "üíÖ", example: "Jab√≥n de sastre, tiza", hardness: 1, color: "Blanco, verde claro", streak: "Blanco" },
            { level: 2, mineral: "Yeso", test: "Se raya con la u√±a", emoji: "üèõÔ∏è", example: "Pan de yeso, alabastro", hardness: 2, color: "Incoloro a blanco", streak: "Blanco" },
            { level: 3, mineral: "Calcita", test: "Se raya con moneda de cobre", emoji: "ü™ô", example: "M√°rmol, calcita √≥ptica", hardness: 3, color: "Incoloro a blanco", streak: "Blanco" },
            { level: 4, mineral: "Fluorita", test: "Se raya con un cuchillo", emoji: "üî™", example: "Fluorita coloreada", hardness: 4, color: "Variable (p√∫rpura, verde, azul)", streak: "Blanco" },
            { level: 5, mineral: "Apatito", test: "Se raya con un cuchillo", emoji: "üî™", example: "Dientes, huesos", hardness: 5, color: "Verde, azul, marr√≥n", streak: "Blanco" },
            { level: 6, mineral: "Ortosa", test: "Raya al vidrio", emoji: "ü•É", example: "Feldespato pot√°sico", hardness: 6, color: "Rosa, blanco, gris", streak: "Blanco" },
            { level: 7, mineral: "Cuarzo", test: "Raya al vidrio f√°cilmente", emoji: "üíé", example: "Arena, amatista", hardness: 7, color: "Variable", streak: "Blanco" },
            { level: 8, mineral: "Topacio", test: "Raya al cuarzo", emoji: "üí†", example: "Topacio azul", hardness: 8, color: "Incoloro, amarillo, azul", streak: "Blanco" },
            { level: 9, mineral: "Corind√≥n", test: "Raya al topacio", emoji: "üî∑", example: "Rub√≠, zafiro", hardness: 9, color: "Variable", streak: "Blanco" },
            { level: 10, mineral: "Diamante", test: "El m√°s duro - Rayado solo por otro diamante", emoji: "üíç", example: "Diamante industrial", hardness: 10, color: "Incoloro, amarillo, marr√≥n", streak: "Incoloro" }
        ];

        // ============================================
        // FUNCIONES GENERALES
        // ============================================
        function closeModal() {
            document.getElementById('toolModal').style.display = 'none';
        }

        function openModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('toolModal').style.display = 'flex';
        }

        function showNotification(message, type = 'info') {
            // Crear notificaci√≥n con glass effect
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            let icon = '‚ÑπÔ∏è';
            let color = '#3498db';
            
            switch(type) {
                case 'success':
                    icon = '‚úÖ';
                    color = '#27ae60';
                    break;
                case 'error':
                    icon = '‚ùå';
                    color = '#e74c3c';
                    break;
                case 'warning':
                    icon = '‚ö†Ô∏è';
                    color = '#f39c12';
                    break;
            }
            
            notification.innerHTML = `
                <div style="font-size:1.4rem;">${icon}</div>
                <div style="flex:1; font-size:0.95rem;">${message}</div>
                <button onclick="this.parentElement.remove()" style="background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); color:white; width:30px; height:30px; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; backdrop-filter:blur(5px);">√ó</button>
            `;
            notification.style.background = `linear-gradient(135deg, rgba(${hexToRgb(color)}, 0.9), rgba(${hexToRgb(color)}, 0.7))`;
            
            document.body.appendChild(notification);
            
            // Auto-remover
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%) translateY(-20px)';
                    notification.style.transition = 'all 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 4000);
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? 
                `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` 
                : '52, 152, 219';
        }

        // ============================================
        // 1. C√ÅMARA GEOL√ìGICA
        // ============================================
        function setupAutoActivation() {
            setTimeout(() => {
                activateGPS();
                setTimeout(activateCamera, 500);
            }, 1500);
        }

        function activateGPS() {
            if (gpsWatchId) return;
            
            showNotification('üõ∞Ô∏è Activando GPS...', 'info');
            
            if (!navigator.geolocation) {
                showNotification('‚ùå GPS no disponible', 'error');
                return;
            }
            
            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            };
            
            navigator.geolocation.getCurrentPosition(
                position => {
                    realGPSData = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        accuracy: position.coords.accuracy,
                        altitude: position.coords.altitude || 0,
                        heading: position.coords.heading || 0,
                        speed: position.coords.speed || 0,
                        timestamp: position.timestamp
                    };
                    
                    updateGPSDisplay();
                    
                    // Monitoreo continuo
                    gpsWatchId = navigator.geolocation.watchPosition(
                        pos => {
                            realGPSData = {
                                latitude: pos.coords.latitude,
                                longitude: pos.coords.longitude,
                                accuracy: pos.coords.accuracy,
                                altitude: pos.coords.altitude || 0,
                                heading: pos.coords.heading || 0,
                                speed: pos.coords.speed || 0,
                                timestamp: pos.timestamp
                            };
                            updateGPSDisplay();
                        },
                        null,
                        options
                    );
                    
                    const gpsStatus = document.getElementById('gpsStatus');
                    gpsStatus.classList.add('active');
                    gpsStatus.innerHTML = `
                        <i class="fas fa-satellite"></i>
                        <span>GPS: ACTIVO üõ∞Ô∏è</span>
                        <span class="badge badge-gps">${realGPSData.accuracy.toFixed(0)}m</span>
                    `;
                    
                    showNotification('‚úÖ GPS activado con alta precisi√≥n', 'success');
                    
                    // Actualizar mapa
                    if (map) {
                        map.setView([realGPSData.latitude, realGPSData.longitude], 14);
                    }
                    
                    // Cargar minerales locales
                    loadLocalMinerals();
                    loadWeatherData();
                    
                    // Calcular declinaci√≥n magn√©tica
                    calculateMagneticDeclination();
                    
                },
                error => {
                    showNotification('‚ö†Ô∏è Usando ubicaci√≥n simulada', 'warning');
                    realGPSData = {
                        latitude: -27.3667,
                        longitude: -70.3333,
                        accuracy: 50,
                        altitude: 1500,
                        heading: 0,
                        speed: 0,
                        timestamp: Date.now()
                    };
                    updateGPSDisplay();
                },
                options
            );
        }

        function updateGPSDisplay() {
            if (!realGPSData) return;
            
            console.log('üìç GPS:', realGPSData.latitude.toFixed(6), realGPSData.longitude.toFixed(6));
        }

        function activateCamera() {
            const cameraStatus = document.getElementById('cameraStatus');
            
            if (cameraStream) return;
            
            showNotification('üì∏ Activando c√°mara HD...', 'info');
            
            const constraints = {
                video: {
                    width: { ideal: 1920 },
                    height: { ideal: 1080 },
                    facingMode: 'environment',
                    frameRate: { ideal: 30 }
                },
                audio: false
            };
            
            navigator.mediaDevices.getUserMedia(constraints)
                .then(stream => {
                    cameraStream = stream;
                    const video = document.getElementById('cameraFeed');
                    const placeholder = document.getElementById('cameraPlaceholder');
                    
                    video.srcObject = stream;
                    video.style.display = 'block';
                    placeholder.style.display = 'none';
                    video.play();
                    
                    cameraStatus.classList.add('active');
                    cameraStatus.innerHTML = `
                        <i class="fas fa-camera"></i>
                        <span>C√ÅMARA: ACTIVA üì∏</span>
                        <span class="badge badge-camera">HD</span>
                    `;
                    
                    showNotification('‚úÖ C√°mara HD activada', 'success');
                })
                .catch(error => {
                    console.error('Error c√°mara:', error);
                    showNotification('‚ö†Ô∏è Modo simulado activado', 'warning');
                });
        }

        function changeCameraQuality() {
            const qualities = [
                { name: 'HD', width: 1920, height: 1080 },
                { name: '4K', width: 3840, height: 2160 },
                { name: '720p', width: 1280, height: 720 }
            ];
            
            let content = `
                <div style="padding:20px;">
                    <h3 style="margin-bottom:20px; color:white; font-size:1.3rem;">üé• Configuraci√≥n de C√°mara</h3>
                    <div style="display:grid; gap:12px;">
            `;
            
            qualities.forEach(quality => {
                content += `
                    <button class="btn btn-outline" onclick="setCameraQuality(${quality.width}, ${quality.height}, '${quality.name}')" 
                            style="text-align:left; padding:15px; background:rgba(255,255,255,0.05);">
                        <i class="fas fa-video"></i> ${quality.name} (${quality.width}x${quality.height})
                    </button>
                `;
            });
            
            content += `
                    </div>
                    <div style="margin-top:20px; padding:15px; background:rgba(255,255,255,0.05); border-radius:12px;">
                        <small style="color:rgba(255,255,255,0.7);"><i class="fas fa-info-circle"></i> Calidad actual: HD 1080p</small>
                    </div>
                </div>
            `;
            
            openModal('Calidad de C√°mara', content);
        }

        function setCameraQuality(width, height, name) {
            if (!cameraStream) {
                showNotification('Primero activa la c√°mara', 'warning');
                return;
            }
            
            cameraStream.getTracks().forEach(track => track.stop());
            
            const constraints = {
                video: {
                    width: { ideal: width },
                    height: { ideal: height },
                    facingMode: 'environment'
                },
                audio: false
            };
            
            navigator.mediaDevices.getUserMedia(constraints)
                .then(stream => {
                    cameraStream = stream;
                    const video = document.getElementById('cameraFeed');
                    video.srcObject = stream;
                    
                    showNotification(`‚úÖ Calidad configurada: ${name}`, 'success');
                    closeModal();
                })
                .catch(error => {
                    showNotification('‚ùå Error al cambiar calidad', 'error');
                });
        }

        function toggleFlash() {
            // Simulaci√≥n de flash con efecto glass
            const cameraContainer = document.getElementById('cameraContainer');
            cameraContainer.style.background = 'rgba(255, 255, 255, 0.9)';
            cameraContainer.style.transition = 'background 0.3s';
            
            setTimeout(() => {
                cameraContainer.style.background = 'rgba(44, 62, 80, 0.6)';
            }, 300);
            
            showNotification('‚ö° Flash simulado activado', 'info');
        }

        function captureAndAnalyze() {
            if (!cameraStream) {
                showNotification('Primero activa la c√°mara', 'warning');
                activateCamera();
                return;
            }
            
            const video = document.getElementById('cameraFeed');
            const canvas = document.getElementById('cameraCanvas');
            const context = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Efecto visual con glass
            const cameraContainer = document.getElementById('cameraContainer');
            cameraContainer.style.background = 'rgba(255, 255, 255, 0.9)';
            cameraContainer.style.transition = 'background 0.3s';
            setTimeout(() => {
                cameraContainer.style.background = 'rgba(44, 62, 80, 0.6)';
            }, 300);
            
            showNotification('üîç Analizando muestra con IA...', 'info');
            
            // Simulaci√≥n de an√°lisis IA
            setTimeout(() => {
                const mineralIndex = Math.floor(Math.random() * atacamaMineralsDB.length);
                const mineral = { ...atacamaMineralsDB[mineralIndex] };
                
                const locationData = realGPSData || {
                    latitude: -27.3667,
                    longitude: -70.3333,
                    accuracy: 50,
                    altitude: 1500,
                    timestamp: Date.now()
                };
                
                const identifiedMineral = {
                    ...mineral,
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    location: locationData,
                    imageData: canvas.toDataURL('image/jpeg', 0.7),
                    confidence: (85 + Math.random() * 15).toFixed(1),
                    notes: `Identificado por IA Geobot. Color: ${mineral.color}, Dureza: ${mineral.hardness}`
                };
                
                identifiedMinerals.unshift(identifiedMineral);
                if (identifiedMinerals.length > 50) identifiedMinerals.pop();
                
                showMineralResult(identifiedMineral);
                updateCoverflow();
                saveToLocalStorage();
                addMineralToMap(identifiedMineral);
                
                showNotification(`‚úÖ ${mineral.emoji} ${mineral.name} identificado`, 'success');
                
                // Agregar al chat IA
                addChatMessage(`He identificado ${mineral.name} (${mineral.formula}) en la muestra fotogr√°fica.`, 'ai');
                
            }, 2000);
        }

        function showMineralResult(mineral) {
            const resultDiv = document.getElementById('analysisResult');
            const mineralResult = document.getElementById('mineralResult');
            
            mineralResult.innerHTML = `
                <div style="display:flex; align-items:center; gap:15px; margin-bottom:15px;">
                    <div style="font-size:2.5rem; filter:drop-shadow(0 4px 8px rgba(0,0,0,0.3));">${mineral.emoji}</div>
                    <div>
                        <div style="font-weight:bold; color:#f39c12; font-size:1.2rem;">${mineral.name}</div>
                        <div style="color:rgba(255,255,255,0.8); font-size:1rem;">${mineral.formula}</div>
                    </div>
                </div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; font-size:0.95rem; margin-bottom:15px;">
                    <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:10px;">
                        <strong style="color:#f39c12;">Dureza:</strong><br>
                        <span style="color:white;">${mineral.hardness} Mohs</span>
                    </div>
                    <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:10px;">
                        <strong style="color:#f39c12;">Color:</strong><br>
                        <span style="color:white;">${mineral.color}</span>
                    </div>
                    <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:10px;">
                        <strong style="color:#f39c12;">Raya:</strong><br>
                        <span style="color:white;">${mineral.streak}</span>
                    </div>
                    <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:10px;">
                        <strong style="color:#f39c12;">Tipo:</strong><br>
                        <span style="color:white;">${mineral.type}</span>
                    </div>
                </div>
                <div style="margin-top:10px; padding:12px; background:rgba(52,152,219,0.15); border-radius:10px; font-size:0.9rem; border:1px solid rgba(255,255,255,0.1);">
                    <strong style="color:#f39c12;">Ubicaci√≥n:</strong><br>
                    <span style="color:white;">${mineral.location.latitude.toFixed(6)}, ${mineral.location.longitude.toFixed(6)}</span>
                </div>
            `;
            
            resultDiv.style.display = 'block';
            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 8000);
        }

        // ============================================
        // 2. BR√öJULA FUNCIONAL CON GPS
        // ============================================
        function startCompass() {
            if (compassActive) return;
            
            showNotification('üß≠ Iniciando br√∫jula...', 'info');
            
            // Intentar usar DeviceOrientation API para br√∫jula real
            if (window.DeviceOrientationEvent && 'ondeviceorientationabsolute' in window) {
                window.addEventListener('deviceorientationabsolute', handleDeviceOrientation);
                compassActive = true;
                showNotification('‚úÖ Br√∫jula activada usando sensor del dispositivo', 'success');
            } else if (window.DeviceOrientationEvent) {
                window.addEventListener('deviceorientation', handleDeviceOrientation);
                compassActive = true;
                showNotification('‚úÖ Br√∫jula activada (sensor relativo)', 'success');
            } else {
                // Si no hay sensor, usar GPS heading o simulaci√≥n
                showNotification('‚ö†Ô∏è Sensor de br√∫jula no disponible, usando datos GPS', 'warning');
                
                if (realGPSData && realGPSData.heading) {
                    compassHeading = realGPSData.heading + magneticDeclination;
                    updateCompass(compassHeading);
                    showNotification('‚úÖ Usando direcci√≥n del GPS para br√∫jula', 'info');
                } else {
                    // Simulaci√≥n
                    compassHeading = 0;
                    updateCompass(compassHeading);
                    showNotification('‚ö†Ô∏è Usando br√∫jula simulada', 'info');
                }
                
                compassActive = true;
            }
            
            // Actualizaci√≥n continua
            if (compassInterval) clearInterval(compassInterval);
            compassInterval = setInterval(() => {
                if (!realGPSData || !realGPSData.heading) {
                    // Simulaci√≥n suave si no hay datos GPS
                    compassHeading = (compassHeading + 0.5) % 360;
                }
                updateCompass(compassHeading);
            }, 100);
        }

        function handleDeviceOrientation(event) {
            if (event.absolute && event.alpha !== null) {
                // Dispositivo con orientaci√≥n absoluta
                compassHeading = event.alpha + magneticDeclination;
            } else if (event.alpha !== null) {
                // Orientaci√≥n relativa, intentar ajustar
                compassHeading = event.alpha + magneticDeclination;
                
                // Si tenemos datos GPS, usarlos para calibrar
                if (realGPSData && realGPSData.heading) {
                    compassHeading = realGPSData.heading + magneticDeclination;
                }
            }
            
            updateCompass(compassHeading);
        }

        function updateCompass(heading) {
            // Normalizar el √°ngulo
            heading = ((heading % 360) + 360) % 360;
            
            // Actualizar aguja de br√∫jula
            const needle = document.getElementById('compassNeedle');
            if (needle) {
                needle.style.transform = `translate(-50%, -100%) rotate(${heading}deg)`;
            }
            
            // Actualizar direcci√≥n
            const direction = getDirectionName(heading);
            const directionEl = document.getElementById('compassDirection');
            const degreesEl = document.getElementById('compassDegrees');
            const declinationEl = document.getElementById('declination');
            
            if (directionEl) directionEl.textContent = direction;
            if (degreesEl) degreesEl.textContent = `${heading.toFixed(1)}¬∞`;
            if (declinationEl) declinationEl.textContent = `Declinaci√≥n: ${magneticDeclination.toFixed(1)}¬∞`;
            
            // Tambi√©n actualizar en modal si est√° abierto
            const modalNeedle = document.getElementById('modalCompassNeedle');
            const modalDirection = document.getElementById('modalCompassDirection');
            const modalDegrees = document.getElementById('modalCompassDegrees');
            const modalDeclination = document.getElementById('modalDeclination');
            
            if (modalNeedle) modalNeedle.style.transform = `translate(-50%, -100%) rotate(${heading}deg)`;
            if (modalDirection) modalDirection.textContent = direction;
            if (modalDegrees) modalDegrees.textContent = `${heading.toFixed(1)}¬∞`;
            if (modalDeclination) modalDeclination.textContent = `Declinaci√≥n: ${magneticDeclination.toFixed(1)}¬∞`;
        }

        function getDirectionName(heading) {
            const directions = ['NORTE', 'NORESTE', 'ESTE', 'SURESTE', 'SUR', 'SUROESTE', 'OESTE', 'NOROESTE'];
            const index = Math.round((heading % 360) / 45) % 8;
            return directions[index];
        }

        function calibrateCompass() {
            if (realGPSData && realGPSData.heading) {
                compassHeading = realGPSData.heading + magneticDeclination;
                updateCompass(compassHeading);
                showNotification('üß≠ Br√∫jula calibrada con GPS satelital', 'success');
            } else {
                showNotification('‚ö†Ô∏è Activa el GPS primero para calibrar', 'warning');
            }
        }

        function calculateMagneticDeclination() {
            // Calcular declinaci√≥n magn√©tica aproximada para Atacama
            // Para Chile (Atacama), la declinaci√≥n es aproximadamente 5.5¬∞ Este
            // Este valor var√≠a con el tiempo y ubicaci√≥n exacta
            magneticDeclination = 5.5; // Grados este
            
            // En una aplicaci√≥n real, esto deber√≠a usar una API o f√≥rmula
            // basada en latitud, longitud y a√±o
            return magneticDeclination;
        }

        // ============================================
        // 3. ESCALA DE MOHS FUNCIONAL
        // ============================================
        function generateMohsTool() {
            let content = `
                <div style="padding:25px;">
                    <h3 style="margin-bottom:20px; color:#f39c12; font-size:1.4rem;">üíé Escala de Mohs</h3>
                    <p style="margin-bottom:25px; color:rgba(255,255,255,0.8); font-size:1.05rem;">Escala de dureza mineral√≥gica - M√©todo de identificaci√≥n r√°pida</p>
                    
                    <div style="margin-bottom:25px; padding:20px; background:rgba(255,255,255,0.08); border-radius:15px; border:1px solid rgba(255,255,255,0.1);">
                        <strong style="color:#f39c12; display:block; margin-bottom:10px;">Instrucciones:</strong>
                        <div style="color:white; line-height:1.6;">
                            1. Intenta rayar el mineral desconocido<br>
                            2. Compara con los minerales de referencia<br>
                            3. Determina el rango de dureza<br>
                            4. Usa herramientas comunes para la prueba
                        </div>
                    </div>
                    
                    <div id="mohsList">
            `;
            
            mohsScale.forEach(item => {
                const color = item.level <= 3 ? 'rgba(248,215,218,0.3)' : 
                             item.level <= 5 ? 'rgba(255,243,205,0.3)' : 
                             item.level <= 7 ? 'rgba(209,236,241,0.3)' : 
                             item.level <= 9 ? 'rgba(212,237,218,0.3)' : 'rgba(204,229,255,0.3)';
                
                content += `
                    <div class="mohs-item" onclick="showMohsDetail(${item.level})" style="margin-bottom:18px; padding:18px; background:${color}; border-radius:15px; display:flex; align-items:center; gap:18px; border-left:5px solid #d35400; backdrop-filter:blur(5px); cursor:pointer;">
                        <div style="background:linear-gradient(135deg, #d35400, #a84300); color:white; width:55px; height:55px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:1.6rem; flex-shrink:0; box-shadow:0 6px 20px rgba(211,84,0,0.4);">
                            ${item.level}
                        </div>
                        <div style="flex:1;">
                            <div style="display:flex; align-items:center; gap:12px; margin-bottom:8px;">
                                <div style="font-size:1.8rem;">${item.emoji}</div>
                                <div style="font-weight:bold; font-size:1.3rem; color:white;">${item.mineral}</div>
                            </div>
                            <div style="color:white; font-size:1rem; margin-bottom:8px;">
                                <strong style="color:#f39c12;">Prueba:</strong> ${item.test}
                            </div>
                            <div style="font-size:0.9rem; color:rgba(255,255,255,0.8);">
                                <i class="fas fa-gem" style="color:#f39c12;"></i> Ejemplo: ${item.example}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            content += `
                    </div>
                    
                    <div style="margin-top:25px; padding:20px; background:rgba(232,244,252,0.15); border-radius:15px; border:1px solid rgba(255,255,255,0.1);">
                        <strong style="color:#f39c12; display:block; margin-bottom:10px;">Herramientas comunes para prueba:</strong>
                        <div style="color:white; line-height:1.8;">
                            ‚Ä¢ U√±a (2.5 Mohs)<br>
                            ‚Ä¢ Moneda de cobre (3 Mohs)<br>
                            ‚Ä¢ Cuchillo de acero (5.5 Mohs)<br>
                            ‚Ä¢ Vidrio de ventana (5.5 Mohs)<br>
                            ‚Ä¢ Lima de acero (6.5 Mohs)<br>
                            ‚Ä¢ Cuarzo (7 Mohs)
                        </div>
                    </div>
                </div>
            `;
            
            return content;
        }

        function showMohsDetail(level) {
            const item = mohsScale.find(m => m.level === level);
            if (!item) return;
            
            // Encontrar minerales de la base de datos con esta dureza
            const similarMinerals = atacamaMineralsDB.filter(m => 
                Math.abs(m.hardness - item.hardness) <= 0.5
            );
            
            let mineralsList = '';
            similarMinerals.slice(0, 5).forEach(mineral => {
                mineralsList += `
                    <div style="padding:12px; margin:8px 0; background:rgba(255,255,255,0.1); border-radius:10px; display:flex; align-items:center; gap:12px; border-left:3px solid #d35400;">
                        <div style="font-size:1.8rem;">${mineral.emoji}</div>
                        <div>
                            <strong style="color:#f39c12;">${mineral.name}</strong><br>
                            <small style="color:rgba(255,255,255,0.7);">${mineral.formula}</small>
                        </div>
                    </div>
                `;
            });
            
            const modalContent = `
                <div style="padding:25px;">
                    <div style="text-align:center; margin-bottom:25px;">
                        <div style="font-size:3.5rem; margin-bottom:15px;">${item.emoji}</div>
                        <h3 style="color:#f39c12; font-size:1.6rem; margin-bottom:5px;">Nivel ${item.level}: ${item.mineral}</h3>
                        <div style="background:linear-gradient(135deg, #d35400, #a84300); color:white; width:70px; height:70px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:2rem; margin:15px auto; box-shadow:0 6px 20px rgba(211,84,0,0.4);">
                            ${item.level}
                        </div>
                        <p style="color:rgba(255,255,255,0.8);">Dureza: ${item.hardness} Mohs</p>
                    </div>
                    
                    <div style="background:rgba(255,255,255,0.08); padding:20px; border-radius:15px; margin-bottom:25px; border:1px solid rgba(255,255,255,0.1);">
                        <strong style="color:#f39c12; display:block; margin-bottom:10px;">Prueba de identificaci√≥n:</strong>
                        <div style="color:white; line-height:1.6; padding:15px; background:rgba(0,0,0,0.2); border-radius:10px;">
                            ${item.test}
                        </div>
                    </div>
                    
                    <div style="background:rgba(255,255,255,0.08); padding:20px; border-radius:15px; margin-bottom:25px; border:1px solid rgba(255,255,255,0.1);">
                        <strong style="color:#f39c12; display:block; margin-bottom:10px;">Ejemplos:</strong>
                        <div style="color:white; line-height:1.6;">
                            ${item.example}
                        </div>
                    </div>
                    
                    ${similarMinerals.length > 0 ? `
                    <div style="background:rgba(232,244,252,0.15); padding:20px; border-radius:15px; margin-bottom:25px; border:1px solid rgba(255,255,255,0.1);">
                        <strong style="color:#f39c12; display:block; margin-bottom:10px;">Minerales similares en Atacama:</strong>
                        <div style="margin-top:10px;">
                            ${mineralsList}
                        </div>
                    </div>
                    ` : ''}
                    
                    <div style="background:rgba(255,245,235,0.15); padding:20px; border-radius:15px; border:1px solid rgba(255,255,255,0.1);">
                        <div style="color:white; line-height:1.6;">
                            <strong style="color:#f39c12;">Color:</strong> ${item.color}<br>
                            <strong style="color:#f39c12;">Raya:</strong> ${item.streak}<br>
                            <strong style="color:#f39c12;">Dureza absoluta:</strong> ${item.hardness} Mohs
                        </div>
                    </div>
                </div>
            `;
            
            openModal(`Escala de Mohs: ${item.mineral}`, modalContent);
        }

        // ============================================
        // KIT DE CAMPO - HERRAMIENTAS CON GLASS
        // ============================================
        function openTool(tool) {
            let content = '';
            let title = '';
            
            switch(tool) {
                case 'compass':
                    title = 'Br√∫jula Geol√≥gica';
                    content = generateCompassTool();
                    break;
                case 'mohs':
                    title = 'Escala de Mohs';
                    content = generateMohsTool();
                    break;
                case 'streak':
                    title = 'Colores de Raya';
                    content = generateStreakTool();
                    break;
                case 'fracture':
                    title = 'Tipos de Fractura';
                    content = generateFractureTool();
                    break;
                case 'calculator':
                    title = 'Calculadora Geol√≥gica';
                    content = generateCalculatorTool();
                    break;
                case 'weather':
                    title = 'Clima Satelital';
                    content = generateWeatherTool();
                    break;
            }
            
            openModal(title, content);
        }

        function generateCompassTool() {
            // Iniciar br√∫jula si no est√° activa
            if (!compassActive) {
                startCompass();
            }
            
            return `
                <div style="padding:25px;">
                    <h3 style="margin-bottom:20px; color:#f39c12; font-size:1.4rem;">üß≠ Br√∫jula Geol√≥gica</h3>
                    <p style="margin-bottom:25px; color:rgba(255,255,255,0.8); font-size:1.05rem;">Br√∫jula profesional con declinaci√≥n magn√©tica</p>
                    
                    <div class="geological-compass">
                        <div class="compass-outer">
                            <div class="compass-inner">
                                <div class="compass-rose">
                                    <div class="compass-point north">N</div>
                                    <div class="compass-point south">S</div>
                                    <div class="compass-point east">E</div>
                                    <div class="compass-point west">W</div>
                                    <div class="compass-needle" id="modalCompassNeedle"></div>
                                </div>
                            </div>
                        </div>
                        <div class="declination" id="modalDeclination">Declinaci√≥n: ${magneticDeclination.toFixed(1)}¬∞</div>
                    </div>
                    
                    <div style="text-align:center; margin-top:25px;">
                        <div id="modalCompassDirection" style="font-size:1.6rem; font-weight:bold; color:#f39c12; margin-bottom:8px;">${getDirectionName(compassHeading)}</div>
                        <div id="modalCompassDegrees" style="color:rgba(255,255,255,0.8); margin-top:5px; font-size:1.1rem;">${compassHeading.toFixed(1)}¬∞</div>
                        
                        <div style="margin-top:25px; padding:20px; background:rgba(255,255,255,0.08); border-radius:15px; border:1px solid rgba(255,255,255,0.1);">
                            <strong style="color:#f39c12; display:block; margin-bottom:10px;">Instrucciones:</strong>
                            <div style="color:white; line-height:1.6;">
                                1. Sost√©n el dispositivo horizontal<br>
                                2. Apunta la aguja roja al norte<br>
                                3. Lee el rumbo en grados<br>
                                4. Calibra con GPS para mayor precisi√≥n
                            </div>
                        </div>
                        
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:25px;">
                            <button class="btn btn-primary" onclick="calibrateCompass()" style="padding:16px; font-size:1.05rem;">
                                <i class="fas fa-sync-alt"></i> Calibrar GPS
                            </button>
                            <button class="btn btn-outline" onclick="resetCompass()" style="padding:16px; font-size:1.05rem; background:rgba(255,255,255,0.05);">
                                <i class="fas fa-redo"></i> Reiniciar
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function resetCompass() {
            compassHeading = 0;
            updateCompass(compassHeading);
            showNotification('üîÑ Br√∫jula reiniciada', 'info');
        }

        function generateStreakTool() {
            const streakColors = [
                { name: "Rojo cereza", color: "#dc2626", emoji: "üî¥", minerals: ["Hematita"] },
                { name: "Rojo", color: "#ef4444", emoji: "üü•", minerals: ["Cinabrio"] },
                { name: "Negro", color: "#000000", emoji: "‚ö´", minerals: ["Magnetita", "Pirita"] },
                { name: "Blanco", color: "#ffffff", emoji: "‚ö™", minerals: ["Cuarzo", "Calcita", "Yeso"] },
                { name: "Verde", color: "#22c55e", emoji: "üü©", minerals: ["Malaquita"] },
                { name: "Amarillo", color: "#fbbf24", emoji: "üü®", minerals: ["Orpimento"] },
                { name: "Gris", color: "#6b7280", emoji: "ü©∂", minerals: ["Galena"] }
            ];
            
            let content = `
                <div style="padding:25px;">
                    <h3 style="margin-bottom:20px; color:#f39c12; font-size:1.4rem;">üé® Colores de Raya</h3>
                    <p style="margin-bottom:25px; color:rgba(255,255,255,0.8); font-size:1.05rem;">Gu√≠a de identificaci√≥n por color de raya mineral</p>
                    
                    <div style="margin-bottom:25px; padding:20px; background:rgba(255,255,255,0.08); border-radius:15px; border:1px solid rgba(255,255,255,0.1);">
                        <strong style="color:#f39c12; display:block; margin-bottom:10px;">¬øQu√© es el color de raya?</strong>
                        <div style="color:white; line-height:1.6;">
                            El color de raya se obtiene frotando un mineral contra una placa de porcelana sin vidriar. 
                            Es m√°s confiable que el color del mineral.
                        </div>
                    </div>
                    
                    <div class="streak-colors">
            `;
            
            streakColors.forEach(streak => {
                content += `
                    <div class="streak-item" onclick="showStreakDetail('${streak.name}')">
                        <div class="streak-color" style="background-color:${streak.color};">
                            <div style="font-size:1.5rem;">${streak.emoji}</div>
                        </div>
                        <div style="font-weight:bold; color:white; margin-bottom:8px;">${streak.name}</div>
                        <div style="font-size:0.9rem; color:rgba(255,255,255,0.7);">
                            Ej: ${streak.minerals.slice(0, 2).join(', ')}
                        </div>
                    </div>
                `;
            });
            
            content += `
                    </div>
                    
                    <div style="margin-top:25px; padding:20px; background:rgba(232,244,252,0.15); border-radius:15px; border:1px solid rgba(255,255,255,0.1);">
                        <strong style="color:#f39c12; display:block; margin-bottom:10px;">T√©cnica correcta:</strong>
                        <div style="color:white; line-height:1.6;">
                            1. Usa una placa de porcelana sin vidriar (dureza ~7)<br>
                            2. Frota el mineral con presi√≥n moderada<br>
                            3. Observa el color del polvo dejado<br>
                            4. Compara con esta gu√≠a de referencia
                        </div>
                    </div>
                </div>
            `;
            
            return content;
        }

        function showStreakDetail(streakName) {
            // Implementaci√≥n b√°sica
            showNotification(`Color de raya: ${streakName}`, 'info');
        }

        function generateFractureTool() {
            const fractureTypes = [
                { name: "Concoidea", emoji: "üç™", description: "Fractura curva, t√≠pica del vidrio", example: "Cuarzo, Obsidiana" },
                { name: "Irregular", emoji: "‚ö°", description: "Superficie de fractura irregular", example: "Cobre nativo" },
                { name: "Fibrosa", emoji: "üßµ", description: "Fractura que muestra fibras", example: "Asbesto" },
                { name: "Ganchuda", emoji: "ü™ù", description: "Superficie dentada y afilada", example: "Cobre nativo" }
            ];
            
            let content = `
                <div style="padding:25px;">
                    <h3 style="margin-bottom:20px; color:#f39c12; font-size:1.4rem;">‚ö° Tipos de Fractura Mineral</h3>
                    
                    <div style="margin-bottom:25px; padding:20px; background:rgba(255,255,255,0.08); border-radius:15px; border:1px solid rgba(255,255,255,0.1);">
                        <strong style="color:#f39c12; display:block; margin-bottom:10px;">¬øQu√© es la fractura?</strong>
                        <div style="color:white; line-height:1.6;">
                            La fractura describe c√≥mo se rompe un mineral cuando no sigue planos de clivaje definidos.
                        </div>
                    </div>
                    
                    <div class="fractures-grid">
            `;
            
            fractureTypes.forEach(fracture => {
                content += `
                    <div class="fracture-item" onclick="showFractureDetail('${fracture.name}')">
                        <div class="fracture-emoji">${fracture.emoji}</div>
                        <div style="font-weight:bold; color:white; margin-bottom:8px;">${fracture.name}</div>
                        <div style="font-size:0.9rem; color:rgba(255,255,255,0.7);">
                            Ej: ${fracture.example}
                        </div>
                    </div>
                `;
            });
            
            content += `
                    </div>
                </div>
            `;
            
            return content;
        }

        function showFractureDetail(fractureName) {
            showNotification(`Tipo de fractura: ${fractureName}`, 'info');
        }

        function generateCalculatorTool() {
            return `
                <div style="padding:25px;">
                    <h3 style="margin-bottom:20px; color:#f39c12; font-size:1.4rem;">üßÆ Calculadora Geol√≥gica</h3>
                    <p style="margin-bottom:25px; color:rgba(255,255,255,0.8); font-size:1.05rem;">Calculadora cient√≠fica para c√°lculos de campo</p>
                    
                    <div style="text-align:center; padding:40px; background:rgba(255,255,255,0.08); border-radius:15px;">
                        <div style="font-size:3rem;">üßÆ</div>
                        <p style="margin-top:20px; color:rgba(255,255,255,0.7);">Calculadora en desarrollo</p>
                    </div>
                </div>
            `;
        }

        function generateWeatherTool() {
            return `
                <div style="padding:25px;">
                    <h3 style="margin-bottom:20px; color:#f39c12; font-size:1.4rem;">üå§Ô∏è Clima Satelital</h3>
                    
                    <div style="text-align:center; padding:40px; background:rgba(255,255,255,0.08); border-radius:15px;">
                        <div style="font-size:3rem;">üå°Ô∏è</div>
                        <p style="margin-top:20px; color:rgba(255,255,255,0.7);">Cargando datos clim√°ticos...</p>
                    </div>
                </div>
            `;
        }

        // ============================================
        // FUNCIONES RESTANTES DEL SISTEMA
        // ============================================
        
        // Resto del c√≥digo permanece igual...
        function loadWeatherData() {
            // Simulaci√≥n de datos clim√°ticos
            weatherData = {
                temperature: "25¬∞C",
                condition: "Soleado",
                humidity: "15%",
                windSpeed: "10 km/h"
            };
        }

        function initMap() {
            map = L.map('map').setView([-27.3667, -70.3333], 12);
            
            // Capa base OpenStreetMap
            const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 18
            }).addTo(map);
            
            // Marcador de posici√≥n actual
            const userIcon = L.divIcon({
                className: 'user-marker',
                html: '<div style="background:rgba(231,76,60,0.8); color:white; width:35px; height:35px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:18px; border:3px solid rgba(255,255,255,0.5); backdrop-filter:blur(5px);"><i class="fas fa-user"></i></div>',
                iconSize: [35, 35],
                iconAnchor: [17, 35]
            });
            
            L.marker([-27.3667, -70.3333], { icon: userIcon })
                .addTo(map)
                .bindPopup(`
                    <div style="background:rgba(0,0,0,0.7); color:white; padding:15px; border-radius:10px; border:1px solid rgba(255,255,255,0.2); backdrop-filter:blur(10px);">
                        <b>Regi√≥n de Atacama</b><br>
                        Centro geol√≥gico
                    </div>
                `)
                .openPopup();
        }

        function centerMap() {
            if (realGPSData) {
                map.setView([realGPSData.latitude, realGPSData.longitude], 15);
                showNotification('üìç Mapa centrado en tu ubicaci√≥n', 'info');
            } else {
                map.setView([-27.3667, -70.3333], 12);
                showNotification('üó∫Ô∏è Mapa centrado en Atacama', 'info');
            }
        }

        function addMarker() {
            const coords = realGPSData ? 
                [realGPSData.latitude, realGPSData.longitude] : 
                [-27.3667, -70.3333];
            
            const marker = L.marker(coords).addTo(map);
            marker.bindPopup(`
                <div style="background:rgba(0,0,0,0.7); color:white; padding:15px; border-radius:10px; border:1px solid rgba(255,255,255,0.2); backdrop-filter:blur(10px);">
                    <b>Punto de Muestra</b><br>
                    ${new Date().toLocaleString()}<br>
                    ${coords[0].toFixed(6)}, ${coords[1].toFixed(6)}
                </div>
            `).openPopup();
            
            showNotification('üìç Marcador agregado', 'success');
        }

        function addMineralToMap(mineral) {
            if (!map || !mineral.location) return;
            
            const icon = L.divIcon({
                className: 'mineral-marker',
                html: `
                    <div style="background:rgba(211,84,0,0.8); color:white; width:35px; height:35px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:20px; border:3px solid rgba(255,255,255,0.5); backdrop-filter:blur(5px); box-shadow:0 4px 15px rgba(0,0,0,0.3);">
                        ${mineral.emoji}
                    </div>
                `,
                iconSize: [35, 35],
                iconAnchor: [17, 35]
            });
            
            L.marker([mineral.location.latitude, mineral.location.longitude], { icon: icon })
                .addTo(map)
                .bindPopup(`
                    <div style="background:rgba(0,0,0,0.7); color:white; padding:15px; border-radius:10px; border:1px solid rgba(255,255,255,0.2); backdrop-filter:blur(10px); max-width:250px;">
                        <b style="color:#f39c12; font-size:1.1em;">${mineral.emoji} ${mineral.name}</b><br>
                        ${mineral.formula}<br>
                        Dureza: ${mineral.hardness}<br>
                        ${new Date(mineral.timestamp).toLocaleTimeString()}
                    </div>
                `);
        }

        function loadLocalMinerals() {
            const centerLat = realGPSData ? realGPSData.latitude : -27.3667;
            const centerLng = realGPSData ? realGPSData.longitude : -70.3333;
            
            showNotification('üåê Buscando minerales en 20km a la redonda...', 'info');
            
            setTimeout(() => {
                // Simular b√∫squeda
                localMineralsCache = atacamaMineralsDB.slice(0, 8);
                updateCoverflow();
                
                document.getElementById('mineralInfo').innerHTML = `
                    ${localMineralsCache.length} minerales en 20km ‚Ä¢ Fuente: Mindat.org
                `;
                
                showNotification(`‚úÖ ${localMineralsCache.length} minerales locales cargados`, 'success');
            }, 1500);
        }

        function updateCoverflow() {
            const coverflow = document.getElementById('coverflow');
            const counter = document.getElementById('mineralCounter');
            
            const mineralsToShow = identifiedMinerals.length > 0 ? identifiedMinerals : localMineralsCache;
            
            if (mineralsToShow.length === 0) {
                coverflow.innerHTML = '<div style="text-align:center; padding:40px; color:rgba(255,255,255,0.5); font-size:1.1rem;">No hay minerales cargados</div>';
                counter.textContent = '0/0';
                return;
            }
            
            coverflow.innerHTML = '';
            
            mineralsToShow.forEach((mineral, index) => {
                const card = document.createElement('div');
                card.className = 'mineral-card';
                if (index === currentMineralIndex) {
                    card.classList.add('active');
                }
                
                const position = index - currentMineralIndex;
                let transform = '';
                let zIndex = 10 - Math.abs(position);
                let opacity = 1 - Math.abs(position) * 0.3;
                
                if (position < 0) {
                    transform = `translateX(${position * 100}px) rotateY(20deg)`;
                } else if (position > 0) {
                    transform = `translateX(${position * 100}px) rotateY(-20deg)`;
                }
                
                card.style.transform = transform;
                card.style.zIndex = zIndex;
                card.style.opacity = opacity;
                card.style.left = `calc(50% + ${position * 100}px)`;
                
                card.innerHTML = `
                    <div class="emoji">${mineral.emoji}</div>
                    <div style="font-weight:bold; font-size:1rem; color:#2c3e50; margin-top:5px;">${mineral.name}</div>
                    <div style="font-size:0.8rem; color:#666; margin-top:2px;">${mineral.formula}</div>
                `;
                
                card.addEventListener('click', () => {
                    currentMineralIndex = index;
                    updateCoverflow();
                    showMineralDetail(mineral);
                });
                
                coverflow.appendChild(card);
            });
            
            counter.textContent = `${currentMineralIndex + 1}/${mineralsToShow.length}`;
        }

        function prevMineral() {
            const mineralsToShow = identifiedMinerals.length > 0 ? identifiedMinerals : localMineralsCache;
            if (mineralsToShow.length === 0) return;
            currentMineralIndex = (currentMineralIndex - 1 + mineralsToShow.length) % mineralsToShow.length;
            updateCoverflow();
        }

        function nextMineral() {
            const mineralsToShow = identifiedMinerals.length > 0 ? identifiedMinerals : localMineralsCache;
            if (mineralsToShow.length === 0) return;
            currentMineralIndex = (currentMineralIndex + 1) % mineralsToShow.length;
            updateCoverflow();
        }

        function showMineralDetail(mineral) {
            const modalContent = `
                <div style="padding:25px;">
                    <div style="text-align:center; margin-bottom:25px;">
                        <div style="font-size:4.5rem; filter:drop-shadow(0 6px 12px rgba(0,0,0,0.3)); margin-bottom:15px;">${mineral.emoji}</div>
                        <h3 style="color:#f39c12; font-size:1.6rem; margin-bottom:5px;">${mineral.name}</h3>
                        <div style="color:rgba(255,255,255,0.9); font-size:1.2rem; margin-bottom:10px;">${mineral.formula}</div>
                        <div style="color:rgba(255,255,255,0.7); font-size:1rem;">
                            ${mineral.locality || 'Regi√≥n de Atacama'}
                        </div>
                    </div>
                    
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:25px;">
                        <div style="padding:20px; background:rgba(255,255,255,0.1); border-radius:12px; text-align:center; border:1px solid rgba(255,255,255,0.1);">
                            <strong style="color:#f39c12; display:block; margin-bottom:8px; font-size:0.95rem;">Dureza</strong>
                            <span style="font-size:2rem; color:white; font-weight:bold;">${mineral.hardness}</span><br>
                            <small style="color:rgba(255,255,255,0.7);">Mohs</small>
                        </div>
                        <div style="padding:20px; background:rgba(255,255,255,0.1); border-radius:12px; text-align:center; border:1px solid rgba(255,255,255,0.1);">
                            <strong style="color:#f39c12; display:block; margin-bottom:8px; font-size:0.95rem;">Color</strong>
                            <span style="font-size:1.2rem; color:white;">${mineral.color}</span>
                        </div>
                        <div style="padding:20px; background:rgba(255,255,255,0.1); border-radius:12px; text-align:center; border:1px solid rgba(255,255,255,0.1);">
                            <strong style="color:#f39c12; display:block; margin-bottom:8px; font-size:0.95rem;">Raya</strong>
                            <span style="font-size:1.2rem; color:white;">${mineral.streak}</span>
                        </div>
                        <div style="padding:20px; background:rgba(255,255,255,0.1); border-radius:12px; text-align:center; border:1px solid rgba(255,255,255,0.1);">
                            <strong style="color:#f39c12; display:block; margin-bottom:8px; font-size:0.95rem;">Tipo</strong>
                            <span style="font-size:1.2rem; color:white;">${mineral.type}</span>
                        </div>
                    </div>
                </div>
            `;
            
            openModal(`Mineral: ${mineral.name}`, modalContent);
        }

        // Funci√≥n para guardar datos
        function saveToLocalStorage() {
            const data = {
                identifiedMinerals: identifiedMinerals,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('atacamapp_data', JSON.stringify(data));
        }

        // Funci√≥n para cargar datos guardados
        function loadSavedData() {
            const savedData = localStorage.getItem('atacamapp_data');
            if (savedData) {
                const data = JSON.parse(savedData);
                identifiedMinerals = data.identifiedMinerals || [];
                if (identifiedMinerals.length > 0) {
                    updateCoverflow();
                }
            }
        }

        // ============================================
        // INICIALIZACI√ìN DE LA APLICACI√ìN
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üé¨ AtacamApp - Iniciando sistema...');
            
            // Iniciar splash screen
            initSplashScreen();
        });
    </script>
</body>
</html>
