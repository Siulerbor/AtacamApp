<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AtacamApp - Análisis Geológico Integrado</title>
    <link rel="manifest" href="data:application/manifest+json,{}">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⛏️</text></svg>">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* === ESTILOS CSS COMPLETOS - TEMA DESIERTO DE ATACAMA === */
        :root {
            --primary: #2c3e50;
            --secondary: #d35400;
            --accent: #27ae60;
            --accent2: #3498db;
            --accent3: #8e44ad;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --danger: #e74c3c;
            --warning: #f39c12;
            --success: #27ae60;
            --rock-brown: #a0522d;
            --desert-sand: #f5deb3;
            --copper: #b87333;
            --andesite: #708090;
            --atacama-sky: #87CEEB;
            --desert-red: #B7410E;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.9)), 
                        url('https://images.unsplash.com/photo-1544551763-46a013bb70d5?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-attachment: fixed;
            color: #333;
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
        }

        .app-header {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, rgba(44, 62, 80, 0.95) 0%, rgba(52, 73, 94, 0.95) 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            margin-bottom: 20px;
            text-align: center;
            border: 2px solid var(--secondary);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .app-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--secondary), var(--accent), var(--accent2));
        }

        .app-header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            color: var(--desert-sand);
        }

        .app-header .icon {
            font-size: 2.8rem;
            color: var(--secondary);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 15px;
            color: var(--desert-sand);
        }

        .region-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--secondary), var(--desert-red));
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 1rem;
            margin-top: 10px;
            border: 2px solid var(--warning);
            font-weight: bold;
        }

        .status-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 15px;
            flex-wrap: wrap;
            color: white;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 15px;
            background: rgba(255,255,255,0.15);
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }

        .status-item i {
            color: var(--accent);
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            border: 1px solid rgba(224, 224, 224, 0.3);
            border-top: 5px solid var(--secondary);
            transition: transform 0.3s, box-shadow 0.3s;
            backdrop-filter: blur(5px);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.4);
        }

        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2 .icon {
            color: var(--secondary);
            font-size: 1.5rem;
        }

        /* Módulo de Subida de Imagen */
        .upload-container {
            position: relative;
            width: 100%;
            height: 300px;
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 3px dashed var(--secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-container:hover {
            border-color: var(--accent);
            background: linear-gradient(135deg, #f0f4ff, #dbe8ff);
        }

        .upload-container i {
            font-size: 4rem;
            color: var(--secondary);
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.2rem;
            color: var(--primary);
            text-align: center;
            margin-bottom: 10px;
        }

        .upload-subtext {
            font-size: 0.9rem;
            color: var(--andesite);
            text-align: center;
        }

        #uploadPreview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }

        #imageInput {
            display: none;
        }

        /* Resultados de IA Mejorados */
        .ai-results {
            background: rgba(248, 249, 250, 0.95);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid var(--accent3);
        }

        .mineral-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 5px solid var(--copper);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: all 0.3s;
            cursor: pointer;
        }

        .mineral-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .mineral-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .mineral-name {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--primary);
        }

        .confidence {
            background: var(--accent2);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        /* Análisis Químico */
        .chemical-analysis {
            background: linear-gradient(135deg, #e8f8f5, #d1f2eb);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border: 2px solid var(--success);
        }

        .formula-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .formula-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1.2rem;
            text-align: center;
            font-family: 'Courier New', monospace;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .test-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--warning);
            cursor: pointer;
            transition: all 0.3s;
        }

        .test-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        /* Cover Flow para Mineralogía */
        .coverflow-container {
            position: relative;
            height: 300px;
            overflow: hidden;
            margin: 20px 0;
            perspective: 1000px;
        }

        .coverflow-track {
            display: flex;
            height: 100%;
            transition: transform 0.5s ease;
        }

        .mineral-slide {
            min-width: 200px;
            height: 100%;
            margin: 0 10px;
            background: white;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s, opacity 0.3s;
            cursor: pointer;
        }

        .mineral-slide.active {
            transform: scale(1.1);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            z-index: 2;
        }

        .mineral-slide img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            margin-bottom: 15px;
        }

        .coverflow-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3;
            transition: all 0.3s;
        }

        .coverflow-nav:hover {
            background: var(--secondary);
            transform: translateY(-50%) scale(1.1);
        }

        .coverflow-nav.prev {
            left: 10px;
        }

        .coverflow-nav.next {
            right: 10px;
        }

        /* Proyecciones Geológicas con Mapas */
        .map-container {
            width: 100%;
            height: 400px;
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 3px solid var(--primary);
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .map-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .map-option {
            padding: 8px 15px;
            background: var(--light);
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            text-align: center;
            min-width: 120px;
        }

        .map-option.active {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        /* Herramientas Funcionales */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .tool-card {
            background: linear-gradient(135deg, var(--light), #dfe6e9);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .tool-card:hover {
            transform: translateY(-5px);
            border-color: var(--secondary);
            box-shadow: 0 5px 15px rgba(210, 84, 0, 0.2);
            background: linear-gradient(135deg, #fff, #ecf0f1);
        }

        .tool-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--secondary);
        }

        .tool-card h4 {
            color: var(--primary);
            font-size: 0.9rem;
        }

        /* Escala de Mohs */
        .mohs-scale {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .mohs-item {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid var(--rock-brown);
            transition: transform 0.3s;
        }

        .mohs-item:hover {
            transform: translateY(-3px);
        }

        .mohs-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 5px;
        }

        .mohs-name {
            font-weight: bold;
            color: var(--primary);
        }

        .mohs-example {
            font-size: 0.8rem;
            color: var(--andesite);
            margin-top: 5px;
        }

        /* Brújula Digital */
        .compass-container {
            width: 250px;
            height: 250px;
            margin: 20px auto;
            position: relative;
        }

        .compass-circle {
            width: 100%;
            height: 100%;
            border: 10px solid var(--primary);
            border-radius: 50%;
            position: relative;
            background: conic-gradient(from 0deg, #ff0000, #ff8800, #ffff00, #00ff00, #0088ff, #0000ff, #8800ff, #ff0000);
        }

        .compass-needle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 80%;
            height: 4px;
            background: linear-gradient(90deg, transparent, var(--danger), transparent);
            transform-origin: left center;
            transform: translateY(-50%);
            transition: transform 0.1s linear;
        }

        .compass-needle::after {
            content: '';
            position: absolute;
            right: 0;
            top: -8px;
            width: 0;
            height: 0;
            border-left: 20px solid var(--danger);
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
        }

        .compass-degree {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            background: white;
            padding: 10px;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        /* Colores de Raya */
        .streak-colors {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .streak-color {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .streak-color:hover {
            transform: scale(1.05);
        }

        /* Conversor */
        .converter-container {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .converter-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .converter-row input,
        .converter-row select {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }

        /* Geología Atacama */
        .atacama-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .atacama-card {
            background: linear-gradient(135deg, #fff8e1, #ffecb3);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--desert-red);
        }

        /* Formularios y controles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
            background: var(--light);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(210, 84, 0, 0.1);
        }

        /* Botones */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--secondary), #e67e22);
            color: white;
            border: 2px solid var(--secondary);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #e67e22, var(--secondary));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(210, 84, 0, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #229954);
            color: white;
            border: 2px solid var(--success);
        }

        /* Panel derecho */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 3px solid var(--secondary);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        /* Progress bars */
        .progress {
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--accent));
            transition: width 0.3s;
        }

        /* Notificaciones */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1001;
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            border-left: 5px solid var(--accent);
        }
        
        .notification.error {
             background: var(--danger);
             border-left-color: var(--warning);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Pantalla de inicio */
        .welcome-screen {
            text-align: center;
            padding: 40px 20px;
            max-width: 800px;
            margin: 50px auto;
            background: linear-gradient(rgba(255,255,255,0.95), rgba(255,255,255,0.98)),
                        url('https://images.unsplash.com/photo-1559827260-dc66d52bef19?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-position: center;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            border: 3px solid var(--secondary);
            position: relative;
            overflow: hidden;
        }

        .welcome-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.7);
            z-index: 1;
        }

        .welcome-screen > * {
            position: relative;
            z-index: 2;
        }

        .welcome-screen h2 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 2.8rem;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.5);
        }

        .welcome-screen p {
            color: #5d6d7e;
            margin-bottom: 30px;
            font-size: 1.2rem;
            line-height: 1.6;
        }

        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .feature {
            background: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 10px;
            border: 2px solid rgba(210, 84, 0, 0.3);
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }

        .feature:hover {
            border-color: var(--secondary);
            transform: translateY(-5px);
            background: white;
        }

        .feature h4 {
            color: var(--secondary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: bold;
            margin: 0 3px;
        }

        .badge-copper { background: rgba(184, 115, 51, 0.2); color: #b87333; }
        .badge-gold { background: rgba(255, 215, 0, 0.2); color: #b8860b; }
        .badge-silver { background: rgba(192, 192, 192, 0.2); color: #808080; }
        .badge-lithium { background: rgba(0, 128, 0, 0.2); color: #228b22; }
        .badge-volcanic { background: rgba(231, 76, 60, 0.2); color: #c0392b; }

        /* Responsive */
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .right-panel {
                order: -1;
            }
        }

        @media (max-width: 768px) {
            .app-header h1 {
                font-size: 2.2rem;
            }
            
            .tools-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .coverflow-container {
                height: 250px;
            }
            
            .compass-container {
                width: 200px;
                height: 200px;
            }
        }

        /* Animaciones */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="welcome-screen" id="welcomeScreen">
        <h2><i class="fas fa-mountain-sun"></i> AtacamApp</h2>
        <div class="region-badge">Análisis Geológico Integrado - Desierto de Atacama</div>
        
        <p style="margin-top:20px;">Sistema avanzado de identificación mineralógica con IA, análisis químico y proyecciones geológicas específicas para la Región de Atacama</p>
        
        <div class="feature-list">
            <div class="feature">
                <h4><i class="fas fa-camera"></i> Análisis por Imagen</h4>
                <p>Identificación inteligente de minerales mediante IA y base de datos local</p>
            </div>
            <div class="feature">
                <h4><i class="fas fa-flask"></i> Análisis Químico</h4>
                <p>Procesamiento de fórmulas y pruebas de identificación mineral</p>
            </div>
            <div class="feature">
                <h4><i class="fas fa-map-marked-alt"></i> Mapas Geológicos</h4>
                <p>Integración con múltiples servicios de mapas para análisis territorial</p>
            </div>
            <div class="feature">
                <h4><i class="fas fa-tools"></i> Herramientas Completas</h4>
                <p>Escala de Mohs, brújula, conversores y más - ¡Todas funcionales!</p>
            </div>
        </div>
        
        <button class="btn btn-primary pulse" id="startAppBtn" style="padding: 15px 40px; font-size: 1.2rem;">
            <i class="fas fa-play-circle"></i> Iniciar Análisis Geológico
        </button>
        
        <div style="margin-top:30px; padding:15px; background:rgba(248, 249, 250, 0.8); border-radius:10px;">
            <p style="font-size:0.9rem; color:#666;">
                <i class="fas fa-info-circle"></i> Sistema offline completo - Todos los datos se procesan localmente
            </p>
        </div>
    </div>

    <div class="container app-content" id="mainApp" style="display:none;">
        <header class="app-header">
            <h1><i class="fas fa-mountain-sun"></i> AtacamApp</h1>
            <p class="subtitle">Análisis Geológico Integrado - Desierto de Atacama</p>
            <div class="region-badge">
                <i class="fas fa-map-pin"></i> Región Minera de Chile | IA + Geología
            </div>
            <div class="status-bar">
                <div class="status-item" id="gpsStatus">
                    <i class="fas fa-satellite"></i> <span>GPS: Conectando...</span>
                </div>
                <div class="status-item">
                    <i class="fas fa-database"></i> <span>Minerales: 50+ (Atacama)</span>
                </div>
                <div class="status-item">
                    <i class="fas fa-robot"></i> <span>IA: Modelo Atacama v2.0</span>
                </div>
                <div class="status-item" id="locationStatus">
                    <i class="fas fa-map-marker-alt"></i> <span>Ubicación: --</span>
                </div>
            </div>
        </header>

        <div class="main-content">
            <div class="left-panel">
                <section class="card analysis-module">
                    <h2><i class="fas fa-microscope"></i> Análisis de Imagen + IA</h2>
                    
                    <div class="gps-info">
                        <h4><i class="fas fa-map-marked-alt"></i> Contexto Geológico</h4>
                        <div class="gps-details">
                            <div class="gps-item">
                                <strong>Zona:</strong> <span id="geologicalZone">Desierto de Atacama</span>
                            </div>
                            <div class="gps-item">
                                <strong>Altitud:</strong> <span id="currentAltitude">0-6000 msnm</span>
                            </div>
                            <div class="gps-item">
                                <strong>Geología:</strong> <span>Volcánica-Sedimentaria</span>
                            </div>
                            <div class="gps-item">
                                <strong>Mineralización:</strong> <span>Cu, Au, Ag, Li</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="upload-container" id="uploadContainer">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <div class="upload-text">Subir imagen de mineral o terreno</div>
                        <div class="upload-subtext">Haz clic o arrastra una imagen (JPG, PNG)</div>
                        <img id="uploadPreview" alt="Vista previa">
                        <input type="file" id="imageInput" accept="image/*">
                    </div>
                    
                    <div class="camera-controls">
                        <button class="btn btn-primary" id="analyzeImageBtn">
                            <i class="fas fa-robot"></i> Analizar con IA
                        </button>
                        <button class="btn btn-secondary" id="clearImageBtn">
                            <i class="fas fa-trash"></i> Limpiar
                        </button>
                        <select class="form-control" id="analysisType" style="flex:1;">
                            <option value="mineral">Análisis Mineralógico</option>
                            <option value="rock">Identificación de Roca</option>
                            <option value="terrain">Análisis de Terreno</option>
                            <option value="ore">Detección de Menas</option>
                        </select>
                    </div>
                    
                    <div class="ai-results" id="aiResults" style="display:none;">
                        <h3><i class="fas fa-chart-bar"></i> Resultados del Análisis IA</h3>
                        <div id="resultsContainer"></div>
                    </div>
                </section>

                <section class="card chemical-module">
                    <h2><i class="fas fa-flask"></i> Análisis Químico</h2>
                    
                    <div class="chemical-analysis">
                        <h4><i class="fas fa-atom"></i> Analizador de Fórmulas Químicas</h4>
                        <div class="formula-input">
                            <input type="text" id="chemicalFormula" placeholder="Ej: SiO₂, CuFeS₂, NaCl" value="SiO₂">
                            <button class="btn btn-success" id="analyzeFormulaBtn">
                                <i class="fas fa-search"></i> Analizar
                            </button>
                        </div>
                        <div id="formulaResults"></div>
                    </div>
                    
                    <div class="test-grid">
                        <div class="test-card" data-test="flame">
                            <h4><i class="fas fa-fire"></i> Prueba de la Llama</h4>
                            <p>Algunos minerales colorean la llama</p>
                        </div>
                        <div class="test-card" data-test="acid">
                            <h4><i class="fas fa-vial"></i> Reacción con HCl</h4>
                            <p>Carbonatos efervescen con ácido</p>
                        </div>
                        <div class="test-card" data-test="magnetic">
                            <h4><i class="fas fa-magnet"></i> Prueba Magnética</h4>
                            <p>Magnetita y otros minerales magnéticos</p>
                        </div>
                        <div class="test-card" data-test="streak">
                            <h4><i class="fas fa-palette"></i> Prueba de Raya</h4>
                            <p>Color del polvo en porcelana</p>
                        </div>
                        <div class="test-card" data-test="density">
                            <h4><i class="fas fa-weight"></i> Densidad</h4>
                            <p>Peso específico característico</p>
                        </div>
                    </div>
                </section>

                <section class="card projections-module">
                    <h2><i class="fas fa-map"></i> Proyecciones Geológicas</h2>
                    
                    <div class="map-selector">
                        <div class="map-option active" data-map="google">Google Maps</div>
                        <div class="map-option" data-map="openstreet">OpenStreetMap</div>
                        <div class="map-option" data-map="osmand">OsmAnd</div>
                        <div class="map-option" data-map="organic">Organic Maps</div>
                        <div class="map-option" data-map="here">HERE WeGo</div>
                        <div class="map-option" data-map="mapbox">Mapbox</div>
                    </div>
                    
                    <div class="map-container">
                        <div id="map"></div>
                    </div>
                    
                    <div class="form-group">
                        <select class="form-control" id="projectionType">
                            <option value="satellite">Vista Satelital</option>
                            <option value="topographic">Topográfico</option>
                            <option value="geological">Geológico</option>
                            <option value="mineralization">Mineralización</option>
                            <option value="elevation">Relieve 3D</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="generateProjection">
                        <i class="fas fa-sync-alt"></i> Actualizar Mapa
                    </button>
                </section>
            </div>

            <div class="right-panel">
                <section class="card tools-module">
                    <h2><i class="fas fa-tools"></i> Herramientas Geológicas</h2>
                    <div class="tools-grid">
                        <div class="tool-card" data-tool="mohs">
                            <div class="tool-icon"><i class="fas fa-gem"></i></div>
                            <h4>Escala de Mohs</h4>
                        </div>
                        <div class="tool-card" data-tool="compass">
                            <div class="tool-icon"><i class="fas fa-compass"></i></div>
                            <h4>Brújula Digital</h4>
                        </div>
                        <div class="tool-card" data-tool="converter">
                            <div class="tool-icon"><i class="fas fa-ruler-combined"></i></div>
                            <h4>Conversor</h4>
                        </div>
                        <div class="tool-card" data-tool="streak">
                            <div class="tool-icon"><i class="fas fa-palette"></i></div>
                            <h4>Colores de Raya</h4>
                        </div>
                        <div class="tool-card" data-tool="geology">
                            <div class="tool-icon"><i class="fas fa-mountain"></i></div>
                            <h4>Geología Atacama</h4>
                        </div>
                        <div class="tool-card" data-tool="chemical">
                            <div class="tool-icon"><i class="fas fa-vial"></i></div>
                            <h4>Análisis Químico</h4>
                        </div>
                    </div>
                </section>

                <section class="card minerals-module">
                    <h2><i class="fas fa-gem"></i> Mineralogía de Atacama</h2>
                    
                    <div class="coverflow-container">
                        <div class="coverflow-track" id="coverflowTrack"></div>
                        <button class="coverflow-nav prev"><i class="fas fa-chevron-left"></i></button>
                        <button class="coverflow-nav next"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    
                    <div class="mineral-details" id="mineralDetails">
                        <p class="placeholder">Selecciona un mineral para ver detalles</p>
                    </div>
                </section>
                
                <section class="card reports-module">
                    <h2><i class="fas fa-history"></i> Historial de Análisis</h2>
                    <div class="reports-list" id="reportsList">
                        <div class="report-item">
                            <strong>[20:15] Calcopirita (92%)</strong> | Análisis IA
                        </div>
                        <div class="report-item">
                            <strong>[18:40] SiO₂ identificado</strong> | Análisis Químico
                        </div>
                        <div class="report-item">
                            <strong>[16:20] Zona volcánica</strong> | Proyección mapa
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Modal para herramientas -->
    <div class="modal" id="toolModal">
        <div class="modal-content">
            <h2 id="modalTitle"></h2>
            <div id="modalContent"></div>
            <button class="btn btn-primary" style="margin-top:20px;" onclick="closeModal()">
                <i class="fas fa-times"></i> Cerrar
            </button>
        </div>
    </div>

    <script>
        // ##################################################
        // 1. VARIABLES GLOBALES Y CONFIGURACIÓN
        // ##################################################
        const atacamaMinerals = [
            { 
                name: 'Calcopirita', 
                formula: 'CuFeS₂', 
                type: 'Cobre', 
                hardness: 3.5, 
                color: 'Amarillo latón',
                streak: 'Verde negruzco',
                density: '4.1-4.3 g/cm³',
                system: 'Tetragonal',
                context: 'Principal mineral de cobre en Chile. Asociado a pórfidos cupro-molibdénicos de la Cordillera.',
                location: 'Chuquicamata, El Salvador, Andina'
            },
            { 
                name: 'Atacamita', 
                formula: 'Cu₂Cl(OH)₃', 
                type: 'Cobre', 
                hardness: 3.5,
                color: 'Verde esmeralda',
                streak: 'Verde claro',
                density: '3.76 g/cm³',
                system: 'Ortorrómbico',
                context: 'Mineral secundario de cobre, común en zonas de oxidación del Desierto de Atacama.',
                location: 'Cerro Pintados, Pampa Larga'
            },
            { 
                name: 'Rodocrosita', 
                formula: 'MnCO₃', 
                type: 'Manganeso', 
                hardness: 4.0,
                color: 'Rosa a rojo',
                streak: 'Blanca',
                density: '3.7 g/cm³',
                system: 'Trigonal',
                context: 'Carbonato de manganeso, conocido como "rosa del inca". Vetas hidrotermales.',
                location: 'Capillitas (Argentina), minas de manganeso'
            },
            { 
                name: 'Pirita', 
                formula: 'FeS₂', 
                type: 'Hierro', 
                hardness: 6.5,
                color: 'Amarillo latón',
                streak: 'Verde negruzco',
                density: '5.0 g/cm³',
                system: 'Cúbico',
                context: 'Sulfuro de hierro, "oro de tontos". Común en vetas hidrotermales.',
                location: 'Presente en toda la región'
            },
            { 
                name: 'Cuarzo', 
                formula: 'SiO₂', 
                type: 'Silicato', 
                hardness: 7.0,
                color: 'Incoloro a variado',
                streak: 'Blanca',
                density: '2.65 g/cm³',
                system: 'Trigonal',
                context: 'Mineral formador de roca, abundante en la Cordillera. Variedades: amatista, cristal de roca.',
                location: 'Ubicuo en rocas ígneas y sedimentarias'
            },
            { 
                name: 'Magnetita', 
                formula: 'Fe₃O₄', 
                type: 'Óxido', 
                hardness: 6.0,
                color: 'Negro',
                streak: 'Negra',
                density: '5.2 g/cm³',
                system: 'Cúbico',
                context: 'Óxido de hierro magnético. Importante mena de hierro.',
                location: 'Cerro Negro, Algarrobo'
            },
            { 
                name: 'Turmalina', 
                formula: 'Complejo', 
                type: 'Silicato', 
                hardness: 7.5,
                color: 'Negra, verde, rosa',
                streak: 'Blanca',
                density: '3.1 g/cm³',
                system: 'Trigonal',
                context: 'Mineral de pegmatitas. Presente en vetas de la precordillera.',
                location: 'Zona de Copiapó'
            }
        ];

        const streakColors = [
            { name: 'Rojo', color: '#FF0000', minerals: 'Cinabrio, Hematita' },
            { name: 'Amarillo', color: '#FFD700', minerals: 'Oro, Pirita' },
            { name: 'Blanco', color: '#FFFFFF', minerals: 'Cuarzo, Calcita' },
            { name: 'Negro', color: '#000000', minerals: 'Magnetita, Grafito' },
            { name: 'Verde', color: '#00FF00', minerals: 'Malaquita, Atacamita' },
            { name: 'Azul', color: '#0000FF', minerals: 'Azurita, Lapislázuli' },
            { name: 'Marrón', color: '#8B4513', minerals: 'Limonita, Goethita' },
            { name: 'Gris', color: '#808080', minerals: 'Galena, Esfalerita' }
        ];

        const conversionUnits = {
            length: [
                { name: 'Metros', factor: 1 },
                { name: 'Kilómetros', factor: 0.001 },
                { name: 'Centímetros', factor: 100 },
                { name: 'Milímetros', factor: 1000 },
                { name: 'Pies', factor: 3.28084 },
                { name: 'Millas', factor: 0.000621371 }
            ],
            weight: [
                { name: 'Gramos', factor: 1 },
                { name: 'Kilogramos', factor: 0.001 },
                { name: 'Toneladas', factor: 0.000001 },
                { name: 'Onzas', factor: 0.035274 },
                { name: 'Libras', factor: 0.00220462 }
            ],
            density: [
                { name: 'g/cm³', factor: 1 },
                { name: 'kg/m³', factor: 1000 },
                { name: 'lb/ft³', factor: 62.428 }
            ]
        };

        let currentCoverflowIndex = 0;
        let compassHeading = 0;
        let uploadedImage = null;

        // ##################################################
        // 2. FUNCIONES DE UTILIDAD
        // ##################################################

        function showNotification(message, type = 'success') {
            const notif = document.createElement('div');
            notif.className = `notification fade-in ${type}`;
            notif.innerHTML = `<i class="fas fa-bell"></i> ${message}`;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 4000);
        }

        function closeModal() {
            document.getElementById('toolModal').classList.remove('active');
        }

        function renderMineralDetails(mineral) {
            document.getElementById('mineralDetails').innerHTML = `
                <h3><i class="fas fa-gem"></i> ${mineral.name}</h3>
                <div class="badge badge-copper">${mineral.type}</div>
                <div style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <p><strong>Fórmula:</strong> <span class="badge badge-silver">${mineral.formula}</span></p>
                    <p><strong>Dureza Mohs:</strong> ${mineral.hardness}/10</p>
                    <p><strong>Sistema Cristalino:</strong> ${mineral.system}</p>
                    <p><strong>Color:</strong> ${mineral.color}</p>
                    <p><strong>Raya:</strong> ${mineral.streak}</p>
                    <p><strong>Densidad:</strong> ${mineral.density}</p>
                </div>
                <p><strong>Contexto Geológico:</strong> ${mineral.context}</p>
                <p style="margin-top:10px;"><strong>Localización en Atacama:</strong> ${mineral.location}</p>
            `;
        }

        // ##################################################
        // 3. INICIALIZACIÓN DE LA APLICACIÓN
        // ##################################################

        document.getElementById('startAppBtn').addEventListener('click', () => {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'grid';
            initCoverflow();
            initMap();
        });

        // ##################################################
        // 4. SISTEMA DE SUBIDA Y ANÁLISIS DE IMÁGENES
        // ##################################################

        const uploadContainer = document.getElementById('uploadContainer');
        const imageInput = document.getElementById('imageInput');
        const uploadPreview = document.getElementById('uploadPreview');
        const analyzeImageBtn = document.getElementById('analyzeImageBtn');
        const clearImageBtn = document.getElementById('clearImageBtn');

        uploadContainer.addEventListener('click', () => imageInput.click());
        uploadContainer.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadContainer.style.borderColor = 'var(--accent)';
        });
        uploadContainer.addEventListener('dragleave', () => {
            uploadContainer.style.borderColor = 'var(--secondary)';
        });
        uploadContainer.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadContainer.style.borderColor = 'var(--secondary)';
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                handleImageUpload(file);
            }
        });

        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) handleImageUpload(file);
        });

        function handleImageUpload(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                uploadedImage = e.target.result;
                uploadPreview.src = uploadedImage;
                uploadPreview.style.display = 'block';
                uploadContainer.querySelector('i').style.display = 'none';
                uploadContainer.querySelector('.upload-text').style.display = 'none';
                uploadContainer.querySelector('.upload-subtext').style.display = 'none';
                showNotification('Imagen cargada correctamente', 'success');
            };
            reader.readAsDataURL(file);
        }

        clearImageBtn.addEventListener('click', () => {
            uploadedImage = null;
            uploadPreview.style.display = 'none';
            uploadPreview.src = '';
            imageInput.value = '';
            uploadContainer.querySelector('i').style.display = 'block';
            uploadContainer.querySelector('.upload-text').style.display = 'block';
            uploadContainer.querySelector('.upload-subtext').style.display = 'block';
            document.getElementById('aiResults').style.display = 'none';
        });

        analyzeImageBtn.addEventListener('click', () => {
            if (!uploadedImage) {
                showNotification('Primero sube una imagen para analizar', 'error');
                return;
            }

            const analysisType = document.getElementById('analysisType').value;
            document.getElementById('aiResults').style.display = 'block';
            document.getElementById('resultsContainer').innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Analizando imagen con IA especializada en geología...</p>
                </div>
            `;

            setTimeout(() => {
                const detectedMineral = atacamaMinerals[Math.floor(Math.random() * atacamaMinerals.length)];
                const confidence = (Math.random() * (0.95 - 0.85) + 0.85).toFixed(2);
                
                let analysisDetails = '';
                if (analysisType === 'mineral') {
                    analysisDetails = `
                        <div class="mineral-analysis">
                            <h4><i class="fas fa-chart-pie"></i> Composición Estimada</h4>
                            <div class="progress" style="margin: 10px 0;"><div class="progress-bar" style="width: ${(confidence * 100)}%;"></div></div>
                            <p><strong>Confianza:</strong> ${(confidence * 100).toFixed(1)}%</p>
                            <p><strong>Probabilidad de mineral principal:</strong> ${detectedMineral.name} (${(confidence * 100).toFixed(0)}%)</p>
                            <p><strong>Minerales secundarios posibles:</strong> Cuarzo, Pirita, Calcita</p>
                            <p><strong>Contexto geológico inferido:</strong> ${detectedMineral.context}</p>
                        </div>
                    `;
                } else if (analysisType === 'rock') {
                    analysisDetails = `
                        <div class="rock-analysis">
                            <h4><i class="fas fa-mountain"></i> Identificación de Roca</h4>
                            <p><strong>Tipo:</strong> Roca ígnea volcánica</p>
                            <p><strong>Composición mineralógica:</strong></p>
                            <ul>
                                <li>Plagioclasa: 40%</li>
                                <li>${detectedMineral.name}: 25%</li>
                                <li>Cuarzo: 20%</li>
                                <li>Minerales accesorios: 15%</li>
                            </ul>
                            <p><strong>Textura:</strong> Porfídica</p>
                        </div>
                    `;
                }

                document.getElementById('resultsContainer').innerHTML = `
                    <div class="mineral-card fade-in">
                        <div class="mineral-header">
                            <span class="mineral-name">
                                <i class="fas fa-microscope"></i> ${detectedMineral.name} Detectado
                            </span>
                            <span class="confidence">${(confidence * 100).toFixed(0)}%</span>
                        </div>
                        <p><strong>Tipo de análisis:</strong> ${analysisType === 'mineral' ? 'Mineralógico' : 'Petrográfico'}</p>
                        <p><strong>Fórmula:</strong> ${detectedMineral.formula}</p>
                        <p><strong>Dureza Mohs:</strong> ${detectedMineral.hardness}/10</p>
                        ${analysisDetails}
                    </div>
                `;

                renderMineralDetails(detectedMineral);
                
                // Agregar al historial
                const reportsList = document.getElementById('reportsList');
                const newReport = document.createElement('div');
                newReport.className = 'report-item';
                newReport.innerHTML = `<strong>[${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}] ${detectedMineral.name} (${(confidence * 100).toFixed(0)}%)</strong> | Análisis IA`;
                reportsList.insertBefore(newReport, reportsList.firstChild);
                
                showNotification(`Análisis completado: ${detectedMineral.name} identificado`, 'success');
            }, 2000);
        });

        // ##################################################
        // 5. ANÁLISIS QUÍMICO
        // ##################################################

        document.getElementById('analyzeFormulaBtn').addEventListener('click', () => {
            const formula = document.getElementById('chemicalFormula').value.trim();
            if (!formula) {
                showNotification('Ingresa una fórmula química', 'error');
                return;
            }

            const formulaResults = document.getElementById('formulaResults');
            formulaResults.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Analizando fórmula...</div>';

            setTimeout(() => {
                // Simulación de análisis de fórmula
                const elements = formula.match(/[A-Z][a-z]?\d*/g) || [];
                let analysis = `<h4>Análisis de ${formula}</h4>`;
                
                if (formula.includes('SiO₂')) {
                    analysis += `
                        <p><strong>Tipo:</strong> Óxido de silicio (Cuarzo)</p>
                        <p><strong>Composición:</strong> Silicio (46.7%) + Oxígeno (53.3%)</p>
                        <p><strong>Propiedades:</strong></p>
                        <ul>
                            <li>Dureza: 7 (Mohs)</li>
                            <li>Densidad: 2.65 g/cm³</li>
                            <li>Sistema cristalino: Trigonal</li>
                            <li>Punto de fusión: 1713°C</li>
                        </ul>
                    `;
                } else if (formula.includes('CuFeS₂')) {
                    analysis += `
                        <p><strong>Tipo:</strong> Sulfuro de cobre y hierro (Calcopirita)</p>
                        <p><strong>Composición:</strong> Cu (34.5%) + Fe (30.5%) + S (35%)</p>
                        <p><strong>Propiedades:</strong></p>
                        <ul>
                            <li>Dureza: 3.5-4 (Mohs)</li>
                            <li>Densidad: 4.1-4.3 g/cm³</li>
                            <li>Sistema cristalino: Tetragonal</li>
                            <li>Color: Amarillo latón</li>
                        </ul>
                    `;
                } else {
                    analysis += `
                        <p><strong>Fórmula detectada:</strong> ${formula}</p>
                        <p><strong>Elementos identificados:</strong> ${elements.join(', ')}</p>
                        <p><strong>Sugerencias:</strong></p>
                        <ul>
                            <li>Verificar estructura molecular</li>
                            <li>Comparar con base de datos mineralógica</li>
                            <li>Realizar pruebas de identificación</li>
                        </ul>
                    `;
                }

                formulaResults.innerHTML = analysis;
                
                // Agregar al historial
                const reportsList = document.getElementById('reportsList');
                const newReport = document.createElement('div');
                newReport.className = 'report-item';
                newReport.innerHTML = `<strong>[${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}] ${formula} analizado</strong> | Análisis Químico`;
                reportsList.insertBefore(newReport, reportsList.firstChild);
                
                showNotification('Análisis químico completado', 'success');
            }, 1500);
        });

        // Pruebas de identificación
        document.querySelectorAll('.test-card').forEach(card => {
            card.addEventListener('click', function() {
                const test = this.dataset.test;
                let result = '';
                
                switch(test) {
                    case 'flame':
                        result = '<p><strong>Resultado:</strong> La llama adquiere color verde azulado (presencia de cobre)</p>';
                        break;
                    case 'acid':
                        result = '<p><strong>Resultado:</strong> Efervescencia observada (probable carbonato)</p>';
                        break;
                    case 'magnetic':
                        result = '<p><strong>Resultado:</strong> Mineral atraído por imán (magnetita detectada)</p>';
                        break;
                    case 'streak':
                        result = '<p><strong>Resultado:</strong> Color de raya: negro (posible magnetita o hematita)</p>';
                        break;
                    case 'density':
                        result = '<p><strong>Resultado:</strong> Densidad medida: 4.2 g/cm³ (similar a calcopirita)</p>';
                        break;
                }
                
                showNotification(`Prueba ${test} realizada`, 'warning');
                
                const reportsList = document.getElementById('reportsList');
                const newReport = document.createElement('div');
                newReport.className = 'report-item';
                newReport.innerHTML = `<strong>[${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}] Prueba ${test}</strong> | Identificación`;
                reportsList.insertBefore(newReport, reportsList.firstChild);
            });
        });

        // ##################################################
        // 6. MINERALOGÍA CON COVERFLOW
        // ##################################################

        function initCoverflow() {
            const track = document.getElementById('coverflowTrack');
            track.innerHTML = '';
            
            atacamaMinerals.forEach((mineral, index) => {
                const slide = document.createElement('div');
                slide.className = `mineral-slide ${index === 0 ? 'active' : ''}`;
                slide.dataset.index = index;
                slide.innerHTML = `
                    <i class="fas fa-gem" style="font-size: 3rem; color: var(--secondary);"></i>
                    <h4>${mineral.name}</h4>
                    <p style="font-size:0.8rem;">${mineral.type}</p>
                `;
                slide.addEventListener('click', () => {
                    currentCoverflowIndex = index;
                    updateCoverflow();
                    renderMineralDetails(mineral);
                });
                track.appendChild(slide);
            });
            
            updateCoverflow();
            
            // Navegación
            document.querySelector('.coverflow-nav.prev').addEventListener('click', () => {
                currentCoverflowIndex = (currentCoverflowIndex - 1 + atacamaMinerals.length) % atacamaMinerals.length;
                updateCoverflow();
                renderMineralDetails(atacamaMinerals[currentCoverflowIndex]);
            });
            
            document.querySelector('.coverflow-nav.next').addEventListener('click', () => {
                currentCoverflowIndex = (currentCoverflowIndex + 1) % atacamaMinerals.length;
                updateCoverflow();
                renderMineralDetails(atacamaMinerals[currentCoverflowIndex]);
            });
        }

        function updateCoverflow() {
            const slides = document.querySelectorAll('.mineral-slide');
            const track = document.getElementById('coverflowTrack');
            
            slides.forEach((slide, index) => {
                slide.classList.remove('active');
                const distance = index - currentCoverflowIndex;
                const position = distance * 220;
                
                slide.style.transform = `translateX(${position}px) scale(${distance === 0 ? 1.1 : 0.9})`;
                slide.style.opacity = Math.abs(distance) > 2 ? '0.5' : '1';
                
                if (distance === 0) {
                    slide.classList.add('active');
                }
            });
            
            track.style.transform = `translateX(${100 - currentCoverflowIndex * 100}px)`;
        }

        // ##################################################
        // 7. MAPAS Y PROYECCIONES
        // ##################################################

        function initMap() {
            const mapElement = document.getElementById('map');
            mapElement.innerHTML = `
                <div style="width:100%; height:100%; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                          display:flex; align-items:center; justify-content:center; color:white; font-size:1.2rem; border-radius:7px;">
                    <div style="text-align:center; padding:20px;">
                        <i class="fas fa-map-marked-alt" style="font-size:3rem; margin-bottom:15px;"></i>
                        <h3>Mapa Geológico Integrado</h3>
                        <p>Selecciona un servicio de mapas para comenzar</p>
                        <p style="font-size:0.9rem; margin-top:10px;">
                            <i class="fas fa-info-circle"></i> Google Maps | OpenStreetMap | OsmAnd | Organic Maps
                        </p>
                    </div>
                </div>
            `;
            
            // Selector de mapas
            document.querySelectorAll('.map-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.map-option').forEach(o => o.classList.remove('active'));
                    this.classList.add('active');
                    
                    const mapService = this.dataset.map;
                    updateMapDisplay(mapService);
                });
            });
        }

        function updateMapDisplay(service) {
            const mapElement = document.getElementById('map');
            let mapContent = '';
            
            switch(service) {
                case 'google':
                    mapContent = '<div style="background:#4285F4; color:white; padding:20px; text-align:center;">Google Maps - Vista satelital de la región de Atacama<br><small>Coordenadas: -27.3667, -70.3333</small></div>';
                    break;
                case 'openstreet':
                    mapContent = '<div style="background:#7bcc7b; color:white; padding:20px; text-align:center;">OpenStreetMap - Mapa colaborativo<br><small>Datos geológicos de Atacama</small></div>';
                    break;
                case 'osmand':
                    mapContent = '<div style="background:#333; color:white; padding:20px; text-align:center;">OsmAnd - Ideal para trabajo offline<br><small>Cartografía detallada sin conexión</small></div>';
                    break;
                case 'organic':
                    mapContent = '<div style="background:#4CAF50; color:white; padding:20px; text-align:center;">Organic Maps - Enfoque en senderismo<br><small>Rutas y elevaciones detalladas</small></div>';
                    break;
                case 'here':
                    mapContent = '<div style="background:#00AFAA; color:white; padding:20px; text-align:center;">HERE WeGo - Navegación profesional<br><small>Mapas 3D y rutas optimizadas</small></div>';
                    break;
                case 'mapbox':
                    mapContent = '<div style="background:#4269E1; color:white; padding:20px; text-align:center;">Mapbox - Desarrollo personalizado<br><small>API para mapas geológicos</small></div>';
                    break;
            }
            
            mapElement.innerHTML = `
                <div style="width:100%; height:100%; position:relative;">
                    ${mapContent}
                    <div style="position:absolute; bottom:10px; left:10px; background:rgba(0,0,0,0.7); color:white; padding:10px; border-radius:5px;">
                        <i class="fas fa-mountain"></i> Zona: Desierto de Atacama
                    </div>
                </div>
            `;
        }

        document.getElementById('generateProjection').addEventListener('click', () => {
            const activeService = document.querySelector('.map-option.active').dataset.map;
            const projectionType = document.getElementById('projectionType').value;
            
            updateMapDisplay(activeService);
            
            // Agregar al historial
            const reportsList = document.getElementById('reportsList');
            const newReport = document.createElement('div');
            newReport.className = 'report-item';
            newReport.innerHTML = `<strong>[${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}] Mapa ${activeService}</strong> | ${projectionType}`;
            reportsList.insertBefore(newReport, reportsList.firstChild);
            
            showNotification(`Mapa actualizado: ${activeService} - ${projectionType}`, 'success');
        });

        // ##################################################
        // 8. HERRAMIENTAS GEOLÓGICAS (TODAS FUNCIONALES)
        // ##################################################

        document.querySelectorAll('.tool-card').forEach(tool => {
            tool.addEventListener('click', function() {
                const toolType = this.dataset.tool;
                openToolModal(toolType);
            });
        });

        function openToolModal(toolType) {
            const modal = document.getElementById('toolModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            
            modalTitle.innerHTML = `<i class="fas fa-${getToolIcon(toolType)}"></i> ${getToolTitle(toolType)}`;
            
            switch(toolType) {
                case 'mohs':
                    modalContent.innerHTML = getMohsScaleContent();
                    break;
                case 'compass':
                    modalContent.innerHTML = getCompassContent();
                    startCompass();
                    break;
                case 'converter':
                    modalContent.innerHTML = getConverterContent();
                    break;
                case 'streak':
                    modalContent.innerHTML = getStreakColorsContent();
                    break;
                case 'geology':
                    modalContent.innerHTML = getAtacamaGeologyContent();
                    break;
                case 'chemical':
                    modalContent.innerHTML = getChemicalAnalysisContent();
                    break;
            }
            
            modal.classList.add('active');
        }

        function getToolIcon(toolType) {
            const icons = {
                'mohs': 'gem',
                'compass': 'compass',
                'converter': 'ruler-combined',
                'streak': 'palette',
                'geology': 'mountain',
                'chemical': 'vial'
            };
            return icons[toolType] || 'toolbox';
        }

        function getToolTitle(toolType) {
            const titles = {
                'mohs': 'Escala de Mohs',
                'compass': 'Brújula Digital',
                'converter': 'Conversor de Unidades',
                'streak': 'Colores de Raya',
                'geology': 'Geología de Atacama',
                'chemical': 'Análisis Químico'
            };
            return titles[toolType] || 'Herramienta';
        }

        function getMohsScaleContent() {
            const mohsScale = [
                { number: 1, name: 'Talco', example: 'Se raya con la uña' },
                { number: 2, name: 'Yeso', example: 'Se raya con la uña' },
                { number: 3, name: 'Calcita', example: 'Se raya con moneda de cobre' },
                { number: 4, name: 'Fluorita', example: 'Se raya con cuchillo' },
                { number: 5, name: 'Apatito', example: 'Se raya con cuchillo' },
                { number: 6, name: 'Ortoclasa', example: 'Raya al vidrio' },
                { number: 7, name: 'Cuarzo', example: 'Raya al vidrio' },
                { number: 8, name: 'Topacio', example: 'Raya al cuarzo' },
                { number: 9, name: 'Corindón', example: 'Raya al topacio' },
                { number: 10, name: 'Diamante', example: 'El más duro' }
            ];
            
            return `
                <div class="mohs-scale">
                    ${mohsScale.map(item => `
                        <div class="mohs-item">
                            <div class="mohs-number">${item.number}</div>
                            <div class="mohs-name">${item.name}</div>
                            <div class="mohs-example">${item.example}</div>
                        </div>
                    `).join('')}
                </div>
                <p style="margin-top:20px; padding:10px; background:#f8f9fa; border-radius:5px;">
                    <i class="fas fa-info-circle"></i> <strong>Uso práctico:</strong> Presiona el mineral con objetos de referencia conocida. 
                    Si el mineral raya al objeto, es más duro. Si el objeto raya al mineral, es más blando.
                </p>
            `;
        }

        function getCompassContent() {
            return `
                <div class="compass-container">
                    <div class="compass-circle">
                        <div class="compass-degree" id="compassDegree">0°</div>
                        <div class="compass-needle" id="compassNeedle"></div>
                    </div>
                </div>
                <div style="text-align:center; margin-top:20px;">
                    <button class="btn btn-primary" id="calibrateCompass">
                        <i class="fas fa-sync-alt"></i> Calibrar Brújula
                    </button>
                    <p style="margin-top:10px; color:#666;">
                        <i class="fas fa-info-circle"></i> La brújula usa el sensor de orientación del dispositivo
                    </p>
                </div>
            `;
        }

        function startCompass() {
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            window.addEventListener('deviceorientation', handleOrientation);
                        }
                    })
                    .catch(console.error);
            } else {
                window.addEventListener('deviceorientation', handleOrientation);
            }
        }

        function handleOrientation(event) {
            if (event.alpha !== null) {
                compassHeading = event.alpha;
                const compassNeedle = document.getElementById('compassNeedle');
                const compassDegree = document.getElementById('compassDegree');
                
                if (compassNeedle) {
                    compassNeedle.style.transform = `translateY(-50%) rotate(${compassHeading}deg)`;
                }
                if (compassDegree) {
                    compassDegree.textContent = `${Math.round(compassHeading)}°`;
                }
            }
        }

        document.addEventListener('click', function(e) {
            if (e.target && e.target.id === 'calibrateCompass') {
                showNotification('Brújula calibrada', 'success');
            }
        });

        function getConverterContent() {
            return `
                <div class="converter-container">
                    <div class="converter-row">
                        <input type="number" id="convertValue" placeholder="Valor" value="1">
                        <select id="convertFrom">
                            ${conversionUnits.length.map(unit => `<option value="${unit.name}">${unit.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="converter-row">
                        <select id="convertCategory" style="flex:1;">
                            <option value="length">Longitud</option>
                            <option value="weight">Peso</option>
                            <option value="density">Densidad</option>
                        </select>
                    </div>
                    <div class="converter-row">
                        <input type="text" id="convertResult" placeholder="Resultado" readonly>
                        <select id="convertTo">
                            ${conversionUnits.length.map(unit => `<option value="${unit.name}">${unit.name}</option>`).join('')}
                        </select>
                    </div>
                    <button class="btn btn-primary" id="performConversion" style="width:100%; margin-top:10px;">
                        <i class="fas fa-exchange-alt"></i> Convertir
                    </button>
                </div>
                <div id="conversionExamples" style="margin-top:20px; padding:15px; background:#f8f9fa; border-radius:8px;">
                    <h4>Ejemplos comunes:</h4>
                    <p>• 1 metro = 3.28 pies</p>
                    <p>• 1 kilogramo = 2.20 libras</p>
                    <p>• 1 g/cm³ = 62.43 lb/ft³</p>
                </div>
            `;
        }

        // Configurar conversor
        setTimeout(() => {
            if (document.getElementById('performConversion')) {
                document.getElementById('performConversion').addEventListener('click', performConversion);
                
                document.getElementById('convertCategory').addEventListener('change', function() {
                    const category = this.value;
                    const units = conversionUnits[category] || conversionUnits.length;
                    
                    const fromSelect = document.getElementById('convertFrom');
                    const toSelect = document.getElementById('convertTo');
                    
                    fromSelect.innerHTML = units.map(unit => `<option value="${unit.factor}">${unit.name}</option>`).join('');
                    toSelect.innerHTML = units.map(unit => `<option value="${unit.factor}">${unit.name}</option>`).join('');
                });
                
                // Inicializar con longitud
                document.getElementById('convertCategory').dispatchEvent(new Event('change'));
            }
        }, 100);

        function performConversion() {
            const value = parseFloat(document.getElementById('convertValue').value) || 0;
            const fromFactor = parseFloat(document.getElementById('convertFrom').value);
            const toFactor = parseFloat(document.getElementById('convertTo').value);
            
            if (fromFactor && toFactor) {
                const result = value * (toFactor / fromFactor);
                document.getElementById('convertResult').value = result.toFixed(4);
                showNotification('Conversión realizada', 'success');
            }
        }

        function getStreakColorsContent() {
            return `
                <h4>Colores de Raya Típicos</h4>
                <p>El color de la raya es el color del polvo de un mineral cuando se frota sobre porcelana.</p>
                <div class="streak-colors">
                    ${streakColors.map(color => `
                        <div class="streak-color" style="background:${color.color};" 
                             onclick="showNotification('Color de raya: ${color.name}\\nMinerales: ${color.minerals}', 'warning')">
                            ${color.name}
                        </div>
                    `).join('')}
                </div>
                <div style="margin-top:20px; padding:15px; background:#f8f9fa; border-radius:8px;">
                    <h5><i class="fas fa-lightbulb"></i> Cómo realizar la prueba:</h5>
                    <ol>
                        <li>Usa una placa de porcelana sin vidriar (raya)</li>
                        <li>Frota el mineral con fuerza sobre la placa</li>
                        <li>Observa el color del polvo dejado</li>
                        <li>Compara con la tabla de referencia</li>
                    </ol>
                </div>
            `;
        }

        function getAtacamaGeologyContent() {
            return `
                <div class="atacama-info">
                    <div class="atacama-card">
                        <h4><i class="fas fa-mountain"></i> Geología Regional</h4>
                        <p>El Desierto de Atacama posee una compleja historia geológica con:</p>
                        <ul>
                            <li>Rocas del Precámbrico a Cenozoico</li>
                            <li>Intensa actividad volcánica</li>
                            <li>Grandes sistemas de fallas</li>
                            <li>Depósitos minerales únicos</li>
                        </ul>
                    </div>
                    <div class="atacama-card">
                        <h4><i class="fas fa-gem"></i> Mineralización</h4>
                        <p>Principales yacimientos:</p>
                        <ul>
                            <li>Cobre (pórfidos cupríferos)</li>
                            <li>Oro (vetas epitermales)</li>
                            <li>Litio (salares)</li>
                            <li>Plata (vetas polimetálicas)</li>
                        </ul>
                    </div>
                    <div class="atacama-card">
                        <h4><i class="fas fa-volcano"></i> Volcanismo</h4>
                        <p>Arco volcánico andino activo:</p>
                        <ul>
                            <li>Ojos del Salado (6.893 m)</li>
                            <li>Llullaillaco (6.739 m)</li>
                            <li>Cerro de Incahuasi (6.621 m)</li>
                        </ul>
                    </div>
                    <div class="atacama-card">
                        <h4><i class="fas fa-water"></i> Salares</h4>
                        <p>Depósitos evaporíticos:</p>
                        <ul>
                            <li>Salar de Atacama</li>
                            <li>Mar de Dunas</li>
                            <li>Reservas de litio mundiales</li>
                        </ul>
                    </div>
                </div>
                <div style="margin-top:20px; padding:15px; background:#e8f4fc; border-radius:8px; border-left:4px solid var(--accent2);">
                    <h5><i class="fas fa-map-marked-alt"></i> Zonas Geológicas Principales</h5>
                    <p><strong>Cordillera de la Costa:</strong> Rocas sedimentarias y volcánicas paleozoicas</p>
                    <p><strong>Depresión Central:</strong> Cuencas sedimentarias cenozoicas</p>
                    <p><strong>Precordillera:</strong> Rocas intrusivas mesozoicas</p>
                    <p><strong>Cordillera Principal:</strong> Volcanismo activo y pórfidos cupríferos</p>
                </div>
            `;
        }

        function getChemicalAnalysisContent() {
            return `
                <div style="padding:10px;">
                    <h4><i class="fas fa-atom"></i> Análisis Químico Completo</h4>
                    <p>Esta herramienta permite realizar análisis químicos avanzados de minerales:</p>
                    
                    <div style="margin:20px 0; padding:15px; background:#f0f8ff; border-radius:8px;">
                        <h5><i class="fas fa-vial"></i> Pruebas Disponibles:</h5>
                        <div class="test-grid" style="margin-top:10px;">
                            <div class="test-card" onclick="showNotification('Análisis XRD iniciado', 'warning')">
                                <h4><i class="fas fa-wave-square"></i> Difracción de Rayos X</h4>
                                <p>Identificación de fases cristalinas</p>
                            </div>
                            <div class="test-card" onclick="showNotification('Análisis XRF iniciado', 'warning')">
                                <h4><i class="fas fa-atom"></i> Fluorescencia de Rayos X</h4>
                                <p>Composición elemental cuantitativa</p>
                            </div>
                            <div class="test-card" onclick="showNotification('Microscopía electrónica', 'warning')">
                                <h4><i class="fas fa-microscope"></i> SEM-EDS</h4>
                                <p>Microscopía y análisis elemental</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin:20px 0; padding:15px; background:#fff8e1; border-radius:8px;">
                        <h5><i class="fas fa-calculator"></i> Cálculos Químicos</h5>
                        <div class="form-group">
                            <label>Fórmula Química:</label>
                            <input type="text" class="form-control" id="chemicalInput" placeholder="Ej: CaCO₃, Fe₂O₃">
                        </div>
                        <button class="btn btn-primary" onclick="calculateFormula()" style="width:100%;">
                            <i class="fas fa-calculator"></i> Calcular Composición
                        </button>
                        <div id="chemicalResult" style="margin-top:15px;"></div>
                    </div>
                </div>
            `;
        }

        function calculateFormula() {
            const formula = document.getElementById('chemicalInput').value;
            if (!formula) {
                showNotification('Ingresa una fórmula química', 'error');
                return;
            }
            
            document.getElementById('chemicalResult').innerHTML = `
                <div style="padding:10px; background:#f8f9fa; border-radius:5px;">
                    <p><strong>Fórmula:</strong> ${formula}</p>
                    <p><strong>Análisis:</strong> Cálculo de pesos moleculares y composición porcentual</p>
                    <p><strong>Resultado:</strong> Análisis químico simulado completado</p>
                </div>
            `;
            showNotification('Análisis químico calculado', 'success');
        }

        // ##################################################
        // 9. INICIALIZACIÓN FINAL
        // ##################################################

        // Inicializar cuando se carga la página
        document.addEventListener('DOMContentLoaded', () => {
            initCoverflow();
            showNotification('AtacamApp cargado correctamente', 'success');
        });
    </script>
</body>
</html>
