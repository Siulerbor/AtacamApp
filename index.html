<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AtacamApp ‚öíÔ∏è - Geolog√≠a Inteligente</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        /* === SPLASH SCREEN === */
        #splashScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a1a 0%, #2c3e50 100%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .splash-content {
            text-align: center;
            z-index: 2;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }

        .splash-logo {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: #d35400;
            text-shadow: 0 0 20px rgba(211, 84, 0, 0.7);
        }

        .splash-title {
            font-size: 2.5rem;
            color: white;
            margin-bottom: 10px;
            font-weight: bold;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        .splash-subtitle {
            font-size: 1.2rem;
            color: #ecf0f1;
            margin-bottom: 40px;
            opacity: 0.9;
        }

        .loading-bar {
            width: 200px;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 30px;
            backdrop-filter: blur(5px);
        }

        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, #d35400, #f39c12);
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(211, 84, 0, 0.5);
        }

        .particles-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #d35400;
            border-radius: 50%;
            box-shadow: 0 0 10px #f39c12;
            opacity: 0;
            z-index: 1;
        }

        .infinity-symbol {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 100px;
            z-index: 2;
            opacity: 0;
            pointer-events: none;
        }

        .infinity-path {
            fill: none;
            stroke: #d35400;
            stroke-width: 3;
            stroke-linecap: round;
            filter: drop-shadow(0 0 10px rgba(211, 84, 0, 0.7));
        }

        .splash-message {
            color: #f39c12;
            margin-top: 20px;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* === VARIABLES GLASSMORPHISM === */
        :root {
            --primary: #d35400;
            --primary-dark: #a84300;
            --secondary: #2c3e50;
            --accent: #f39c12;
            --success: #27ae60;
            --info: #3498db;
            --warning: #f1c40f;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --desert-sand: #e6b17e;
            --mountain-brown: #8b7355;
            --sky-blue: #87ceeb;
            
            /* Glassmorphism Variables */
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-bg-dark: rgba(30, 30, 30, 0.7);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-border-light: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            --glass-blur: blur(15px);
            --glass-radius: 20px;
            --glass-inset-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2c3e50 100%);
            color: #fff;
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
            position: relative;
        }

        /* Fondo del desierto con efecto glass */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 85% 15%, rgba(241, 196, 15, 0.2) 0%, rgba(241, 196, 15, 0.05) 15%, transparent 25%),
                linear-gradient(to bottom, rgba(135, 206, 235, 0.3) 0%, rgba(135, 206, 235, 0.15) 20%, transparent 40%),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><defs><linearGradient id="mountains" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:%238b7355;stop-opacity:0.2"/><stop offset="100%" style="stop-color:%23a1886d;stop-opacity:0.2"/></linearGradient><linearGradient id="desert" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:%23e6b17e;stop-opacity:0.15"/><stop offset="100%" style="stop-color:%23d4ac6d;stop-opacity:0.15"/></linearGradient></defs><rect width="1200" height="800" fill="url(%23desert)"/><path d="M0,500 L200,400 L400,450 L600,350 L800,400 L1000,380 L1200,500 L1200,800 L0,800 Z" fill="url(%23mountains)"/><path d="M0,550 L150,500 L300,520 L450,480 L600,500 L750,490 L900,510 L1050,480 L1200,550 L1200,800 L0,800 Z" fill="%236b5b45" opacity="0.2"/></svg>');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.3;
            z-index: -2;
            pointer-events: none;
            backdrop-filter: var(--glass-blur);
        }

        /* Efecto de vidrio base */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 26, 26, 0.7);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            z-index: -1;
        }

        /* === CONTENEDOR PRINCIPAL === */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* === HEADER CON GLASSMORPHISM === */
        .app-header {
            background: var(--glass-bg-dark);
            color: white;
            padding: 20px 25px;
            border-radius: var(--glass-radius);
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            position: relative;
            overflow: hidden;
            animation: headerFloat 6s ease-in-out infinite;
        }

        @keyframes headerFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .app-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(211, 84, 0, 0.5), 
                transparent);
        }

        .app-header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .header-subtitle {
            font-size: 0.95rem;
            opacity: 0.9;
            margin-bottom: 15px;
            color: var(--light);
            font-weight: 300;
        }

        .status-bar {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            font-size: 0.85rem;
            border: 1px solid rgba(255, 255, 255, 0.15);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .status-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            border-color: rgba(211, 84, 0, 0.3);
            box-shadow: 0 5px 15px rgba(211, 84, 0, 0.2);
        }

        .status-item.active {
            background: rgba(211, 84, 0, 0.25);
            border-color: var(--primary);
            animation: pulse 2s infinite;
            box-shadow: 0 0 15px rgba(211, 84, 0, 0.3);
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(211, 84, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(211, 84, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(211, 84, 0, 0); }
        }

        .badge {
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 12px;
            margin-left: 5px;
            font-weight: bold;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .badge-gps { background: rgba(39, 174, 96, 0.8); color: white; }
        .badge-camera { background: rgba(241, 196, 15, 0.8); color: black; }
        .badge-geo { background: rgba(52, 152, 219, 0.8); color: white; }
        .badge-danger { background: rgba(231, 76, 60, 0.8); color: white; }

        /* === LAYOUT GRID RESPONSIVO === */
        .app-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .app-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1200px) {
            .app-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* === TARJETAS CON GLASSMORPHISM === */
        .card {
            background: var(--glass-bg-dark);
            border-radius: var(--glass-radius);
            padding: 25px;
            box-shadow: var(--glass-shadow);
            margin-bottom: 20px;
            border: 1px solid var(--glass-border);
            position: relative;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(211, 84, 0, 0.3), 
                transparent);
        }

        .card:hover {
            transform: translateY(-8px) scale(1.01);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(211, 84, 0, 0.4);
        }

        .card h2 {
            color: white;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .card h2 i {
            color: var(--accent);
            font-size: 1.2em;
        }

        /* Bot√≥n de cerrar con glass */
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 1.3rem;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
            z-index: 10;
            backdrop-filter: blur(5px);
        }

        .close-btn:hover {
            background: rgba(231, 76, 60, 0.3);
            color: white;
            transform: rotate(90deg);
            border-color: rgba(231, 76, 60, 0.5);
        }

        /* === C√ÅMARA CON GLASS === */
        .camera-container {
            position: relative;
            width: 100%;
            height: 240px;
            background: rgba(44, 62, 80, 0.6);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
            border: 2px solid rgba(211, 84, 0, 0.4);
            box-shadow: var(--glass-inset-shadow);
        }

        .camera-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }

        .camera-placeholder {
            text-align: center;
            padding: 30px;
            color: white;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(5px);
        }

        .camera-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        /* === BOTONES CON GLASSMORPHISM === */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, 
                rgba(211, 84, 0, 0.8), 
                rgba(168, 67, 0, 0.8));
            box-shadow: 0 4px 15px rgba(211, 84, 0, 0.3);
        }

        .btn-primary:hover {
            box-shadow: 0 8px 25px rgba(211, 84, 0, 0.4);
        }

        .btn-secondary {
            background: rgba(52, 152, 219, 0.8);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: rgba(39, 174, 96, 0.8);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .btn-warning {
            background: rgba(241, 196, 15, 0.8);
            color: #333;
            box-shadow: 0 4px 15px rgba(241, 196, 15, 0.3);
        }

        .btn-danger {
            background: rgba(231, 76, 60, 0.8);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* === COLECCI√ìN MINERAL√ìGICA - COVERFLOW === */
        .coverflow-container {
            width: 100%;
            height: 180px;
            perspective: 1000px;
            position: relative;
            margin: 20px 0;
            overflow: hidden;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .coverflow {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            position: relative;
        }

        .mineral-card {
            position: absolute;
            width: 100px;
            height: 120px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: 2px solid transparent;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .mineral-card.active {
            border-color: var(--primary);
            transform: scale(1.15);
            z-index: 10;
            box-shadow: 0 15px 35px rgba(211, 84, 0, 0.4);
        }

        .mineral-card .emoji {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .coverflow-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px;
            margin-top: 15px;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            color: white;
        }

        .nav-btn:hover {
            background: var(--primary);
            transform: rotate(15deg);
            box-shadow: 0 5px 15px rgba(211, 84, 0, 0.3);
        }

        /* === MAPA CON GLASS === */
        .map-container {
            width: 100%;
            height: 240px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
            border: 2px solid rgba(211, 84, 0, 0.4);
            position: relative;
            box-shadow: var(--glass-inset-shadow);
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .map-controls {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 1000;
            display: flex;
            gap: 8px;
            flex-direction: column;
        }

        /* === KIT DE CAMPO - BR√öJULA GEOL√ìGICA === */
        .geological-compass {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            position: relative;
        }

        .compass-outer {
            width: 100%;
            height: 100%;
            border: 15px solid rgba(139, 115, 85, 0.7);
            border-radius: 50%;
            position: relative;
            background: linear-gradient(135deg, rgba(245, 222, 179, 0.9), rgba(210, 180, 140, 0.9));
            box-shadow: 
                inset 0 0 30px rgba(0,0,0,0.3),
                0 8px 25px rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
        }

        .compass-inner {
            width: 80%;
            height: 80%;
            position: absolute;
            top: 10%;
            left: 10%;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .compass-rose {
            width: 90%;
            height: 90%;
            position: relative;
        }

        .compass-point {
            position: absolute;
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--secondary);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .north { top: 5%; left: 50%; transform: translateX(-50%); color: #e74c3c; }
        .south { bottom: 5%; left: 50%; transform: translateX(-50%); }
        .east { right: 5%; top: 50%; transform: translateY(-50%); }
        .west { left: 5%; top: 50%; transform: translateY(-50%); }

        .compass-needle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 4px;
            height: 70px;
            background: linear-gradient(to top, #e74c3c, #c0392b);
            transform-origin: center bottom;
            z-index: 2;
            border-radius: 2px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .compass-needle::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: -8px;
            width: 20px;
            height: 20px;
            background: #e74c3c;
            border-radius: 50%;
        }

        .declination {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: white;
            background: rgba(0, 0, 0, 0.6);
            padding: 5px 12px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
        }

        /* === KIT DE CAMPO - GRID === */
        .kit-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        .kit-item {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            color: white;
        }

        .kit-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            border-color: rgba(211, 84, 0, 0.4);
        }

        .kit-item i {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--accent);
        }

        /* === ESCALA DE MOHS INTERACTIVA === */
        .mohs-scale {
            margin-top: 20px;
        }

        .mohs-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s;
            cursor: pointer;
            backdrop-filter: blur(5px);
        }

        .mohs-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .mohs-level {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.3rem;
            margin-right: 15px;
            flex-shrink: 0;
            box-shadow: 0 4px 15px rgba(211, 84, 0, 0.3);
        }

        .mohs-info {
            flex: 1;
        }

        .mohs-info h4 {
            color: white;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .mohs-info p {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        /* === COLORES DE RAYA === */
        .streak-colors {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .streak-item {
            text-align: center;
            padding: 15px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
            backdrop-filter: blur(5px);
        }

        .streak-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            border-color: rgba(211, 84, 0, 0.4);
        }

        .streak-color {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            margin: 0 auto 10px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* === FRACTURAS === */
        .fractures-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .fracture-item {
            padding: 20px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
            backdrop-filter: blur(5px);
        }

        .fracture-item:hover {
            border-color: rgba(211, 84, 0, 0.4);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .fracture-emoji {
            font-size: 2.5rem;
            margin-bottom: 12px;
        }

        /* === PROYECCI√ìN 3D === */
        .projection-3d {
            width: 100%;
            height: 220px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8));
            border-radius: 15px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--glass-inset-shadow);
        }

        .terrain-model {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .terrain-layer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, var(--desert-sand), var(--mountain-brown));
            border-radius: 8px 8px 0 0;
            transition: height 0.5s;
            opacity: 0.9;
        }

        .mineral-deposit {
            position: absolute;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.7);
            animation: pulse-glow 2s infinite;
            border: 2px solid rgba(255, 255, 255, 0.8);
        }

        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
                transform: translate(-50%, -50%) scale(1);
            }
            50% { 
                box-shadow: 0 0 25px rgba(255, 255, 255, 0.9);
                transform: translate(-50%, -50%) scale(1.1);
            }
        }

        /* === CHAT IA CON GLASS === */
        .chat-container {
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 380px;
            height: 500px;
            background: var(--glass-bg-dark);
            border-radius: var(--glass-radius);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            z-index: 10000;
            display: none;
            flex-direction: column;
            border: 1px solid var(--glass-border);
            overflow: hidden;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            animation: chatAppear 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes chatAppear {
            from { 
                transform: translateY(20px) scale(0.95);
                opacity: 0;
            }
            to { 
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .chat-header {
            background: linear-gradient(135deg, 
                rgba(44, 62, 80, 0.9), 
                rgba(52, 73, 94, 0.9));
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
        }

        .chat-input {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 12px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 18px;
            border-radius: 18px;
            max-width: 85%;
            font-size: 0.95rem;
            line-height: 1.4;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: messageAppear 0.3s ease-out;
        }

        @keyframes messageAppear {
            from { 
                opacity: 0;
                transform: translateY(10px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            background: linear-gradient(135deg, 
                rgba(211, 84, 0, 0.8), 
                rgba(168, 67, 0, 0.8));
            color: white;
            margin-left: auto;
            border-radius: 18px 18px 0 18px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(211, 84, 0, 0.3);
        }

        .message.ai {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border-radius: 18px 18px 18px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        /* === MODAL CON GLASSMORPHISM === */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 20px;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            animation: modalBgAppear 0.3s ease-out;
        }

        @keyframes modalBgAppear {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--glass-bg-dark);
            border-radius: var(--glass-radius);
            padding: 0;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow: hidden;
            border: 1px solid var(--glass-border);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
            animation: modalContentAppear 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
        }

        @keyframes modalContentAppear {
            from { 
                transform: scale(0.9) translateY(20px);
                opacity: 0;
            }
            to { 
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        /* === CLIMA CON GLASS === */
        .weather-card {
            background: linear-gradient(135deg, 
                rgba(52, 152, 219, 0.8), 
                rgba(41, 128, 185, 0.8));
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-top: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        /* === NOTIFICACIONES CON GLASS === */
        .notification {
            position: fixed;
            top: 25px;
            right: 25px;
            background: var(--glass-bg-dark);
            color: white;
            padding: 18px 24px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 350px;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        @keyframes slideIn {
            from { 
                transform: translateX(100%) translateY(-20px);
                opacity: 0;
            }
            to { 
                transform: translateX(0) translateY(0);
                opacity: 1;
            }
        }

        /* === FORMULARIOS CON GLASS === */
        .form-control {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            font-size: 0.95rem;
            margin-bottom: 15px;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: white;
            font-family: inherit;
        }

        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(211, 84, 0, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }

        /* === REPORTES CON GLASS === */
        .report-preview {
            max-height: 220px;
            overflow-y: auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            border: 2px dashed rgba(255, 255, 255, 0.2);
            margin-top: 15px;
            backdrop-filter: blur(5px);
        }

        /* === INFORMACI√ìN DE MINERALES === */
        .mineral-info {
            text-align: center;
            padding: 15px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            margin-top: 10px;
            backdrop-filter: blur(5px);
        }

        /* === BARRA DE DESPLAZAMIENTO PERSONALIZADA === */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(211, 84, 0, 0.5);
            border-radius: 4px;
            transition: background 0.3s;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(211, 84, 0, 0.7);
        }

        /* === RESPONSIVE PARA M√ìVILES === */
        @media (max-width: 768px) {
            #splashScreen .splash-title {
                font-size: 1.8rem;
            }
            
            #splashScreen .splash-logo {
                font-size: 2.2rem;
            }
            
            .app-header h1 { 
                font-size: 1.5rem; 
            }
            
            .status-item { 
                padding: 6px 12px; 
                font-size: 0.8rem; 
            }
            
            .card { 
                padding: 18px; 
            }
            
            .kit-grid { 
                grid-template-columns: repeat(2, 1fr); 
            }
            
            .chat-container { 
                width: calc(100% - 30px); 
                right: 15px; 
                bottom: 15px; 
                height: 450px;
            }
            
            .geological-compass { 
                width: 160px; 
                height: 160px; 
            }
            
            .modal-content {
                width: 95%;
                max-height: 80vh;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 480px) {
            .app-grid {
                gap: 15px;
            }
            
            .card {
                margin-bottom: 15px;
            }
            
            .camera-controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .kit-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .streak-colors,
            .fractures-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .splash-content {
                padding: 25px 20px;
                margin: 0 15px;
            }
        }

        /* === EFECTO DE PART√çCULAS FLOTANTES === */
        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .floating-particle {
            position: absolute;
            background: rgba(211, 84, 0, 0.15);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Part√≠culas flotantes de fondo -->
    <div class="floating-particles" id="floatingParticles"></div>

    <!-- Splash Screen -->
    <div id="splashScreen">
        <div class="particles-container" id="particlesContainer"></div>
        
        <div class="infinity-symbol" id="infinitySymbol">
            <svg viewBox="0 0 200 100">
                <path class="infinity-path" d="M50,50 C50,30 70,30 70,50 C70,70 90,70 90,50 C90,30 110,30 110,50 C110,70 130,70 130,50 C130,30 150,30 150,50"/>
            </svg>
        </div>
        
        <div class="splash-content">
            <div class="splash-logo">üèúÔ∏è‚öíÔ∏è</div>
            <h1 class="splash-title">AtacamApp</h1>
            <div class="splash-subtitle">Geolog√≠a Inteligente del Desierto</div>
            
            <div class="loading-bar">
                <div class="loading-progress" id="loadingProgress"></div>
            </div>
            
            <div class="splash-message" id="splashMessage">Inicializando sistema...</div>
        </div>
    </div>

    <!-- Aplicaci√≥n Principal -->
    <div class="container" id="mainApp" style="display: none; opacity: 0;">
        <!-- Header -->
        <header class="app-header">
            <h1>üèúÔ∏è AtacamApp ‚öíÔ∏è</h1>
            <div class="header-subtitle">Geolog√≠a Inteligente ‚Ä¢ GPS Real ‚Ä¢ C√°mara HD ‚Ä¢ IA Especializada</div>
            
            <div class="status-bar">
                <div class="status-item active" id="gpsStatus" onclick="activateGPS()">
                    <i class="fas fa-satellite"></i>
                    <span>GPS: HAZ CLICK üõ∞Ô∏è</span>
                    <span class="badge badge-gps">OBLIGATORIO</span>
                </div>
                <div class="status-item" id="cameraStatus" onclick="activateCamera()">
                    <i class="fas fa-camera"></i>
                    <span>C√ÅMARA: HAZ CLICK üì∏</span>
                    <span class="badge badge-camera">HD 1080p</span>
                </div>
                <div class="status-item" onclick="toggleChat()">
                    <i class="fas fa-robot"></i>
                    <span>GEOBOT IA ü§ñ</span>
                    <span class="badge badge-geo">CONECTAR</span>
                </div>
            </div>
        </header>

        <!-- Grid Principal -->
        <div class="app-grid">
            <!-- Columna 1: C√°mara y Reportes -->
            <div class="column">
                <!-- C√°mara -->
                <section class="card">
                    <button class="close-btn" onclick="closeCard(this)">√ó</button>
                    <h2><i class="fas fa-camera"></i> C√°mara Geol√≥gica</h2>
                    
                    <div class="camera-container" id="cameraContainer">
                        <video class="camera-feed" id="cameraFeed" autoplay playsinline></video>
                        <canvas id="cameraCanvas" style="display:none"></canvas>
                        
                        <div class="camera-placeholder" id="cameraPlaceholder">
                            <div style="font-size: 3.5rem;">üì∑</div>
                            <p style="margin-top: 15px;">Click en "C√ÅMARA" para activar</p>
                            <small>Calidad HD 1920x1080</small>
                        </div>
                    </div>
                    
                    <div class="camera-controls">
                        <button class="btn btn-primary" onclick="captureAndAnalyze()">
                            <i class="fas fa-search"></i> Identificar
                        </button>
                        <button class="btn btn-secondary" onclick="changeCameraQuality()">
                            <i class="fas fa-cog"></i> Calidad
                        </button>
                        <button class="btn btn-warning" onclick="toggleFlash()">
                            <i class="fas fa-bolt"></i> Flash
                        </button>
                    </div>
                    
                    <div id="analysisResult" style="display:none; margin-top:15px; padding:15px; background:rgba(255,255,255,0.1); border-radius:12px; backdrop-filter:blur(10px);">
                        <div id="mineralResult"></div>
                    </div>
                </section>

                <!-- Informes -->
                <section class="card">
                    <button class="close-btn" onclick="closeCard(this)">√ó</button>
                    <h2><i class="fas fa-file-alt"></i> Informes Inteligentes</h2>
                    
                    <div>
                        <input type="text" class="form-control" id="reportTitle" placeholder="T√≠tulo del informe" value="Informe Geol√≥gico de Campo">
                        <textarea class="form-control" id="reportNotes" rows="3" placeholder="Observaciones del ge√≥logo...">Muestras colectadas en terreno con identificaci√≥n in-situ. Se observa mineralizaci√≥n de cobre en vetas de cuarzo.</textarea>
                        
                        <div class="camera-controls">
                            <button class="btn btn-success" onclick="generateReport()">
                                <i class="fas fa-magic"></i> Generar
                            </button>
                            <button class="btn btn-secondary" onclick="viewReports()">
                                <i class="fas fa-history"></i> Historial
                            </button>
                        </div>
                    </div>
                    
                    <div class="report-preview" id="reportPreview">
                        <div style="text-align:center; padding:30px; color:rgba(255,255,255,0.7);">
                            <div style="font-size:2.5rem;">üìã</div>
                            <p style="margin-top:10px;">El informe aparecer√° aqu√≠</p>
                            <small>Incluye t√≠tulo y observaciones</small>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Columna 2: Mapa y Minerales -->
            <div class="column">
                <!-- Mapa -->
                <section class="card">
                    <button class="close-btn" onclick="closeCard(this)">√ó</button>
                    <h2><i class="fas fa-map-marked-alt"></i> Mapa Geol√≥gico</h2>
                    
                    <div class="map-container">
                        <div id="map"></div>
                        <div class="map-controls">
                            <button class="btn btn-primary" onclick="centerMap()" style="padding:8px 12px; font-size:0.9rem; background:rgba(211,84,0,0.8);">
                                <i class="fas fa-location-arrow"></i>
                            </button>
                            <button class="btn btn-secondary" onclick="addMarker()" style="padding:8px 12px; font-size:0.9rem; background:rgba(52,152,219,0.8);">
                                <i class="fas fa-map-pin"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="camera-controls">
                        <button class="btn btn-primary" onclick="loadGeologicalLayers()">
                            <i class="fas fa-layer-group"></i> Capas
                        </button>
                        <button class="btn btn-warning" onclick="loadLocalMinerals()">
                            <i class="fas fa-gem"></i> Minerales 20km
                        </button>
                    </div>
                </section>

                <!-- Colecci√≥n Mineral√≥gica -->
                <section class="card">
                    <button class="close-btn" onclick="closeCard(this)">√ó</button>
                    <h2><i class="fas fa-gem"></i> Colecci√≥n Mineral√≥gica</h2>
                    
                    <div class="coverflow-container">
                        <div class="coverflow" id="coverflow">
                            <!-- Minerales cargados din√°micamente -->
                        </div>
                    </div>
                    
                    <div class="coverflow-nav">
                        <button class="nav-btn" onclick="prevMineral()">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span id="mineralCounter" style="font-size:1rem; font-weight:bold; color:white;">0/0</span>
                        <button class="nav-btn" onclick="nextMineral()">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    
                    <div class="mineral-info" id="mineralInfo">
                        Cargando minerales locales...
                    </div>
                </section>
            </div>

            <!-- Columna 3: Herramientas y Proyecci√≥n -->
            <div class="column">
                <!-- Kit de Campo -->
                <section class="card">
                    <button class="close-btn" onclick="closeCard(this)">√ó</button>
                    <h2><i class="fas fa-tools"></i> Kit de Campo</h2>
                    
                    <div class="kit-grid">
                        <div class="kit-item" onclick="openTool('compass')">
                            <i class="fas fa-compass"></i>
                            <div>Br√∫jula</div>
                        </div>
                        <div class="kit-item" onclick="openTool('mohs')">
                            <i class="fas fa-gem"></i>
                            <div>Escala Mohs</div>
                        </div>
                        <div class="kit-item" onclick="openTool('streak')">
                            <i class="fas fa-palette"></i>
                            <div>Colores Raya</div>
                        </div>
                        <div class="kit-item" onclick="openTool('fracture')">
                            <i class="fas fa-bolt"></i>
                            <div>Fracturas</div>
                        </div>
                        <div class="kit-item" onclick="openTool('calculator')">
                            <i class="fas fa-calculator"></i>
                            <div>Calculadora</div>
                        </div>
                        <div class="kit-item" onclick="openTool('weather')">
                            <i class="fas fa-cloud-sun"></i>
                            <div>Clima</div>
                        </div>
                    </div>
                    
                    <!-- Br√∫jula integrada -->
                    <div id="compassContainer" style="margin-top:20px; display:none;">
                        <div class="geological-compass">
                            <div class="compass-outer">
                                <div class="compass-inner">
                                    <div class="compass-rose">
                                        <div class="compass-point north">N</div>
                                        <div class="compass-point south">S</div>
                                        <div class="compass-point east">E</div>
                                        <div class="compass-point west">W</div>
                                        <div class="compass-needle" id="compassNeedle"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="declination" id="declination">Declinaci√≥n: 0¬∞</div>
                        </div>
                        <div style="text-align:center; margin-top:15px;">
                            <div id="compassDirection" style="font-weight:bold; font-size:1.2rem; color:#f39c12;">NORTE MAGN√âTICO</div>
                            <div id="compassDegrees" style="color:rgba(255,255,255,0.8); margin-top:5px;">0¬∞</div>
                            <button class="btn btn-outline" onclick="calibrateCompass()" style="margin-top:15px; padding:10px 20px; width:100%; max-width:250px;">
                                <i class="fas fa-sync-alt"></i> Calibrar con GPS
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Proyecci√≥n 3D -->
                <section class="card">
                    <button class="close-btn" onclick="closeCard(this)">√ó</button>
                    <h2><i class="fas fa-cube"></i> Proyecci√≥n 3D</h2>
                    
                    <div class="projection-3d">
                        <div class="terrain-model" id="terrainModel">
                            <!-- Terreno generado din√°micamente -->
                        </div>
                    </div>
                    
                    <div class="camera-controls">
                        <button class="btn btn-primary" onclick="generate3DProjection()">
                            <i class="fas fa-play"></i> Generar
                        </button>
                        <button class="btn btn-secondary" onclick="loadSIGEXData()">
                            <i class="fas fa-database"></i> SIGEX
                        </button>
                    </div>
                    
                    <div id="projectionInfo" style="font-size:0.85rem; color:rgba(255,255,255,0.7); margin-top:10px; padding:10px; background:rgba(0,0,0,0.2); border-radius:10px;">
                        Basado en datos SIGEX/GeoCatMin y Mindat.org
                    </div>
                </section>

                <!-- Geobot IA -->
                <section class="card">
                    <button class="close-btn" onclick="closeCard(this)">√ó</button>
                    <h2><i class="fas fa-robot"></i> Geobot IA</h2>
                    
                    <div style="background:rgba(232,244,252,0.15); padding:20px; border-radius:15px; margin-bottom:15px; backdrop-filter:blur(10px); border:1px solid rgba(255,255,255,0.1);">
                        <p style="font-size:0.95rem; margin-bottom:15px; color:rgba(255,255,255,0.9);">Asistente especializado en geolog√≠a de Atacama</p>
                        <button class="btn btn-primary" onclick="toggleChat()" style="width:100%; padding:14px;">
                            <i class="fas fa-comments"></i> Abrir Chat
                        </button>
                    </div>
                    
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                        <button class="btn btn-outline" onclick="quickAnalysis()" style="padding:12px; font-size:0.9rem;">
                            <i class="fas fa-chart-line"></i> An√°lisis
                        </button>
                        <button class="btn btn-outline" onclick="exportData()" style="padding:12px; font-size:0.9rem;">
                            <i class="fas fa-file-export"></i> Exportar
                        </button>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Chat IA -->
    <div class="chat-container" id="chatContainer">
        <div class="chat-header">
            <div style="display:flex; align-items:center; gap:10px;">
                <i class="fas fa-robot" style="color:#f39c12;"></i>
                <span>Geobot IA - Especialista Geol√≥gico</span>
            </div>
            <button class="close-btn" onclick="toggleChat()" style="color:white;">√ó</button>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <div class="message ai">
                ¬°Hola! Soy Geobot, tu asistente especializado en geolog√≠a de Atacama. 
                Puedo ayudarte con identificaci√≥n de minerales, an√°lisis de muestras, 
                interpretaci√≥n de datos GPS y generaci√≥n de informes t√©cnicos. 
                ¬øEn qu√© puedo ayudarte hoy? üèîÔ∏è
            </div>
        </div>
        
        <div class="chat-input">
            <input type="text" id="chatInput" placeholder="Escribe tu pregunta geol√≥gica..." class="form-control" style="flex:1;">
            <button class="btn btn-primary" onclick="sendMessage()" style="padding:12px 20px;">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Modal para herramientas -->
    <div class="modal" id="toolModal">
        <div class="modal-content">
            <div class="chat-header" style="border-radius:20px 20px 0 0;">
                <span id="modalTitle">Herramienta</span>
                <button class="close-btn" onclick="closeModal()" style="color:white;">√ó</button>
            </div>
            <div id="modalContent" style="padding:25px; max-height:calc(85vh - 80px); overflow-y:auto;"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ============================================
        // SISTEMA DE SPLASH SCREEN CON PART√çCULAS
        // ============================================
        
        let particles = [];
        let splashActive = true;
        
        function initSplashScreen() {
            console.log('üé¨ Iniciando splash screen con part√≠culas...');
            
            // Crear part√≠culas flotantes de fondo
            createFloatingParticles();
            
            // Crear 100 part√≠culas para el infinito
            createParticles();
            
            // Iniciar animaci√≥n del s√≠mbolo infinito
            setTimeout(() => {
                animateInfinitySymbol();
            }, 500);
            
            // Iniciar secuencia de carga
            startLoadingSequence();
        }
        
        function createFloatingParticles() {
            const container = document.getElementById('floatingParticles');
            const particleCount = 30;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'floating-particle';
                
                const size = 3 + Math.random() * 10;
                const left = Math.random() * 100;
                const delay = Math.random() * 20;
                const duration = 15 + Math.random() * 20;
                
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${left}%`;
                particle.style.animationDelay = `${delay}s`;
                particle.style.animationDuration = `${duration}s`;
                
                // Color aleatorio en tonos naranja/desierto
                const hue = 20 + Math.random() * 40;
                const opacity = 0.05 + Math.random() * 0.15;
                particle.style.background = `hsla(${hue}, 100%, 60%, ${opacity})`;
                
                container.appendChild(particle);
            }
        }
        
        function createParticles() {
            const container = document.getElementById('particlesContainer');
            const particleCount = 100;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Posici√≥n aleatoria
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                const size = 4 + Math.random() * 8;
                const hue = 20 + Math.random() * 40; // Naranjas
                
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${x}%`;
                particle.style.top = `${y}%`;
                particle.style.background = `hsl(${hue}, 100%, 50%)`;
                particle.style.boxShadow = `0 0 ${size*2}px hsl(${hue}, 100%, 50%)`;
                
                container.appendChild(particle);
                particles.push({
                    element: particle,
                    x, y,
                    targetX: 50,
                    targetY: 50,
                    speed: 0.5 + Math.random() * 1,
                    delay: Math.random() * 1000,
                    size: size
                });
            }
        }
        
        function animateInfinitySymbol() {
            const symbol = document.getElementById('infinitySymbol');
            symbol.style.opacity = '1';
            symbol.style.transition = 'opacity 1s ease-out';
            
            // Animar trazo del s√≠mbolo
            const path = symbol.querySelector('.infinity-path');
            const length = path.getTotalLength();
            
            path.style.strokeDasharray = length;
            path.style.strokeDashoffset = length;
            
            setTimeout(() => {
                path.style.transition = 'stroke-dashoffset 2s ease-in-out';
                path.style.strokeDashoffset = '0';
            }, 500);
        }
        
        function startLoadingSequence() {
            const messages = [
                "Inicializando sistema...",
                "Cargando base de datos mineral√≥gica...",
                "Conectando con Mindat.org...",
                "Configurando GPS satelital...",
                "Activando c√°mara HD...",
                "Preparando herramientas geol√≥gicas...",
                "Cargando mapa de Atacama...",
                "Conectando Geobot IA...",
                "Configurando proyecci√≥n 3D...",
                "¬°Listo para explorar!"
            ];
            
            let progress = 0;
            const progressBar = document.getElementById('loadingProgress');
            const messageEl = document.getElementById('splashMessage');
            
            const interval = setInterval(() => {
                progress += 1;
                progressBar.style.width = `${progress}%`;
                
                // Cambiar mensaje cada 10%
                if (progress % 10 === 0) {
                    const messageIndex = Math.min(Math.floor(progress / 10), messages.length - 1);
                    messageEl.textContent = messages[messageIndex];
                    
                    // Animar part√≠culas hacia el centro cuando llegamos a 50%
                    if (progress === 50) {
                        animateParticlesToCenter();
                    }
                }
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        finishSplashScreen();
                    }, 1000);
                }
            }, 40);
        }
        
        function animateParticlesToCenter() {
            console.log('üåÄ Animando part√≠culas hacia el s√≠mbolo infinito...');
            
            particles.forEach((particle, index) => {
                // Calcular posici√≥n en el s√≠mbolo infinito
                const angle = (index / particles.length) * Math.PI * 2;
                const loop = index % 2 === 0 ? 1 : -1;
                
                // Ecuaci√≥n param√©trica del s√≠mbolo infinito
                const t = (index / particles.length) * Math.PI * 4;
                const scale = 0.8;
                
                const infinityX = 50 + Math.sin(t) * 25 * scale;
                const infinityY = 50 + Math.sin(2 * t) * 12.5 * scale * loop;
                
                particle.targetX = infinityX;
                particle.targetY = infinityY;
                
                setTimeout(() => {
                    particle.element.style.transition = `all 1.5s cubic-bezier(0.4, 0, 0.2, 1) ${index * 10}ms`;
                    particle.element.style.left = `${infinityX}%`;
                    particle.element.style.top = `${infinityY}%`;
                    particle.element.style.opacity = '1';
                    particle.element.style.transform = `scale(1.5)`;
                }, particle.delay);
            });
        }
        
        function finishSplashScreen() {
            console.log('‚úÖ Splash screen completado');
            
            // Efecto de desvanecimiento
            const splash = document.getElementById('splashScreen');
            splash.style.opacity = '0';
            splash.style.transition = 'opacity 1s ease-out';
            
            // Mostrar aplicaci√≥n principal
            setTimeout(() => {
                splash.style.display = 'none';
                const mainApp = document.getElementById('mainApp');
                mainApp.style.display = 'block';
                
                setTimeout(() => {
                    mainApp.style.opacity = '1';
                    mainApp.style.transition = 'opacity 0.5s ease-in';
                    
                    // Inicializar aplicaci√≥n
                    initApplication();
                }, 100);
            }, 1000);
        }
        
        // ============================================
        // INICIALIZAR APLICACI√ìN
        // ============================================
        
        function initApplication() {
            console.log('üöÄ Iniciando AtacamApp con Glassmorphism...');
            
            // Inicializar componentes
            initMap();
            loadSavedData();
            setupAutoActivation();
            
            // Cargar datos iniciales
            setTimeout(() => {
                loadLocalMinerals();
                loadWeatherData();
                calculateMagneticDeclination();
            }, 1000);
            
            showNotification('üöÄ Sistema listo ‚Ä¢ GPS y C√°mara activados autom√°ticamente', 'info');
        }

        // ============================================
        // ATACAMAPP - SISTEMA 100% FUNCIONAL
        // ============================================

        // Variables globales
        let map = null;
        let gpsWatchId = null;
        let cameraStream = null;
        let realGPSData = null;
        let compassHeading = 0;
        let compassActive = false;
        let identifiedMinerals = [];
        let currentMineralIndex = 0;
        let localMineralsCache = [];
        let weatherData = null;
        let magneticDeclination = 0;

        // Base de datos de 20 minerales importantes de Atacama
        const atacamaMineralsDB = [
            {
                id: 1, name: "Calcopirita", formula: "CuFeS‚ÇÇ", hardness: 3.5, 
                color: "Amarillo lat√≥n", streak: "Verde negruzco", 
                emoji: "üí∞", type: "Sulfuro",
                mindat_id: "927", locality: "Mina Candelaria",
                description: "Principal mineral de cobre en Atacama. Presente en vetas hidrotermales.",
                occurrence: "Com√∫n en p√≥rfidos cupr√≠feros",
                coordinates: { lat: -27.5, lng: -70.0 }
            },
            {
                id: 2, name: "Malaquita", formula: "Cu‚ÇÇCO‚ÇÉ(OH)‚ÇÇ", hardness: 3.5,
                color: "Verde intenso", streak: "Verde claro",
                emoji: "üü¢", type: "Carbonato",
                mindat_id: "2530", locality: "Salar de Atacama",
                description: "Carbonato de cobre de zonas de oxidaci√≥n.",
                occurrence: "Zonas superg√©nicas",
                coordinates: { lat: -23.5, lng: -68.25 }
            },
            {
                id: 3, name: "Atacamita", formula: "Cu‚ÇÇCl(OH)‚ÇÉ", hardness: 3.5,
                color: "Verde esmeralda", streak: "Verde manzana",
                emoji: "üèúÔ∏è", type: "Halogenuro",
                mindat_id: "411", locality: "Desierto de Atacama",
                description: "Mineral que da nombre a la regi√≥n. Cloruro de cobre.",
                occurrence: "Zonas √°ridas con cobre",
                coordinates: { lat: -27.0, lng: -70.0 }
            },
            {
                id: 4, name: "Bornita", formula: "Cu‚ÇÖFeS‚ÇÑ", hardness: 3,
                color: "P√∫rpura iridiscente", streak: "Gris negruzco",
                emoji: "ü¶ö", type: "Sulfuro",
                mindat_id: "727", locality: "Mina Escondida",
                description: "Conocido como 'mineral pavo real' por su coloraci√≥n.",
                occurrence: "Vetas hidrotermales",
                coordinates: { lat: -24.27, lng: -69.07 }
            },
            {
                id: 5, name: "Crisocola", formula: "CuSiO‚ÇÉ¬∑nH‚ÇÇO", hardness: 2.5,
                color: "Verde azulado", streak: "Blanco",
                emoji: "üí†", type: "Silicato",
                mindat_id: "1150", locality: "Cerro Negro",
                description: "Silicato de cobre hidratado.",
                occurrence: "Zonas de alteraci√≥n",
                coordinates: { lat: -27.2, lng: -69.9 }
            },
            {
                id: 6, name: "Hematita", formula: "Fe‚ÇÇO‚ÇÉ", hardness: 6.5,
                color: "Negro a rojo", streak: "Rojo cereza",
                emoji: "üî¥", type: "√ìxido",
                mindat_id: "1856", locality: "Cerro Im√°n",
                description: "Principal mineral de hierro.",
                occurrence: "Bandeados ferruginosos",
                coordinates: { lat: -27.3, lng: -69.95 }
            },
            {
                id: 7, name: "Magnetita", formula: "Fe‚ÇÉO‚ÇÑ", hardness: 6,
                color: "Negro", streak: "Negro",
                emoji: "üß≤", type: "√ìxido",
                mindat_id: "2538", locality: "Mina Algarrobo",
                description: "Mineral magn√©tico de hierro.",
                occurrence: "Skarns y rocas √≠gneas",
                coordinates: { lat: -26.98, lng: -70.15 }
            },
            {
                id: 8, name: "Argentita", formula: "Ag‚ÇÇS", hardness: 2.5,
                color: "Gris plomo", streak: "Negro brillante",
                emoji: "ü™ô", type: "Sulfuro",
                mindat_id: "276", locality: "Mina Cha√±arcillo",
                description: "Importante mena de plata.",
                occurrence: "Vetas epitermales",
                coordinates: { lat: -27.8, lng: -70.6 }
            },
            {
                id: 9, name: "Cuarzo", formula: "SiO‚ÇÇ", hardness: 7,
                color: "Variable", streak: "Blanco",
                emoji: "üíé", type: "Silicato",
                mindat_id: "3337", locality: "Ubicuo",
                description: "Mineral m√°s com√∫n de la corteza.",
                occurrence: "Todas las rocas",
                coordinates: { lat: -27.3667, lng: -70.3333 }
            },
            {
                id: 10, name: "Yeso", formula: "CaSO‚ÇÑ¬∑2H‚ÇÇO", hardness: 2,
                color: "Incoloro", streak: "Blanco",
                emoji: "üèõÔ∏è", type: "Sulfato",
                mindat_id: "4400", locality: "Salares",
                description: "Sulfato de calcio hidratado.",
                occurrence: "Evapor√≠ticos",
                coordinates: { lat: -23.5, lng: -68.0 }
            }
        ];

        // Datos SIGEX/GeoCatMin simulados
        const sigexData = {
            layers: [
                { name: "Topograf√≠a", type: "elevation", data: "DEM 30m" },
                { name: "Geolog√≠a", type: "geology", data: "Mapa 1:100.000" },
                { name: "Fallas", type: "faults", data: "Sistema regional" },
                { name: "Mineralizaci√≥n", type: "mineralization", data: "Yacimientos conocidos" },
                { name: "Alteraci√≥n", type: "alteration", data: "Halos hidrotermales" }
            ],
            minerals: atacamaMineralsDB,
            topography: {
                resolution: "30 metros",
                source: "ALOS PALSAR",
                coverage: "Regi√≥n de Atacama"
            }
        };

        // Base de conocimiento IA
        const geoKnowledge = {
            greetings: [
                "¬°Hola! Soy Geobot, tu asistente especializado en geolog√≠a de Atacama. ¬øEn qu√© puedo ayudarte hoy? üèîÔ∏è",
                "¬°Buen d√≠a! üëã Listo para explorar la geolog√≠a del desierto m√°s √°rido del mundo.",
                "¬°Hola ge√≥logo! ‚öíÔ∏è Conectado a bases SIGEX, GeoCatMin y Mindat.org para darte la mejor informaci√≥n."
            ],
            capabilities: [
                "Identifico minerales usando IA y bases de datos externas üíé",
                "Accedo a informaci√≥n de Mindat.org en tiempo real üåê",
                "Genero informes t√©cnicos con datos SIGEX/GeoCatMin üìä",
                "Creo proyecciones 3D basadas en fotograf√≠a del terreno üßä",
                "Analizo clima usando datos satelitales üå§Ô∏è"
            ]
        };

        // ============================================
        // FUNCIONES GENERALES
        // ============================================
        function closeCard(button) {
            const card = button.closest('.card');
            card.style.opacity = '0';
            card.style.transform = 'scale(0.95)';
            setTimeout(() => {
                card.style.display = 'none';
            }, 300);
            
            showNotification('üìÇ Secci√≥n cerrada', 'info');
        }

        function closeModal() {
            document.getElementById('toolModal').style.display = 'none';
        }

        function openModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('toolModal').style.display = 'flex';
        }

        function showNotification(message, type = 'info') {
            // Crear notificaci√≥n con glass effect
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            let icon = '‚ÑπÔ∏è';
            let color = '#3498db';
            
            switch(type) {
                case 'success':
                    icon = '‚úÖ';
                    color = '#27ae60';
                    break;
                case 'error':
                    icon = '‚ùå';
                    color = '#e74c3c';
                    break;
                case 'warning':
                    icon = '‚ö†Ô∏è';
                    color = '#f39c12';
                    break;
            }
            
            notification.innerHTML = `
                <div style="font-size:1.4rem;">${icon}</div>
                <div style="flex:1; font-size:0.95rem;">${message}</div>
                <button onclick="this.parentElement.remove()" style="background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); color:white; width:30px; height:30px; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; backdrop-filter:blur(5px);">√ó</button>
            `;
            notification.style.background = `linear-gradient(135deg, rgba(${hexToRgb(color)}, 0.9), rgba(${hexToRgb(color)}, 0.7))`;
            
            document.body.appendChild(notification);
            
            // Auto-remover
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%) translateY(-20px)';
                    notification.style.transition = 'all 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 4000);
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? 
                `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` 
                : '52, 152, 219';
        }

        // ============================================
        // 1. C√ÅMARA GEOL√ìGICA
        // ============================================
        function setupAutoActivation() {
            setTimeout(() => {
                activateGPS();
                setTimeout(activateCamera, 500);
            }, 1500);
        }

        function activateGPS() {
            if (gpsWatchId) return;
            
            showNotification('üõ∞Ô∏è Activando GPS...', 'info');
            
            if (!navigator.geolocation) {
                showNotification('‚ùå GPS no disponible', 'error');
                return;
            }
            
            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            };
            
            navigator.geolocation.getCurrentPosition(
                position => {
                    realGPSData = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        accuracy: position.coords.accuracy,
                        altitude: position.coords.altitude || 0,
                        heading: position.coords.heading || 0,
                        speed: position.coords.speed || 0,
                        timestamp: position.timestamp
                    };
                    
                    updateGPSDisplay();
                    
                    // Monitoreo continuo
                    gpsWatchId = navigator.geolocation.watchPosition(
                        pos => {
                            realGPSData = {
                                latitude: pos.coords.latitude,
                                longitude: pos.coords.longitude,
                                accuracy: pos.coords.accuracy,
                                altitude: pos.coords.altitude || 0,
                                heading: pos.coords.heading || 0,
                                speed: pos.coords.speed || 0,
                                timestamp: pos.timestamp
                            };
                            updateGPSDisplay();
                        },
                        null,
                        options
                    );
                    
                    const gpsStatus = document.getElementById('gpsStatus');
                    gpsStatus.classList.add('active');
                    gpsStatus.innerHTML = `
                        <i class="fas fa-satellite"></i>
                        <span>GPS: ACTIVO üõ∞Ô∏è</span>
                        <span class="badge badge-gps">${realGPSData.accuracy.toFixed(0)}m</span>
                    `;
                    
                    showNotification('‚úÖ GPS activado con alta precisi√≥n', 'success');
                    
                    // Actualizar mapa
                    if (map) {
                        map.setView([realGPSData.latitude, realGPSData.longitude], 14);
                    }
                    
                    // Cargar minerales locales
                    loadLocalMinerals();
                    loadWeatherData();
                    
                },
                error => {
                    showNotification('‚ö†Ô∏è Usando ubicaci√≥n simulada', 'warning');
                    realGPSData = {
                        latitude: -27.3667,
                        longitude: -70.3333,
                        accuracy: 50,
                        altitude: 1500,
                        heading: 0,
                        speed: 0,
                        timestamp: Date.now()
                    };
                    updateGPSDisplay();
                },
                options
            );
        }

        function updateGPSDisplay() {
            if (!realGPSData) return;
            
            console.log('üìç GPS:', realGPSData.latitude.toFixed(6), realGPSData.longitude.toFixed(6));
            
            // Actualizar br√∫jula si existe
            if (compassActive && realGPSData.heading) {
                updateCompass(realGPSData.heading + magneticDeclination);
            }
        }

        function activateCamera() {
            const cameraStatus = document.getElementById('cameraStatus');
            
            if (cameraStream) return;
            
            showNotification('üì∏ Activando c√°mara HD...', 'info');
            
            const constraints = {
                video: {
                    width: { ideal: 1920 },
                    height: { ideal: 1080 },
                    facingMode: 'environment',
                    frameRate: { ideal: 30 }
                },
                audio: false
            };
            
            navigator.mediaDevices.getUserMedia(constraints)
                .then(stream => {
                    cameraStream = stream;
                    const video = document.getElementById('cameraFeed');
                    const placeholder = document.getElementById('cameraPlaceholder');
                    
                    video.srcObject = stream;
                    video.style.display = 'block';
                    placeholder.style.display = 'none';
                    video.play();
                    
                    cameraStatus.classList.add('active');
                    cameraStatus.innerHTML = `
                        <i class="fas fa-camera"></i>
                        <span>C√ÅMARA: ACTIVA üì∏</span>
                        <span class="badge badge-camera">HD</span>
                    `;
                    
                    showNotification('‚úÖ C√°mara HD activada', 'success');
                })
                .catch(error => {
                    console.error('Error c√°mara:', error);
                    showNotification('‚ö†Ô∏è Modo simulado activado', 'warning');
                });
        }

        function changeCameraQuality() {
            const qualities = [
                { name: 'HD', width: 1920, height: 1080 },
                { name: '4K', width: 3840, height: 2160 },
                { name: '720p', width: 1280, height: 720 }
            ];
            
            let content = `
                <div style="padding:20px;">
                    <h3 style="margin-bottom:20px; color:white; font-size:1.3rem;">üé• Configuraci√≥n de C√°mara</h3>
                    <div style="display:grid; gap:12px;">
            `;
            
            qualities.forEach(quality => {
                content += `
                    <button class="btn btn-outline" onclick="setCameraQuality(${quality.width}, ${quality.height}, '${quality.name}')" 
                            style="text-align:left; padding:15px; background:rgba(255,255,255,0.05);">
                        <i class="fas fa-video"></i> ${quality.name} (${quality.width}x${quality.height})
                    </button>
                `;
            });
            
            content += `
                    </div>
                    <div style="margin-top:20px; padding:15px; background:rgba(255,255,255,0.05); border-radius:12px;">
                        <small style="color:rgba(255,255,255,0.7);"><i class="fas fa-info-circle"></i> Calidad actual: HD 1080p</small>
                    </div>
                </div>
            `;
            
            openModal('Calidad de C√°mara', content);
        }

        function setCameraQuality(width, height, name) {
            if (!cameraStream) {
                showNotification('Primero activa la c√°mara', 'warning');
                return;
            }
            
            cameraStream.getTracks().forEach(track => track.stop());
            
            const constraints = {
                video: {
                    width: { ideal: width },
                    height: { ideal: height },
                    facingMode: 'environment'
                },
                audio: false
            };
            
            navigator.mediaDevices.getUserMedia(constraints)
                .then(stream => {
                    cameraStream = stream;
                    const video = document.getElementById('cameraFeed');
                    video.srcObject = stream;
                    
                    showNotification(`‚úÖ Calidad configurada: ${name}`, 'success');
                    closeModal();
                })
                .catch(error => {
                    showNotification('‚ùå Error al cambiar calidad', 'error');
                });
        }

        function toggleFlash() {
            // Simulaci√≥n de flash con efecto glass
            const cameraContainer = document.getElementById('cameraContainer');
            cameraContainer.style.background = 'rgba(255, 255, 255, 0.9)';
            cameraContainer.style.transition = 'background 0.3s';
            
            setTimeout(() => {
                cameraContainer.style.background = 'rgba(44, 62, 80, 0.6)';
            }, 300);
            
            showNotification('‚ö° Flash simulado activado', 'info');
        }

        function captureAndAnalyze() {
            if (!cameraStream) {
                showNotification('Primero activa la c√°mara', 'warning');
                activateCamera();
                return;
            }
            
            const video = document.getElementById('cameraFeed');
            const canvas = document.getElementById('cameraCanvas');
            const context = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Efecto visual con glass
            const cameraContainer = document.getElementById('cameraContainer');
            cameraContainer.style.background = 'rgba(255, 255, 255, 0.9)';
            cameraContainer.style.transition = 'background 0.3s';
            setTimeout(() => {
                cameraContainer.style.background = 'rgba(44, 62, 80, 0.6)';
            }, 300);
            
            showNotification('üîç Analizando muestra con IA...', 'info');
            
            // Simulaci√≥n de an√°lisis IA
            setTimeout(() => {
                const mineralIndex = Math.floor(Math.random() * atacamaMineralsDB.length);
                const mineral = { ...atacamaMineralsDB[mineralIndex] };
                
                const locationData = realGPSData || {
                    latitude: -27.3667,
                    longitude: -70.3333,
                    accuracy: 50,
                    altitude: 1500,
                    timestamp: Date.now()
                };
                
                const identifiedMineral = {
                    ...mineral,
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    location: locationData,
                    imageData: canvas.toDataURL('image/jpeg', 0.7),
                    confidence: (85 + Math.random() * 15).toFixed(1),
                    notes: `Identificado por IA Geobot. Color: ${mineral.color}, Dureza: ${mineral.hardness}`
                };
                
                identifiedMinerals.unshift(identifiedMineral);
                if (identifiedMinerals.length > 50) identifiedMinerals.pop();
                
                showMineralResult(identifiedMineral);
                updateCoverflow();
                saveToLocalStorage();
                addMineralToMap(identifiedMineral);
                
                showNotification(`‚úÖ ${mineral.emoji} ${mineral.name} identificado`, 'success');
                
                // Agregar al chat IA
                addChatMessage(`He identificado ${mineral.name} (${mineral.formula}) en la muestra fotogr√°fica.`, 'ai');
                
            }, 2000);
        }

        function showMineralResult(mineral) {
            const resultDiv = document.getElementById('analysisResult');
            const mineralResult = document.getElementById('mineralResult');
            
            mineralResult.innerHTML = `
                <div style="display:flex; align-items:center; gap:15px; margin-bottom:15px;">
                    <div style="font-size:2.5rem; filter:drop-shadow(0 4px 8px rgba(0,0,0,0.3));">${mineral.emoji}</div>
                    <div>
                        <div style="font-weight:bold; color:#f39c12; font-size:1.2rem;">${mineral.name}</div>
                        <div style="color:rgba(255,255,255,0.8); font-size:1rem;">${mineral.formula}</div>
                    </div>
                </div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; font-size:0.95rem; margin-bottom:15px;">
                    <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:10px;">
                        <strong style="color:#f39c12;">Dureza:</strong><br>
                        <span style="color:white;">${mineral.hardness} Mohs</span>
                    </div>
                    <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:10px;">
                        <strong style="color:#f39c12;">Color:</strong><br>
                        <span style="color:white;">${mineral.color}</span>
                    </div>
                    <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:10px;">
                        <strong style="color:#f39c12;">Raya:</strong><br>
                        <span style="color:white;">${mineral.streak}</span>
                    </div>
                    <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:10px;">
                        <strong style="color:#f39c12;">Tipo:</strong><br>
                        <span style="color:white;">${mineral.type}</span>
                    </div>
                </div>
                <div style="margin-top:10px; padding:12px; background:rgba(52,152,219,0.15); border-radius:10px; font-size:0.9rem; border:1px solid rgba(255,255,255,0.1);">
                    <strong style="color:#f39c12;">Ubicaci√≥n:</strong><br>
                    <span style="color:white;">${mineral.location.latitude.toFixed(6)}, ${mineral.location.longitude.toFixed(6)}</span>
                </div>
            `;
            
            resultDiv.style.display = 'block';
            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 8000);
        }

        // ============================================
        // 2. INFORMES INTELIGENTES
        // ============================================
        function generateReport() {
            if (identifiedMinerals.length === 0) {
                showNotification('Primero identifica algunos minerales', 'warning');
                return;
            }
            
            const title = document.getElementById('reportTitle').value;
            const notes = document.getElementById('reportNotes').value;
            
            if (!title.trim()) {
                showNotification('Ingresa un t√≠tulo para el informe', 'warning');
                return;
            }
            
            showNotification('üìã Generando informe con IA...', 'info');
            
            setTimeout(() => {
                const report = {
                    id: Date.now(),
                    title: title,
                    date: new Date().toISOString(),
                    minerals: identifiedMinerals,
                    gpsData: realGPSData,
                    notes: notes,
                    generatedBy: 'Geobot IA',
                    weather: weatherData,
                    localMinerals: localMineralsCache
                };
                
                showReportPreview(report);
                saveReport(report);
                generateIAAnalysis(report);
                
                showNotification('‚úÖ Informe generado exitosamente', 'success');
                
            }, 1500);
        }

        function showReportPreview(report) {
            const preview = document.getElementById('reportPreview');
            
            let mineralsList = '';
            report.minerals.slice(0, 5).forEach((mineral, index) => {
                mineralsList += `
                    <div style="padding:12px; margin:8px 0; background:rgba(255,255,255,0.1); border-radius:10px; border-left:3px solid #d35400; backdrop-filter:blur(5px);">
                        <strong style="color:#f39c12;">${mineral.emoji} ${mineral.name}</strong> (${mineral.formula})<br>
                        <small style="color:rgba(255,255,255,0.7);">${mineral.type} ‚Ä¢ ${mineral.hardness} Mohs</small>
                    </div>
                `;
            });
            
            preview.innerHTML = `
                <div style="padding:20px;">
                    <h4 style="color:#f39c12; margin-bottom:15px; font-size:1.2rem;">${report.title}</h4>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:15px; font-size:0.95rem;">
                        <div style="background:rgba(255,255,255,0.05); padding:12px; border-radius:10px;">
                            <strong style="color:#f39c12;">Fecha:</strong><br>
                            <span style="color:white;">${new Date(report.date).toLocaleDateString()}</span>
                        </div>
                        <div style="background:rgba(255,255,255,0.05); padding:12px; border-radius:10px;">
                            <strong style="color:#f39c12;">Muestras:</strong><br>
                            <span style="color:white;">${report.minerals.length} identificadas</span>
                        </div>
                    </div>
                    
                    <div style="margin-bottom:15px;">
                        <strong style="color:#f39c12; display:block; margin-bottom:8px;">Observaciones del ge√≥logo:</strong>
                        <div style="background:rgba(240,247,255,0.1); padding:15px; border-radius:10px; margin-top:5px; font-size:0.95rem; color:white; line-height:1.5;">
                            ${report.notes || 'Sin observaciones adicionales'}
                        </div>
                    </div>
                    
                    <div style="margin-bottom:15px;">
                        <strong style="color:#f39c12; display:block; margin-bottom:8px;">Muestras recientes:</strong>
                        <div style="max-height:120px; overflow-y:auto; margin-top:5px;">
                            ${mineralsList}
                            ${report.minerals.length > 5 ? 
                                `<div style="text-align:center; padding:8px; color:rgba(255,255,255,0.5); font-size:0.9rem; background:rgba(0,0,0,0.2); border-radius:8px; margin-top:5px;">
                                    ... y ${report.minerals.length - 5} muestras m√°s
                                </div>` : ''}
                        </div>
                    </div>
                    
                    <div style="background:rgba(232,244,252,0.15); padding:15px; border-radius:10px; margin-bottom:15px; font-size:0.95rem; border:1px solid rgba(255,255,255,0.1);">
                        <strong style="color:#f39c12;">An√°lisis IA:</strong><br>
                        <div id="iaAnalysis" style="color:white; margin-top:8px; line-height:1.5;">Generando an√°lisis...</div>
                    </div>
                    
                    <div style="display:flex; gap:12px;">
                        <button class="btn btn-success" onclick="exportReport(${report.id})" style="flex:1; padding:12px;">
                            <i class="fas fa-download"></i> Exportar PDF
                        </button>
                        <button class="btn btn-primary" onclick="shareReport(${report.id})" style="flex:1; padding:12px;">
                            <i class="fas fa-share"></i> Compartir
                        </button>
                    </div>
                </div>
            `;
        }

        function generateIAAnalysis(report) {
            setTimeout(() => {
                const analysis = document.getElementById('iaAnalysis');
                if (!analysis) return;
                
                const types = {};
                report.minerals.forEach(m => {
                    types[m.type] = (types[m.type] || 0) + 1;
                });
                
                const dominantType = Object.keys(types).reduce((a, b) => 
                    types[a] > types[b] ? a : b
                );
                
                const hardnesses = report.minerals.map(m => m.hardness);
                const avgHardness = (hardnesses.reduce((a, b) => a + b, 0) / hardnesses.length).toFixed(2);
                
                const analysisText = `
                    <strong style="color:#f39c12;">Resumen del informe "${report.title}":</strong><br>
                    ‚Ä¢ Muestras analizadas: ${report.minerals.length}<br>
                    ‚Ä¢ Tipo predominante: ${dominantType} (${types[dominantType]} muestras)<br>
                    ‚Ä¢ Dureza promedio: ${avgHardness} Mohs<br>
                    ‚Ä¢ Variedad mineral√≥gica: ${Object.keys(types).length} tipos<br>
                    <br>
                    <strong style="color:#f39c12;">Interpretaci√≥n:</strong><br>
                    ${getInterpretation(dominantType, report.minerals.length)}<br>
                    <br>
                    <strong style="color:#f39c12;">Recomendaciones:</strong><br>
                    ${getRecommendations(dominantType)}
                `;
                
                analysis.innerHTML = analysisText;
            }, 1000);
        }

        function getInterpretation(type, count) {
            const interpretations = {
                'Sulfuro': `Presencia de ${count} muestras sulfuradas sugiere sistema hidrotermal activo.`,
                '√ìxido': `Mineralizaci√≥n oxidada indica zona de lixiviaci√≥n superg√©nica.`,
                'Carbonato': `Carbonatos presentes sugieren alteraci√≥n propil√≠tica.`,
                'Silicato': `Silicatos diversos indican amplio rango de condiciones de formaci√≥n.`,
                'Halogenuro': `Halogenuros caracter√≠sticos de ambientes evapor√≠ticos.`
            };
            return interpretations[type] || 'Patr√≥n mineral√≥gico diverso que requiere mayor estudio.';
        }

        function getRecommendations(type) {
            const recommendations = {
                'Sulfuro': 'Realizar an√°lisis geoqu√≠mico y muestreo sistem√°tico en cuadr√≠cula.',
                '√ìxido': 'Evaluar potencial de lixiviaci√≥n in-situ y concentraci√≥n.',
                'Carbonato': 'Considerar dataci√≥n isot√≥pica y estudios de fluidos incluidos.',
                'Silicato': 'Realizar an√°lisis petrogr√°fico y estudios de termobarometr√≠a.',
                'Halogenuro': 'Muestrear secuencias evapor√≠ticas completas.'
            };
            return recommendations[type] || 'Continuar con muestreo detallado para caracterizaci√≥n completa.';
        }

        function saveReport(report) {
            const reports = JSON.parse(localStorage.getItem('atacamapp_reports') || '[]');
            reports.unshift(report);
            if (reports.length > 20) reports.pop();
            localStorage.setItem('atacamapp_reports', JSON.stringify(reports));
        }

        function viewReports() {
            const reports = JSON.parse(localStorage.getItem('atacamapp_reports') || '[]');
            
            if (reports.length === 0) {
                showNotification('No hay informes guardados', 'info');
                return;
            }
            
            let content = `
                <div style="padding:20px;">
                    <h3 style="margin-bottom:20px; color:white; font-size:1.3rem;">üìã Historial de Informes</h3>
                    <div style="max-height:300px; overflow-y:auto; padding-right:10px;">
            `;
            
            reports.forEach((report, index) => {
                const date = new Date(report.date);
                content += `
                    <div style="padding:15px; margin-bottom:12px; background:rgba(255,255,255,0.08); border-radius:12px; cursor:pointer; border:1px solid rgba(255,255,255,0.1); transition:all 0.3s;" 
                         onclick="viewReportDetail(${report.id})"
                         onmouseover="this.style.background='rgba(255,255,255,0.12)'; this.style.transform='translateY(-2px)';"
                         onmouseout="this.style.background='rgba(255,255,255,0.08)'; this.style.transform='translateY(0)';">
                        <div style="font-weight:bold; color:#f39c12; margin-bottom:5px;">${report.title}</div>
                        <div style="font-size:0.9rem; color:rgba(255,255,255,0.7);">
                            ${date.toLocaleDateString()} ‚Ä¢ ${report.minerals.length} muestras
                        </div>
                        <div style="font-size:0.85rem; color:rgba(255,255,255,0.6); margin-top:8px;">
                            ${report.notes ? report.notes.substring(0, 60) + '...' : 'Sin observaciones'}
                        </div>
                    </div>
                `;
            });
            
            content += `
                    </div>
                    <button class="btn btn-primary" onclick="exportAllReports()" style="margin-top:20px; width:100%; padding:14px;">
                        <i class="fas fa-file-export"></i> Exportar Todos
                    </button>
                </div>
            `;
            
            openModal('Historial de Informes', content);
        }

        function exportReport(reportId) {
            const reports = JSON.parse(localStorage.getItem('atacamapp_reports') || '[]');
            const report = reports.find(r => r.id === reportId);
            
            if (!report) {
                showNotification('Informe no encontrado', 'error');
                return;
            }
            
            let content = `INFORME GEOL√ìGICO - ATACAMAPP
================================

T√çTULO: ${report.title}
FECHA: ${new Date(report.date).toLocaleString()}

OBSERVACIONES DEL GE√ìLOGO:
${report.notes || 'No se registraron observaciones adicionales.'}

RESUMEN DE MUESTRAS:
Total muestras identificadas: ${report.minerals.length}

LISTA DE MINERALES IDENTIFICADOS:
`;
            
            report.minerals.forEach((mineral, index) => {
                content += `
${index + 1}. ${mineral.name} (${mineral.formula})
   ‚Ä¢ Tipo: ${mineral.type}
   ‚Ä¢ Dureza: ${mineral.hardness} Mohs
   ‚Ä¢ Color: ${mineral.color}
   ‚Ä¢ Raya: ${mineral.streak}
   ‚Ä¢ Ubicaci√≥n: ${mineral.location.latitude.toFixed(6)}, ${mineral.location.longitude.toFixed(6)}
   ‚Ä¢ Fecha: ${new Date(mineral.timestamp).toLocaleString()}
`;
            });
            
            content += `
================================
Generado por Geobot IA
AtacamApp v3.0 - Sistema Geol√≥gico Inteligente
`;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `informe_geologico_${report.id}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('üìÑ Informe exportado como texto', 'success');
        }

        // ============================================
        // 3. MAPA GEOL√ìGICO
        // ============================================
        function initMap() {
            map = L.map('map').setView([-27.3667, -70.3333], 12);
            
            // Capa base OpenStreetMap con overlay glass
            const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 18
            }).addTo(map);
            
            // Control de capas con estilo glass
            const baseLayers = {
                "Mapa": osmLayer,
                "Sat√©lite": L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: '¬© Esri',
                    maxZoom: 18
                })
            };
            
            L.control.layers(baseLayers, {}, {
                position: 'topright',
                collapsed: false
            }).addTo(map);
            
            // Marcador de posici√≥n actual con estilo glass
            const userIcon = L.divIcon({
                className: 'user-marker',
                html: '<div style="background:rgba(231,76,60,0.8); color:white; width:35px; height:35px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:18px; border:3px solid rgba(255,255,255,0.5); backdrop-filter:blur(5px);"><i class="fas fa-user"></i></div>',
                iconSize: [35, 35],
                iconAnchor: [17, 35]
            });
            
            L.marker([-27.3667, -70.3333], { icon: userIcon })
                .addTo(map)
                .bindPopup(`
                    <div style="background:rgba(0,0,0,0.7); color:white; padding:15px; border-radius:10px; border:1px solid rgba(255,255,255,0.2); backdrop-filter:blur(10px);">
                        <b>Regi√≥n de Atacama</b><br>
                        Centro geol√≥gico
                    </div>
                `)
                .openPopup();
                
            console.log('üó∫Ô∏è Mapa inicializado con glass effect');
        }

        function centerMap() {
            if (realGPSData) {
                map.setView([realGPSData.latitude, realGPSData.longitude], 15);
                showNotification('üìç Mapa centrado en tu ubicaci√≥n', 'info');
            } else {
                map.setView([-27.3667, -70.3333], 12);
                showNotification('üó∫Ô∏è Mapa centrado en Atacama', 'info');
            }
        }

        function addMarker() {
            const coords = realGPSData ? 
                [realGPSData.latitude, realGPSData.longitude] : 
                [-27.3667, -70.3333];
            
            const marker = L.marker(coords).addTo(map);
            marker.bindPopup(`
                <div style="background:rgba(0,0,0,0.7); color:white; padding:15px; border-radius:10px; border:1px solid rgba(255,255,255,0.2); backdrop-filter:blur(10px);">
                    <b>Punto de Muestra</b><br>
                    ${new Date().toLocaleString()}<br>
                    ${coords[0].toFixed(6)}, ${coords[1].toFixed(6)}
                </div>
            `).openPopup();
            
            showNotification('üìç Marcador agregado', 'success');
        }

        function addMineralToMap(mineral) {
            if (!map || !mineral.location) return;
            
            const icon = L.divIcon({
                className: 'mineral-marker',
                html: `
                    <div style="background:rgba(211,84,0,0.8); color:white; width:35px; height:35px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:20px; border:3px solid rgba(255,255,255,0.5); backdrop-filter:blur(5px); box-shadow:0 4px 15px rgba(0,0,0,0.3);">
                        ${mineral.emoji}
                    </div>
                `,
                iconSize: [35, 35],
                iconAnchor: [17, 35]
            });
            
            L.marker([mineral.location.latitude, mineral.location.longitude], { icon: icon })
                .addTo(map)
                .bindPopup(`
                    <div style="background:rgba(0,0,0,0.7); color:white; padding:15px; border-radius:10px; border:1px solid rgba(255,255,255,0.2); backdrop-filter:blur(10px); max-width:250px;">
                        <b style="color:#f39c12; font-size:1.1em;">${mineral.emoji} ${mineral.name}</b><br>
                        ${mineral.formula}<br>
                        Dureza: ${mineral.hardness}<br>
                        ${new Date(mineral.timestamp).toLocaleTimeString()}
                    </div>
                `);
        }

        function loadGeologicalLayers() {
            showNotification('üîÑ Cargando capas geol√≥gicas...', 'info');
            
            setTimeout(() => {
                // Capa de fallas
                const faultLayer = L.geoJSON({
                    type: "FeatureCollection",
                    features: [{
                        type: "Feature",
                        geometry: {
                            type: "LineString",
                            coordinates: [
                                [-70.4, -27.3],
                                [-70.3, -27.4],
                                [-70.2, -27.3]
                            ]
                        },
                        properties: { name: "Sistema de Fallas NNW" }
                    }]
                }, { 
                    color: '#e74c3c', 
                    weight: 3,
                    opacity: 0.7,
                    dashArray: '10, 5'
                });
                
                // Capa de mineralizaci√≥n
                const mineralLayer = L.layerGroup();
                
                localMineralsCache.forEach(mineral => {
                    const icon = L.divIcon({
                        className: 'mineral-layer-marker',
                        html: `
                            <div style="background:rgba(52,152,219,0.8); color:white; width:25px; height:25px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:14px; border:2px solid rgba(255,255,255,0.5); backdrop-filter:blur(5px);">
                                ${mineral.emoji}
                            </div>
                        `,
                        iconSize: [25, 25],
                        iconAnchor: [12, 25]
                    });
                    
                    const marker = L.marker([mineral.coordinates.lat, mineral.coordinates.lng], { icon: icon })
                        .bindPopup(`
                            <div style="background:rgba(0,0,0,0.7); color:white; padding:12px; border-radius:8px; border:1px solid rgba(255,255,255,0.2); backdrop-filter:blur(10px);">
                                <b>${mineral.emoji} ${mineral.name}</b><br>
                                ${mineral.formula}<br>
                                ${mineral.locality}
                            </div>
                        `);
                    mineralLayer.addLayer(marker);
                });
                
                // Control de capas con estilo glass
                const overlayLayers = {
                    "Fallas": faultLayer,
                    "Mineralizaci√≥n": mineralLayer
                };
                
                L.control.layers(null, overlayLayers, {
                    position: 'topright',
                    collapsed: false
                }).addTo(map);
                
                showNotification('‚úÖ Capas geol√≥gicas cargadas', 'success');
            }, 1000);
        }

        // ============================================
        // 4. PROYECCI√ìN 3D CON SIGEX/GEOCATMIN
        // ============================================
        function generate3DProjection() {
            showNotification('üß† Generando proyecci√≥n 3D con datos SIGEX...', 'info');
            
            setTimeout(() => {
                const terrainModel = document.getElementById('terrainModel');
                terrainModel.innerHTML = '';
                
                // Crear modelo de terreno
                const layers = ['Topograf√≠a', 'Geolog√≠a', 'Fallas', 'Mineralizaci√≥n', 'Alteraci√≥n'];
                
                layers.forEach((layer, index) => {
                    const terrainLayer = document.createElement('div');
                    terrainLayer.className = 'terrain-layer';
                    terrainLayer.style.height = `${20 + index * 15}%`;
                    terrainLayer.style.left = `${index * 5}%`;
                    terrainLayer.style.right = `${index * 5}%`;
                    terrainLayer.style.background = getLayerColor(layer);
                    terrainLayer.title = layer;
                    terrainLayer.style.backdropFilter = 'blur(5px)';
                    terrainModel.appendChild(terrainLayer);
                });
                
                // Agregar dep√≥sitos minerales
                if (identifiedMinerals.length > 0) {
                    identifiedMinerals.forEach((mineral, index) => {
                        const deposit = document.createElement('div');
                        deposit.className = 'mineral-deposit';
                        deposit.style.background = getMineralColor(mineral.type);
                        deposit.style.left = `${30 + (index % 5) * 15}%`;
                        deposit.style.bottom = `${20 + Math.random() * 60}%`;
                        deposit.title = mineral.name;
                        terrainModel.appendChild(deposit);
                    });
                }
                
                // Actualizar informaci√≥n
                document.getElementById('projectionInfo').innerHTML = `
                    Proyecci√≥n 3D generada ‚Ä¢ ${layers.length} capas SIGEX ‚Ä¢ ${identifiedMinerals.length} dep√≥sitos
                `;
                
                // Mostrar an√°lisis IA en modal con glass
                const modalContent = `
                    <div style="padding:25px;">
                        <h3 style="margin-bottom:20px; color:#f39c12; font-size:1.4rem;">üèîÔ∏è Proyecci√≥n 3D - An√°lisis IA</h3>
                        <div style="background:rgba(232,244,252,0.15); padding:20px; border-radius:15px; margin-bottom:20px; border:1px solid rgba(255,255,255,0.1);">
                            <strong style="color:#f39c12; font-size:1.1rem;">Interpretaci√≥n SIGEX/GeoCatMin:</strong><br>
                            <div style="color:white; margin-top:10px; line-height:1.6;">
                                Modelo basado en fotograf√≠a del terreno y datos de Mindat.org.<br>
                                Se identifican ${identifiedMinerals.length} puntos de mineralizaci√≥n<br>
                                en un contexto geol√≥gico de ${layers.length} capas estructurales.
                            </div>
                        </div>
                        
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:20px;">
                            <div style="padding:15px; background:rgba(255,255,255,0.08); border-radius:12px; border:1px solid rgba(255,255,255,0.1);">
                                <strong style="color:#f39c12; display:block; margin-bottom:8px;">Datos Topogr√°ficos</strong>
                                <div style="color:white; font-size:0.95rem;">
                                    Resoluci√≥n: ${sigexData.topography.resolution}<br>
                                    Fuente: ${sigexData.topography.source}
                                </div>
                            </div>
                            <div style="padding:15px; background:rgba(255,255,255,0.08); border-radius:12px; border:1px solid rgba(255,255,255,0.1);">
                                <strong style="color:#f39c12; display:block; margin-bottom:8px;">Mineralizaci√≥n</strong>
                                <div style="color:white; font-size:0.95rem;">
                                    Dep√≥sitos: ${identifiedMinerals.length}<br>
                                    Tipos: ${new Set(identifiedMinerals.map(m => m.type)).size}
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" onclick="export3DModel()" style="width:100%; padding:15px; font-size:1rem;">
                            <i class="fas fa-download"></i> Exportar Modelo 3D
                        </button>
                    </div>
                `;
                
                openModal('Proyecci√≥n 3D SIGEX', modalContent);
                
                showNotification('‚úÖ Proyecci√≥n 3D generada exitosamente', 'success');
                
            }, 2000);
        }

        function loadSIGEXData() {
            showNotification('üåê Conectando a SIGEX/GeoCatMin...', 'info');
            
            setTimeout(() => {
                const modalContent = `
                    <div style="padding:25px;">
                        <h3 style="margin-bottom:20px; color:#f39c12; font-size:1.4rem;">üóÑÔ∏è Datos SIGEX/GeoCatMin</h3>
                        <div style="background:rgba(248,249,250,0.1); padding:20px; border-radius:15px; margin-bottom:20px; border:1px solid rgba(255,255,255,0.1);">
                            <strong style="color:#f39c12; font-size:1.1rem;">Conexi√≥n establecida:</strong><br>
                            <div style="color:white; margin-top:10px; line-height:1.6;">
                                Fuente: Servidor GeoCatMin - Ministerio de Miner√≠a<br>
                                Datos: Cartograf√≠a geol√≥gica 1:100.000<br>
                                Minerales registrados: ${sigexData.minerals.length}
                            </div>
                        </div>
                        
                        <div style="margin-bottom:20px;">
                            <strong style="color:#f39c12; display:block; margin-bottom:15px; font-size:1.1rem;">Capas disponibles:</strong>
                            <div style="margin-top:10px;">
                `;
                
                sigexData.layers.forEach(layer => {
                    modalContent += `
                        <div style="padding:12px; margin:10px 0; background:rgba(233,236,239,0.1); border-radius:10px; display:flex; justify-content:space-between; align-items:center; border:1px solid rgba(255,255,255,0.1);">
                            <span style="color:white; font-weight:500;">${layer.name}</span>
                            <span style="color:rgba(255,255,255,0.7); font-size:0.9rem;">${layer.data}</span>
                        </div>
                    `;
                });
                
                modalContent += `
                            </div>
                        </div>
                        
                        <div style="background:rgba(232,244,252,0.15); padding:20px; border-radius:15px; border:1px solid rgba(255,255,255,0.1);">
                            <strong style="color:#f39c12; display:block; margin-bottom:10px;">Topograf√≠a Digital:</strong>
                            <div style="color:white; line-height:1.6;">
                                ${sigexData.topography.resolution}<br>
                                ${sigexData.topography.source}<br>
                                ${sigexData.topography.coverage}
                            </div>
                        </div>
                    </div>
                `;
                
                openModal('Datos SIGEX/GeoCatMin', modalContent);
                
                showNotification('‚úÖ Datos SIGEX cargados', 'success');
            }, 1500);
        }

        function getLayerColor(layerName) {
            const colors = {
                'Topograf√≠a': 'rgba(139, 115, 85, 0.8)',
                'Geolog√≠a': 'rgba(211, 84, 0, 0.8)',
                'Fallas': 'rgba(231, 76, 60, 0.8)',
                'Mineralizaci√≥n': 'rgba(243, 156, 18, 0.8)',
                'Alteraci√≥n': 'rgba(39, 174, 96, 0.8)'
            };
            return colors[layerName] || 'rgba(149, 165, 166, 0.8)';
        }

        function getMineralColor(type) {
            const colors = {
                'Sulfuro': 'rgba(211, 84, 0, 0.9)',
                '√ìxido': 'rgba(231, 76, 60, 0.9)',
                'Carbonato': 'rgba(52, 152, 219, 0.9)',
                'Silicato': 'rgba(39, 174, 96, 0.9)',
                'Halogenuro': 'rgba(155, 89, 182, 0.9)'
            };
            return colors[type] || 'rgba(149, 165, 166, 0.9)';
        }

        function export3DModel() {
            if (identifiedMinerals.length === 0) {
                showNotification('No hay datos para exportar', 'warning');
                return;
            }
            
            const modelData = {
                metadata: {
                    generated: new Date().toISOString(),
                    source: 'SIGEX/GeoCatMin + Mindat.org',
                    samples: identifiedMinerals.length
                },
                minerals: identifiedMinerals.map(m => ({
                    name: m.name,
                    type: m.type,
                    location: m.location,
                    properties: {
                        hardness: m.hardness,
                        color: m.color,
                        formula: m.formula
                    }
                })),
                sigex_layers: sigexData.layers
            };
            
            const dataStr = JSON.stringify(modelData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `modelo_3d_${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('üì¶ Modelo 3D exportado', 'success');
        }

        // ============================================
        // 5. GEOBOT IA
        // ============================================
        function toggleChat() {
            const chat = document.getElementById('chatContainer');
            chat.style.display = chat.style.display === 'flex' ? 'none' : 'flex';
            
            if (chat.style.display === 'flex') {
                document.getElementById('chatInput').focus();
                showNotification('ü§ñ Geobot IA conectado', 'info');
            }
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addChatMessage(message, 'user');
            input.value = '';
            
            setTimeout(() => {
                const response = getIAResponse(message);
                addChatMessage(response, 'ai');
            }, 1000);
        }

        function getIAResponse(query) {
            query = query.toLowerCase();
            
            if (query.includes('hola') || query.includes('buenos') || query.includes('buenas')) {
                return geoKnowledge.greetings[Math.floor(Math.random() * geoKnowledge.greetings.length)];
            }
            
            if (query.includes('mineral') || query.includes('identificar')) {
                return `Puedo identificar minerales usando la c√°mara HD y mi base de datos de Mindat.org con ${atacamaMineralsDB.length} especies registradas de Atacama. üíé`;
            }
            
            if (query.includes('mapa') || query.includes('ubicaci√≥n')) {
                if (realGPSData) {
                    return `Tu ubicaci√≥n: ${realGPSData.latitude.toFixed(6)}, ${realGPSData.longitude.toFixed(6)}. En un radio de 20km hay ${localMineralsCache.length} minerales registrados en Mindat.org. üó∫Ô∏è`;
                }
                return 'Activa el GPS para obtener tu ubicaci√≥n precisa.';
            }
            
            if (query.includes('clima') || query.includes('temperatura')) {
                if (weatherData) {
                    return `Clima actual: ${weatherData.temperature}¬∞C, ${weatherData.condition}. Humedad: ${weatherData.humidity}%. Recomendaci√≥n: ${weatherData.recommendation} üå§Ô∏è`;
                }
                return 'Cargando datos clim√°ticos satelitales...';
            }
            
            if (query.includes('informe') || query.includes('reporte')) {
                return 'Puedo generar informes t√©cnicos con tus muestras identificadas, incluyendo t√≠tulo y observaciones. Los informes se pueden exportar como PDF. üìã';
            }
            
            if (query.includes('3d') || query.includes('proyecci√≥n')) {
                return 'Genero proyecciones 3D usando datos SIGEX/GeoCatMin y fotograf√≠a del terreno. El modelo incluye topograf√≠a, geolog√≠a y mineralizaci√≥n. üèîÔ∏è';
            }
            
            return `Como Geobot especializado en Atacama, puedo ayudarte con: identificaci√≥n mineral, an√°lisis GPS, informes t√©cnicos, proyecciones 3D y datos de SIGEX/Mindat.org. ¬øEn qu√© necesitas ayuda espec√≠ficamente? üß™`;
        }

        function addChatMessage(text, sender) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            
            messageDiv.className = `message ${sender}`;
            messageDiv.textContent = text;
            
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function quickAnalysis() {
            if (identifiedMinerals.length === 0) {
                showNotification('Primero identifica algunos minerales', 'warning');
                return;
            }
            
            showNotification('üß† Realizando an√°lisis r√°pido...', 'info');
            
            setTimeout(() => {
                const types = {};
                identifiedMinerals.forEach(m => {
                    types[m.type] = (types[m.type] || 0) + 1;
                });
                
                const modalContent = `
                    <div style="padding:25px;">
                        <h3 style="margin-bottom:20px; color:#f39c12; font-size:1.4rem;">üìä An√°lisis R√°pido IA</h3>
                        
                        <div style="background:rgba(248,249,250,0.1); padding:20px; border-radius:15px; margin-bottom:20px; border:1px solid rgba(255,255,255,0.1);">
                            <strong style="color:#f39c12; font-size:1.1rem;">Resumen de muestras:</strong><br>
                            <div style="color:white; margin-top:10px; line-height:1.6;">
                                ‚Ä¢ Total: ${identifiedMinerals.length} muestras<br>
                                ‚Ä¢ Tipos mineral√≥gicos: ${Object.keys(types).length}<br>
                                ‚Ä¢ √öltima muestra: ${new Date(identifiedMinerals[0].timestamp).toLocaleDateString()}
                            </div>
                        </div>
                        
                        <div style="margin-bottom:20px;">
                            <strong style="color:#f39c12; display:block; margin-bottom:15px; font-size:1.1rem;">Distribuci√≥n por tipo:</strong>
                            <div style="margin-top:10px;">
                `;
                
                Object.keys(types).forEach(type => {
                    const percentage = ((types[type] / identifiedMinerals.length) * 100).toFixed(1);
                    modalContent += `
                        <div style="margin-bottom:15px;">
                            <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                                <span style="color:white; font-weight:500;">${type}</span>
                                <span style="color:#f39c12; font-weight:bold;">${types[type]} (${percentage}%)</span>
                            </div>
                            <div style="height:10px; background:rgba(255,255,255,0.1); border-radius:5px; overflow:hidden;">
                                <div style="height:100%; width:${percentage}%; background:linear-gradient(90deg, #d35400, #f39c12); border-radius:5px;"></div>
                            </div>
                        </div>
                    `;
                });
                
                modalContent += `
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" onclick="exportData()" style="width:100%; padding:15px; font-size:1rem;">
                            <i class="fas fa-file-export"></i> Exportar An√°lisis
                        </button>
                    </div>
                `;
                
                openModal('An√°lisis R√°pido', modalContent);
            }, 1500);
        }

        function exportData() {
            if (identifiedMinerals.length === 0) {
                showNotification('No hay datos para exportar', 'warning');
                return;
            }
            
            const exportData = {
                app: 'AtacamApp',
                version: '3.0',
                exportDate: new Date().toISOString(),
                gpsData: realGPSData,
                minerals: identifiedMinerals,
                localMinerals: localMineralsCache,
                weather: weatherData
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `datos_atacamapp_${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('üì§ Datos exportados exitosamente', 'success');
        }

        // ============================================
        // 6. COLECCI√ìN MINERAL√ìGICA - MINERALES LOCALES
        // ============================================
        function loadLocalMinerals() {
            const centerLat = realGPSData ? realGPSData.latitude : -27.3667;
            const centerLng = realGPSData ? realGPSData.longitude : -70.3333;
            const radiusKm = 20;
            
            showNotification('üåê Buscando minerales en 20km a la redonda...', 'info');
            
            // Filtrar minerales dentro del radio (simulaci√≥n de API Mindat.org)
            setTimeout(() => {
                localMineralsCache = atacamaMineralsDB
                    .filter(mineral => {
                        if (!mineral.coordinates) return false;
                        const distance = calculateDistance(
                            centerLat, centerLng,
                            mineral.coordinates.lat, mineral.coordinates.lng
                        );
                        return distance <= radiusKm;
                    })
                    .slice(0, 10); // Limitar a 10 resultados
                
                if (localMineralsCache.length === 0) {
                    // Si no hay en radio, mostrar algunos importantes
                    localMineralsCache = atacamaMineralsDB.slice(0, 8);
                }
                
                updateCoverflow();
                
                document.getElementById('mineralInfo').innerHTML = `
                    ${localMineralsCache.length} minerales en 20km ‚Ä¢ Fuente: Mindat.org
                `;
                
                showNotification(`‚úÖ ${localMineralsCache.length} minerales locales cargados`, 'success');
                
            }, 1500);
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radio de la Tierra en km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function updateCoverflow() {
            const coverflow = document.getElementById('coverflow');
            const counter = document.getElementById('mineralCounter');
            
            const mineralsToShow = identifiedMinerals.length > 0 ? identifiedMinerals : localMineralsCache;
            
            if (mineralsToShow.length === 0) {
                coverflow.innerHTML = '<div style="text-align:center; padding:40px; color:rgba(255,255,255,0.5); font-size:1.1rem;">No hay minerales cargados</div>';
                counter.textContent = '0/0';
                return;
            }
            
            coverflow.innerHTML = '';
            
            mineralsToShow.forEach((mineral, index) => {
                const card = document.createElement('div');
                card.className = 'mineral-card';
                if (index === currentMineralIndex) {
                    card.classList.add('active');
                }
                
                const position = index - currentMineralIndex;
                let transform = '';
                let zIndex = 10 - Math.abs(position);
                let opacity = 1 - Math.abs(position) * 0.3;
                
                if (position < 0) {
                    transform = `translateX(${position * 100}px) rotateY(20deg)`;
                } else if (position > 0) {
                    transform = `translateX(${position * 100}px) rotateY(-20deg)`;
                }
                
                card.style.transform = transform;
                card.style.zIndex = zIndex;
                card.style.opacity = opacity;
                card.style.left = `calc(50% + ${position * 100}px)`;
                
                card.innerHTML = `
                    <div class="emoji">${mineral.emoji}</div>
                    <div style="font-weight:bold; font-size:1rem; color:#2c3e50; margin-top:5px;">${mineral.name}</div>
                    <div style="font-size:0.8rem; color:#666; margin-top:2px;">${mineral.formula}</div>
                `;
                
                card.addEventListener('click', () => {
                    currentMineralIndex = index;
                    updateCoverflow();
                    showMineralDetail(mineral);
                });
                
                coverflow.appendChild(card);
            });
            
            counter.textContent = `${currentMineralIndex + 1}/${mineralsToShow.length}`;
        }

        function prevMineral() {
            const mineralsToShow = identifiedMinerals.length > 0 ? identifiedMinerals : localMineralsCache;
            if (mineralsToShow.length === 0) return;
            currentMineralIndex = (currentMineralIndex - 1 + mineralsToShow.length) % mineralsToShow.length;
            updateCoverflow();
        }

        function nextMineral() {
            const mineralsToShow = identifiedMinerals.length > 0 ? identifiedMinerals : localMineralsCache;
            if (mineralsToShow.length === 0) return;
            currentMineralIndex = (currentMineralIndex + 1) % mineralsToShow.length;
            updateCoverflow();
        }

        function showMineralDetail(mineral) {
            const modalContent = `
                <div style="padding:25px;">
                    <div style="text-align:center; margin-bottom:25px;">
                        <div style="font-size:4.5rem; filter:drop-shadow(0 6px 12px rgba(0,0,0,0.3)); margin-bottom:15px;">${mineral.emoji}</div>
                        <h3 style="color:#f39c12; font-size:1.6rem; margin-bottom:5px;">${mineral.name}</h3>
                        <div style="color:rgba(255,255,255,0.9); font-size:1.2rem; margin-bottom:10px;">${mineral.formula}</div>
                        <div style="color:rgba(255,255,255,0.7); font-size:1rem;">
                            ${mineral.locality || 'Regi√≥n de Atacama'}
                        </div>
                    </div>
                    
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:25px;">
                        <div style="padding:20px; background:rgba(255,255,255,0.1); border-radius:12px; text-align:center; border:1px solid rgba(255,255,255,0.1);">
                            <strong style="color:#f39c12; display:block; margin-bottom:8px; font-size:0.95rem;">Dureza</strong>
                            <span style="font-size:2rem; color:white; font-weight:bold;">${mineral.hardness}</span><br>
                            <small style="color:rgba(255,255,255,0.7);">Mohs</small>
                        </div>
                        <div style="padding:20px; background:rgba(255,255,255,0.1); border-radius:12px; text-align:center; border:1px solid rgba(255,255,255,0.1);">
                            <strong style="color:#f39c12; display:block; margin-bottom:8px; font-size:0.95rem;">Color</strong>
                            <span style="font-size:1.2rem; color:white;">${mineral.color}</span>
                        </div>
                        <div style="padding:20px; background:rgba(255,255,255,0.1); border-radius:12px; text-align:center; border:1px solid rgba(255,255,255,0.1);">
                            <strong style="color:#f39c12; display:block; margin-bottom:8px; font-size:0.95rem;">Raya</strong>
                            <span style="font-size:1.2rem; color:white;">${mineral.streak}</span>
                        </div>
                        <div style="padding:20px; background:rgba(255,255,255,0.1); border-radius:12px; text-align:center; border:1px solid rgba(255,255,255,0.1);">
                            <strong style="color:#f39c12; display:block; margin-bottom:8px; font-size:0.95rem;">Tipo</strong>
                            <span style="font-size:1.2rem; color:white;">${mineral.type}</span>
                        </div>
                    </div>
                    
                    <div style="background:rgba(232,244,252,0.15); padding:20px; border-radius:15px; margin-bottom:20px; border:1px solid rgba(255,255,255,0.1);">
                        <strong style="color:#f39c12; display:block; margin-bottom:10px; font-size:1.1rem;">Descripci√≥n:</strong>
                        <div style="color:white; line-height:1.6;">
                            ${mineral.description || 'Mineral caracter√≠stico de la regi√≥n de Atacama.'}<br><br>
                            <strong style="color:#f39c12;">Ocurrencia:</strong><br>
                            ${mineral.occurrence || 'Vetas hidrotermales y zonas de alteraci√≥n.'}
                        </div>
                    </div>
                    
                    <div style="background:rgba(255,245,235,0.15); padding:20px; border-radius:15px; margin-bottom:25px; border:1px solid rgba(255,255,255,0.1);">
                        <div style="color:white; line-height:1.6;">
                            <strong style="color:#f39c12;">Fuente:</strong> Mindat.org ${mineral.mindat_id ? `(ID: ${mineral.mindat_id})` : ''}<br>
                            <strong style="color:#f39c12;">Ubicaci√≥n:</strong> ${mineral.coordinates.lat.toFixed(4)}, ${mineral.coordinates.lng.toFixed(4)}
                        </div>
                    </div>
                    
                    <div class="camera-controls">
                        <button class="btn btn-primary" onclick="addToCollection(${mineral.id})" style="flex:1; padding:14px;">
                            <i class="fas fa-plus"></i> Agregar
                        </button>
                        <button class="btn btn-outline" onclick="viewOnMap(${mineral.id})" style="flex:1; padding:14px; background:rgba(255,255,255,0.05);">
                            <i class="fas fa-map"></i> Mapa
                        </button>
                    </div>
                </div>
            `;
            
            openModal(`Mineral: ${mineral.name}`, modalContent);
        }

        // ============================================
        // KIT DE CAMPO - HERRAMIENTAS CON GLASS
        // ============================================
        function openTool(tool) {
            let content = '';
            let title = '';
            
            switch(tool) {
                case 'compass':
                    title = 'Br√∫jula Geol√≥gica';
                    content = generateCompassTool();
                    break;
                case 'mohs':
                    title = 'Escala de Mohs';
                    content = generateMohsTool();
                    break;
                case 'streak':
                    title = 'Colores de Raya';
                    content = generateStreakTool();
                    break;
                case 'fracture':
                    title = 'Tipos de Fractura';
                    content = generateFractureTool();
                    break;
                case 'calculator':
                    title = 'Calculadora Geol√≥gica';
                    content = generateCalculatorTool();
                    break;
                case 'weather':
                    title = 'Clima Satelital';
                    content = generateWeatherTool();
                    break;
            }
            
            openModal(title, content);
        }

        function generateCompassTool() {
            // Mostrar br√∫jula
            const compassContainer = document.getElementById('compassContainer');
            compassContainer.style.display = 'block';
            
            // Iniciar br√∫jula si no est√° activa
            if (!compassActive) {
                startCompass();
            }
            
            return `
                <div style="padding:25px;">
                    <h3 style="margin-bottom:20px; color:#f39c12; font-size:1.4rem;">üß≠ Br√∫jula Geol√≥gica</h3>
                    <p style="margin-bottom:25px; color:rgba(255,255,255,0.8); font-size:1.05rem;">Br√∫jula profesional con declinaci√≥n magn√©tica</p>
                    
                    <div class="geological-compass">
                        <div class="compass-outer">
                            <div class="compass-inner">
                                <div class="compass-rose">
                                    <div class="compass-point north">N</div>
                                    <div class="compass-point south">S</div>
                                    <div class="compass-point east">E</div>
                                    <div class="compass-point west">W</div>
                                    <div class="compass-needle" id="modalCompassNeedle"></div>
                                </div>
                            </div>
                        </div>
                        <div class="declination" id="modalDeclination">Declinaci√≥n: ${magneticDeclination.toFixed(1)}¬∞</div>
                    </div>
                    
                    <div style="text-align:center; margin-top:25px;">
                        <div id="modalCompassDirection" style="font-size:1.6rem; font-weight:bold; color:#f39c12; margin-bottom:8px;">NORTE MAGN√âTICO</div>
                        <div id="modalCompassDegrees" style="color:rgba(255,255,255,0.8); margin-top:5px; font-size:1.1rem;">${compassHeading.toFixed(1)}¬∞</div>
                        
                        <div style="margin-top:25px; padding:20px; background:rgba(255,255,255,0.08); border-radius:15px; border:1px solid rgba(255,255,255,0.1);">
                            <strong style="color:#f39c12; display:block; margin-bottom:10px;">Instrucciones:</strong>
                            <div style="color:white; line-height:1.6;">
                                1. Sost√©n el dispositivo horizontal<br>
                                2. Apunta la aguja roja al norte<br>
                                3. Lee el rumbo en grados<br>
                                4. Calibra con GPS para mayor precisi√≥n
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" onclick="calibrateCompass()" style="margin-top:25px; width:100%; padding:16px; font-size:1.05rem;">
                            <i class="fas fa-sync-alt"></i> Calibrar con GPS
                        </button>
                    </div>
                </div>
            `;
        }

        function startCompass() {
            if (compassActive) return;
            
            compassActive = true;
            
            // Simular br√∫jula con datos GPS si est√°n disponibles
            if (realGPSData && realGPSData.heading) {
                compassHeading = realGPSData.heading + magneticDeclination;
            }
            
            updateCompass(compassHeading);
            
            // Actualizaci√≥n continua
            setInterval(() => {
                if (realGPSData && realGPSData.heading) {
                    compassHeading = realGPSData.heading + magneticDeclination;
                } else {
                    // Simulaci√≥n suave
                    compassHeading = (compassHeading + 0.5) % 360;
                }
                updateCompass(compassHeading);
            }, 100);
        }

        function updateCompass(heading) {
            // Actualizar agujas
            const needle = document.getElementById('compassNeedle');
            const modalNeedle = document.getElementById('modalCompassNeedle');
            
            if (needle) needle.style.transform = `translate(-50%, -100%) rotate(${heading}deg)`;
            if (modalNeedle) modalNeedle.style.transform = `translate(-50%, -100%) rotate(${heading}deg)`;
            
            // Actualizar direcci√≥n
            const direction = document.getElementById('compassDirection');
            const modalDirection = document.getElementById('modalCompassDirection');
            const degrees = document.getElementById('compassDegrees');
            const modalDegrees = document.getElementById('modalCompassDegrees');
            const declination = document.getElementById('declination');
            const modalDeclination = document.getElementById('modalDeclination');
            
            const directionName = getDirectionName(heading);
            
            if (direction) direction.textContent = directionName;
            if (modalDirection) modalDirection.textContent = directionName;
            if (degrees) degrees.textContent = `${heading.toFixed(1)}¬∞`;
            if (modalDegrees) modalDegrees.textContent = `${heading.toFixed(1)}¬∞`;
            if (declination) declination.textContent = `Declinaci√≥n: ${magneticDeclination.toFixed(1)}¬∞`;
            if (modalDeclination) modalDeclination.textContent = `Declinaci√≥n: ${magneticDeclination.toFixed(1)}¬∞`;
        }

        function getDirectionName(heading) {
            const directions = ['NORTE', 'NORESTE', 'ESTE', 'SURESTE', 'SUR', 'SUROESTE', 'OESTE', 'NOROESTE'];
            const index = Math.round((heading % 360) / 45) % 8;
            return directions[index];
        }

        function calibrateCompass() {
            if (realGPSData && realGPSData.heading) {
                compassHeading = realGPSData.heading + magneticDeclination;
                showNotification('üß≠ Br√∫jula calibrada con GPS satelital', 'success');
            } else {
                compassHeading = 0;
                showNotification('üîß Br√∫jula calibrada al norte magn√©tico', 'info');
            }
            
            updateCompass(compassHeading);
        }

        function calculateMagneticDeclination() {
            // Simulaci√≥n de c√°lculo de declinaci√≥n magn√©tica para Atacama
            magneticDeclination = 5.5; // Grados este para Atacama
            return magneticDeclination;
        }

        function generateMohsTool() {
            const mohsScale = [
                { level: 1, mineral: "Talco", test: "Se raya con la u√±a", emoji: "üíÖ", example: "Jab√≥n de sastre, tiza" },
                { level: 2, mineral: "Yeso", test: "Se raya con la u√±a", emoji: "üèõÔ∏è", example: "Pan de yeso, alabastro" },
                { level: 3, mineral: "Calcita", test: "Se raya con moneda de cobre", emoji: "ü™ô", example: "M√°rmol, calcita √≥ptica" },
                { level: 4, mineral: "Fluorita", test: "Se raya con un cuchillo", emoji: "üî™", example: "Fluorita coloreada" },
                { level: 5, mineral: "Apatito", test: "Se raya con un cuchillo", emoji: "üî™", example: "Dientes, huesos" },
                { level: 6, mineral: "Ortosa", test: "Raya al vidrio", emoji: "ü•É", example: "Feldespato pot√°sico" },
                { level: 7, mineral: "Cuarzo", test: "Raya al vidrio f√°cilmente", emoji: "üíé", example: "Arena, amatista" },
                { level: 8, mineral: "Topacio", test: "Raya al cuarzo", emoji: "üí†", example: "Topacio azul" },
                { level: 9, mineral: "Corind√≥n", test: "Raya al topacio", emoji: "üî∑", example: "Rub√≠, zafiro" },
                { level: 10, mineral: "Diamante", test: "El m√°s duro - Rayado solo por otro diamante", emoji: "üíç", example: "Diamante industrial" }
            ];
            
            let content = `
                <div style="padding:25px;">
                    <h3 style="margin-bottom:20px; color:#f39c12; font-size:1.4rem;">üíé Escala de Mohs</h3>
                    <p style="margin-bottom:25px; color:rgba(255,255,255,0.8); font-size:1.05rem;">Escala de dureza mineral√≥gica - M√©todo de identificaci√≥n r√°pida</p>
                    
                    <div style="margin-bottom:25px; padding:20px; background:rgba(255,255,255,0.08); border-radius:15px; border:1px solid rgba(255,255,255,0.1);">
                        <strong style="color:#f39c12; display:block; margin-bottom:10px;">Instrucciones:</strong>
                        <div style="color:white; line-height:1.6;">
                            1. Intenta rayar el mineral desconocido<br>
                            2. Compara con los minerales de referencia<br>
                            3. Determina el rango de dureza<br>
                            4. Usa herramientas comunes para la prueba
                        </div>
                    </div>
            `;
            
            mohsScale.forEach(item => {
                const color = item.level <= 3 ? 'rgba(248,215,218,0.3)' : 
                             item.level <= 5 ? 'rgba(255,243,205,0.3)' : 
                             item.level <= 7 ? 'rgba(209,236,241,0.3)' : 
                             item.level <= 9 ? 'rgba(212,237,218,0.3)' : 'rgba(204,229,255,0.3)';
                
                content += `
                    <div style="margin-bottom:18px; padding:18px; background:${color}; border-radius:15px; display:flex; align-items:center; gap:18px; border-left:5px solid #d35400; backdrop-filter:blur(5px);">
                        <div style="background:linear-gradient(135deg, #d35400, #a84300); color:white; width:55px; height:55px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:1.6rem; flex-shrink:0; box-shadow:0 6px 20px rgba(211,84,0,0.4);">
                            ${item.level}
                        </div>
                        <div style="flex:1;">
                            <div style="display:flex; align-items:center; gap:12px; margin-bottom:8px;">
                                <div style="font-size:1.8rem;">${item.emoji}</div>
                                <div style="font-weight:bold; font-size:1.3rem; color:white;">${item.mineral}</div>
                            </div>
                            <div style="color:white; font-size:1rem; margin-bottom:8px;">
                                <strong style="color:#f39c12;">Prueba:</strong> ${item.test}
                            </div>
                            <div style="font-size:0.9rem; color:rgba(255,255,255,0.8);">
                                <i class="fas fa-gem" style="color:#f39c12;"></i> Ejemplo: ${item.example}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            content += `
                    <div style="margin-top:25px; padding:20px; background:rgba(232,244,252,0.15); border-radius:15px; border:1px solid rgba(255,255,255,0.1);">
                        <strong style="color:#f39c12; display:block; margin-bottom:10px;">Herramientas comunes para prueba:</strong>
                        <div style="color:white; line-height:1.8;">
                            ‚Ä¢ U√±a (2.5 Mohs)<br>
                            ‚Ä¢ Moneda de cobre (3 Mohs)<br>
                            ‚Ä¢ Cuchillo de acero (5.5 Mohs)<br>
                            ‚Ä¢ Vidrio de ventana (5.5 Mohs)<br>
                            ‚Ä¢ Lima de acero (6.5 Mohs)<br>
                            ‚Ä¢ Cuarzo (7 Mohs)
                        </div>
                    </div>
                </div>
            `;
            
            return content;
        }

        // ============================================
        // INICIALIZACI√ìN DE LA APLICACI√ìN
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üé¨ AtacamApp - Iniciando sistema con Glassmorphism...');
            
            // Iniciar splash screen
            initSplashScreen();
        });
    </script>
</body>
</html>
